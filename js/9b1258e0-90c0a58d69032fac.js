"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[701],{42323:function(e,t,n){let i,o;n.d(t,{K2x:function(){return ny},WCb:function(){return rB},eVA:function(){return t$},kk0:function(){return su},mir:function(){return rM}});var r,s,a,u,c,l,d,m,p,g=n(7908),h=n(19524),y=n(37355),f=n(34108),w=n(57862),b=n(31266),k=n(6122),A=n(96635),I=n(32572),P=n(12920),T=n(9020),S=n(76766),B=n(38566),v=n(30537),K=n(51514),C=n(62109),x=n(23663).Buffer,O=Object.defineProperty,q=Object.defineProperties,R=Object.getOwnPropertyDescriptors,L=Object.getOwnPropertySymbols,E=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable,M=(e,t,n)=>t in e?O(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,W=(e,t)=>{for(var n in t||(t={}))E.call(t,n)&&M(e,n,t[n]);if(L)for(var n of L(t))F.call(t,n)&&M(e,n,t[n]);return e},_=(e,t)=>q(e,R(t)),D=(e,t)=>{var n={};for(var i in e)E.call(e,i)&&0>t.indexOf(i)&&(n[i]=e[i]);if(null!=e&&L)for(var i of L(e))0>t.indexOf(i)&&F.call(e,i)&&(n[i]=e[i]);return n},N=((G=N||{})[G.Error=0]="Error",G[G.Warning=1]="Warning",G[G.Info=2]="Info",G[G.Debug=3]="Debug",G),V=class{constructor(e){this.logLevel=void 0!==e.logLevel?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)&&console.error(this.time,this.name,"sdk logger error",...e),this}logWithError(...e){throw Error(e.map(e=>"object"==typeof e?JSON.stringify(e):e).join(", "))}warning(...e){return this.isLogLevel(1)&&console.warn(this.time,this.name,"sdk logger warning",...e),this}info(...e){return this.isLogLevel(2)&&console.info(this.time,this.name,"sdk logger info",...e),this}debug(...e){return this.isLogLevel(3)&&console.debug(this.time,this.name,"sdk logger debug",...e),this}},U={},X={};function H(e){let t=(0,h.get)(U,e);if(!t){let n=(0,h.get)(X,e);t=new V({name:e,logLevel:n}),(0,h.set)(U,e,t)}return t}var G,z,j,Q="0123456789abcdef",Z="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Y="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",$={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-9e15,maxE:9e15,crypto:!1},J=!0,ee="[DecimalError] ",et=ee+"Invalid argument: ",en=ee+"Precision limit exceeded",ei=ee+"crypto unavailable",eo="[object Decimal]",er=Math.floor,es=Math.pow,ea=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,eu=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,ec=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,el=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ed=Z.length-1,em=Y.length-1,ep={toStringTag:eo};function eg(e){var t,n,i,o=e.length-1,r="",s=e[0];if(o>0){for(r+=s,t=1;t<o;t++)(n=7-(i=e[t]+"").length)&&(r+=eS(n)),r+=i;(n=7-(i=(s=e[t])+"").length)&&(r+=eS(n))}else if(0===s)return"0";for(;s%10==0;)s/=10;return r+s}function eh(e,t,n){if(e!==~~e||e<t||e>n)throw Error(et+e)}function ey(e,t,n,i){var o,r,s,a;for(r=e[0];r>=10;r/=10)--t;return--t<0?(t+=7,o=0):(o=Math.ceil((t+1)/7),t%=7),r=es(10,7-t),a=e[o]%r|0,null==i?t<3?(0==t?a=a/100|0:1==t&&(a=a/10|0),s=n<4&&99999==a||n>3&&49999==a||5e4==a||0==a):s=(n<4&&a+1==r||n>3&&a+1==r/2)&&(e[o+1]/r/100|0)==es(10,t-2)-1||(a==r/2||0==a)&&(e[o+1]/r/100|0)==0:t<4?(0==t?a=a/1e3|0:1==t?a=a/100|0:2==t&&(a=a/10|0),s=(i||n<4)&&9999==a||!i&&n>3&&4999==a):s=((i||n<4)&&a+1==r||!i&&n>3&&a+1==r/2)&&(e[o+1]/r/1e3|0)==es(10,t-3)-1,s}function ef(e,t,n){for(var i,o,r=[0],s=0,a=e.length;s<a;){for(o=r.length;o--;)r[o]*=t;for(r[0]+=Q.indexOf(e.charAt(s++)),i=0;i<r.length;i++)r[i]>n-1&&(void 0===r[i+1]&&(r[i+1]=0),r[i+1]+=r[i]/n|0,r[i]%=n)}return r.reverse()}ep.absoluteValue=ep.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),eb(e)},ep.ceil=function(){return eb(new this.constructor(this),this.e+1,2)},ep.clampedTo=ep.clamp=function(e,t){var n=this.constructor;if(e=new n(e),t=new n(t),!e.s||!t.s)return new n(NaN);if(e.gt(t))throw Error(et+t);return 0>this.cmp(e)?e:this.cmp(t)>0?t:new n(this)},ep.comparedTo=ep.cmp=function(e){var t,n,i,o,r=this.d,s=(e=new this.constructor(e)).d,a=this.s,u=e.s;if(!r||!s)return a&&u?a!==u?a:r===s?0:!r^a<0?1:-1:NaN;if(!r[0]||!s[0])return r[0]?a:s[0]?-u:0;if(a!==u)return a;if(this.e!==e.e)return this.e>e.e^a<0?1:-1;for(i=r.length,o=s.length,t=0,n=i<o?i:o;t<n;++t)if(r[t]!==s[t])return r[t]>s[t]^a<0?1:-1;return i===o?0:i>o^a<0?1:-1},ep.cosine=ep.cos=function(){var e,t,n=this,i=n.constructor;return n.d?n.d[0]?(e=i.precision,t=i.rounding,i.precision=e+Math.max(n.e,n.sd())+7,i.rounding=1,n=function(e,t){var n,i,o;if(t.isZero())return t;(i=t.d.length)<32?o=(1/eL(4,n=Math.ceil(i/3))).toString():(n=16,o="2.3283064365386962890625e-10"),e.precision+=n,t=eR(e,1,t.times(o),new e(1));for(var r=n;r--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=n,t}(i,eE(i,n)),i.precision=e,i.rounding=t,eb(2==j||3==j?n.neg():n,e,t,!0)):new i(1):new i(NaN)},ep.cubeRoot=ep.cbrt=function(){var e,t,n,i,o,r,s,a,u,c,l=this.constructor;if(!this.isFinite()||this.isZero())return new l(this);for(J=!1,(r=this.s*es(this.s*this,1/3))&&Math.abs(r)!=1/0?i=new l(r.toString()):(n=eg(this.d),(r=((e=this.e)-n.length+1)%3)&&(n+=1==r||-2==r?"0":"00"),r=es(n,1/3),e=er((e+1)/3)-(e%3==(e<0?-1:2)),(i=new l(n=r==1/0?"5e"+e:(n=r.toExponential()).slice(0,n.indexOf("e")+1)+e)).s=this.s),s=(e=l.precision)+3;;)if(i=ew((c=(u=(a=i).times(a).times(a)).plus(this)).plus(this).times(a),c.plus(u),s+2,1),eg(a.d).slice(0,s)===(n=eg(i.d)).slice(0,s)){if("9999"!=(n=n.slice(s-3,s+1))&&(o||"4999"!=n)){+n&&(+n.slice(1)||"5"!=n.charAt(0))||(eb(i,e+1,1),t=!i.times(i).times(i).eq(this));break}if(!o&&(eb(a,e+1,0),a.times(a).times(a).eq(this))){i=a;break}s+=4,o=1}return J=!0,eb(i,e,l.rounding,t)},ep.decimalPlaces=ep.dp=function(){var e,t=this.d,n=NaN;if(t){if(n=((e=t.length-1)-er(this.e/7))*7,e=t[e])for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n},ep.dividedBy=ep.div=function(e){return ew(this,new this.constructor(e))},ep.dividedToIntegerBy=ep.divToInt=function(e){var t=this.constructor;return eb(ew(this,new t(e),0,1,1),t.precision,t.rounding)},ep.equals=ep.eq=function(e){return 0===this.cmp(e)},ep.floor=function(){return eb(new this.constructor(this),this.e+1,3)},ep.greaterThan=ep.gt=function(e){return this.cmp(e)>0},ep.greaterThanOrEqualTo=ep.gte=function(e){var t=this.cmp(e);return 1==t||0===t},ep.hyperbolicCosine=ep.cosh=function(){var e,t,n,i,o,r=this,s=r.constructor,a=new s(1);if(!r.isFinite())return new s(r.s?1/0:NaN);if(r.isZero())return a;n=s.precision,i=s.rounding,s.precision=n+Math.max(r.e,r.sd())+4,s.rounding=1,(o=r.d.length)<32?t=(1/eL(4,e=Math.ceil(o/3))).toString():(e=16,t="2.3283064365386962890625e-10"),r=eR(s,1,r.times(t),new s(1),!0);for(var u,c=e,l=new s(8);c--;)u=r.times(r),r=a.minus(u.times(l.minus(u.times(l))));return eb(r,s.precision=n,s.rounding=i,!0)},ep.hyperbolicSine=ep.sinh=function(){var e,t,n,i,o=this,r=o.constructor;if(!o.isFinite()||o.isZero())return new r(o);if(t=r.precision,n=r.rounding,r.precision=t+Math.max(o.e,o.sd())+4,r.rounding=1,(i=o.d.length)<3)o=eR(r,2,o,o,!0);else{e=(e=1.4*Math.sqrt(i))>16?16:0|e,o=eR(r,2,o=o.times(1/eL(5,e)),o,!0);for(var s,a=new r(5),u=new r(16),c=new r(20);e--;)s=o.times(o),o=o.times(a.plus(s.times(u.times(s).plus(c))))}return r.precision=t,r.rounding=n,eb(o,t,n,!0)},ep.hyperbolicTangent=ep.tanh=function(){var e,t,n=this.constructor;return this.isFinite()?this.isZero()?new n(this):(e=n.precision,t=n.rounding,n.precision=e+7,n.rounding=1,ew(this.sinh(),this.cosh(),n.precision=e,n.rounding=t)):new n(this.s)},ep.inverseCosine=ep.acos=function(){var e,t=this,n=t.constructor,i=t.abs().cmp(1),o=n.precision,r=n.rounding;return -1!==i?0===i?t.isNeg()?eP(n,o,r):new n(0):new n(NaN):t.isZero()?eP(n,o+4,r).times(.5):(n.precision=o+6,n.rounding=1,t=t.asin(),e=eP(n,o+4,r).times(.5),n.precision=o,n.rounding=r,e.minus(t))},ep.inverseHyperbolicCosine=ep.acosh=function(){var e,t,n=this,i=n.constructor;return n.lte(1)?new i(n.eq(1)?0:NaN):n.isFinite()?(e=i.precision,t=i.rounding,i.precision=e+Math.max(Math.abs(n.e),n.sd())+4,i.rounding=1,J=!1,n=n.times(n).minus(1).sqrt().plus(n),J=!0,i.precision=e,i.rounding=t,n.ln()):new i(n)},ep.inverseHyperbolicSine=ep.asinh=function(){var e,t,n=this,i=n.constructor;return!n.isFinite()||n.isZero()?new i(n):(e=i.precision,t=i.rounding,i.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,i.rounding=1,J=!1,n=n.times(n).plus(1).sqrt().plus(n),J=!0,i.precision=e,i.rounding=t,n.ln())},ep.inverseHyperbolicTangent=ep.atanh=function(){var e,t,n,i,o=this,r=o.constructor;return o.isFinite()?o.e>=0?new r(o.abs().eq(1)?o.s/0:o.isZero()?o:NaN):(e=r.precision,t=r.rounding,Math.max(i=o.sd(),e)<-(2*o.e)-1?eb(new r(o),e,t,!0):(r.precision=n=i-o.e,o=ew(o.plus(1),new r(1).minus(o),n+e,1),r.precision=e+4,r.rounding=1,o=o.ln(),r.precision=e,r.rounding=t,o.times(.5))):new r(NaN)},ep.inverseSine=ep.asin=function(){var e,t,n,i,o=this,r=o.constructor;return o.isZero()?new r(o):(t=o.abs().cmp(1),n=r.precision,i=r.rounding,-1!==t?0===t?((e=eP(r,n+4,i).times(.5)).s=o.s,e):new r(NaN):(r.precision=n+6,r.rounding=1,o=o.div(new r(1).minus(o.times(o)).sqrt().plus(1)).atan(),r.precision=n,r.rounding=i,o.times(2)))},ep.inverseTangent=ep.atan=function(){var e,t,n,i,o,r,s,a,u,c=this,l=c.constructor,d=l.precision,m=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&d+4<=em)return(s=eP(l,d+4,m).times(.25)).s=c.s,s}else{if(!c.s)return new l(NaN);if(d+4<=em)return(s=eP(l,d+4,m).times(.5)).s=c.s,s}for(l.precision=a=d+10,l.rounding=1,e=n=Math.min(28,a/7+2|0);e;--e)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(J=!1,t=Math.ceil(a/7),i=1,u=c.times(c),s=new l(c),o=c;-1!==e;)if(o=o.times(u),r=s.minus(o.div(i+=2)),o=o.times(u),void 0!==(s=r.plus(o.div(i+=2))).d[t])for(e=t;s.d[e]===r.d[e]&&e--;);return n&&(s=s.times(2<<n-1)),J=!0,eb(s,l.precision=d,l.rounding=m,!0)},ep.isFinite=function(){return!!this.d},ep.isInteger=ep.isInt=function(){return!!this.d&&er(this.e/7)>this.d.length-2},ep.isNaN=function(){return!this.s},ep.isNegative=ep.isNeg=function(){return this.s<0},ep.isPositive=ep.isPos=function(){return this.s>0},ep.isZero=function(){return!!this.d&&0===this.d[0]},ep.lessThan=ep.lt=function(e){return 0>this.cmp(e)},ep.lessThanOrEqualTo=ep.lte=function(e){return 1>this.cmp(e)},ep.logarithm=ep.log=function(e){var t,n,i,o,r,s,a,u=this.constructor,c=u.precision,l=u.rounding;if(null==e)e=new u(10),t=!0;else{if(n=(e=new u(e)).d,e.s<0||!n||!n[0]||e.eq(1))return new u(NaN);t=e.eq(10)}if(n=this.d,this.s<0||!n||!n[0]||this.eq(1))return new u(n&&!n[0]?-1/0:1!=this.s?NaN:n?0:1/0);if(t){if(n.length>1)o=!0;else{for(i=n[0];i%10==0;)i/=10;o=1!==i}}if(J=!1,ey((a=ew(ex(this,s=c+5),t?eI(u,s+10):ex(e,s),s,1)).d,i=c,l))do if(s+=10,a=ew(ex(this,s),t?eI(u,s+10):ex(e,s),s,1),!o){+eg(a.d).slice(i+1,i+15)+1==1e14&&(a=eb(a,c+1,0));break}while(ey(a.d,i+=10,l));return J=!0,eb(a,c,l)},ep.minus=ep.sub=function(e){var t,n,i,o,r,s,a,u,c,l,d,m,p=this.constructor;if(e=new p(e),!this.d||!e.d)return this.s&&e.s?this.d?e.s=-e.s:e=new p(e.d||this.s!==e.s?this:NaN):e=new p(NaN),e;if(this.s!=e.s)return e.s=-e.s,this.plus(e);if(c=this.d,m=e.d,a=p.precision,u=p.rounding,!c[0]||!m[0]){if(m[0])e.s=-e.s;else{if(!c[0])return new p(3===u?-0:0);e=new p(this)}return J?eb(e,a,u):e}if(n=er(e.e/7),l=er(this.e/7),c=c.slice(),r=l-n){for((d=r<0)?(t=c,r=-r,s=m.length):(t=m,n=l,s=c.length),r>(i=Math.max(Math.ceil(a/7),s)+2)&&(r=i,t.length=1),t.reverse(),i=r;i--;)t.push(0);t.reverse()}else{for((d=(i=c.length)<(s=m.length))&&(s=i),i=0;i<s;i++)if(c[i]!=m[i]){d=c[i]<m[i];break}r=0}for(d&&(t=c,c=m,m=t,e.s=-e.s),s=c.length,i=m.length-s;i>0;--i)c[s++]=0;for(i=m.length;i>r;){if(c[--i]<m[i]){for(o=i;o&&0===c[--o];)c[o]=1e7-1;--c[o],c[i]+=1e7}c[i]-=m[i]}for(;0===c[--s];)c.pop();for(;0===c[0];c.shift())--n;return c[0]?(e.d=c,e.e=eA(c,n),J?eb(e,a,u):e):new p(3===u?-0:0)},ep.modulo=ep.mod=function(e){var t,n=this.constructor;return e=new n(e),this.d&&e.s&&(!e.d||e.d[0])?e.d&&(!this.d||this.d[0])?(J=!1,9==n.modulo?(t=ew(this,e.abs(),0,3,1),t.s*=e.s):t=ew(this,e,0,n.modulo,1),t=t.times(e),J=!0,this.minus(t)):eb(new n(this),n.precision,n.rounding):new n(NaN)},ep.naturalExponential=ep.exp=function(){return eC(this)},ep.naturalLogarithm=ep.ln=function(){return ex(this)},ep.negated=ep.neg=function(){var e=new this.constructor(this);return e.s=-e.s,eb(e)},ep.plus=ep.add=function(e){var t,n,i,o,r,s,a,u,c,l,d=this.constructor;if(e=new d(e),!this.d||!e.d)return this.s&&e.s?this.d||(e=new d(e.d||this.s===e.s?this:NaN)):e=new d(NaN),e;if(this.s!=e.s)return e.s=-e.s,this.minus(e);if(c=this.d,l=e.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(e=new d(this)),J?eb(e,a,u):e;if(r=er(this.e/7),i=er(e.e/7),c=c.slice(),o=r-i){for(o<0?(n=c,o=-o,s=l.length):(n=l,i=r,s=c.length),o>(s=(r=Math.ceil(a/7))>s?r+1:s+1)&&(o=s,n.length=1),n.reverse();o--;)n.push(0);n.reverse()}for((s=c.length)-(o=l.length)<0&&(o=s,n=l,l=c,c=n),t=0;o;)t=(c[--o]=c[o]+l[o]+t)/1e7|0,c[o]%=1e7;for(t&&(c.unshift(t),++i),s=c.length;0==c[--s];)c.pop();return e.d=c,e.e=eA(c,i),J?eb(e,a,u):e},ep.precision=ep.sd=function(e){var t;if(void 0!==e&&!!e!==e&&1!==e&&0!==e)throw Error(et+e);return this.d?(t=eT(this.d),e&&this.e+1>t&&(t=this.e+1)):t=NaN,t},ep.round=function(){var e=this.constructor;return eb(new e(this),this.e+1,e.rounding)},ep.sine=ep.sin=function(){var e,t,n=this,i=n.constructor;return n.isFinite()?n.isZero()?new i(n):(e=i.precision,t=i.rounding,i.precision=e+Math.max(n.e,n.sd())+7,i.rounding=1,n=function(e,t){var n,i=t.d.length;if(i<3)return t.isZero()?t:eR(e,2,t,t);n=(n=1.4*Math.sqrt(i))>16?16:0|n,t=eR(e,2,t=t.times(1/eL(5,n)),t);for(var o,r=new e(5),s=new e(16),a=new e(20);n--;)o=t.times(t),t=t.times(r.plus(o.times(s.times(o).minus(a))));return t}(i,eE(i,n)),i.precision=e,i.rounding=t,eb(j>2?n.neg():n,e,t,!0)):new i(NaN)},ep.squareRoot=ep.sqrt=function(){var e,t,n,i,o,r,s=this.d,a=this.e,u=this.s,c=this.constructor;if(1!==u||!s||!s[0])return new c(!u||u<0&&(!s||s[0])?NaN:s?this:1/0);for(J=!1,0==(u=Math.sqrt(+this))||u==1/0?(((t=eg(s)).length+a)%2==0&&(t+="0"),u=Math.sqrt(t),a=er((a+1)/2)-(a<0||a%2),i=new c(t=u==1/0?"5e"+a:(t=u.toExponential()).slice(0,t.indexOf("e")+1)+a)):i=new c(u.toString()),n=(a=c.precision)+3;;)if(i=(r=i).plus(ew(this,r,n+2,1)).times(.5),eg(r.d).slice(0,n)===(t=eg(i.d)).slice(0,n)){if("9999"!=(t=t.slice(n-3,n+1))&&(o||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(eb(i,a+1,1),e=!i.times(i).eq(this));break}if(!o&&(eb(r,a+1,0),r.times(r).eq(this))){i=r;break}n+=4,o=1}return J=!0,eb(i,a,c.rounding,e)},ep.tangent=ep.tan=function(){var e,t,n=this,i=n.constructor;return n.isFinite()?n.isZero()?new i(n):(e=i.precision,t=i.rounding,i.precision=e+10,i.rounding=1,(n=n.sin()).s=1,n=ew(n,new i(1).minus(n.times(n)).sqrt(),e+10,0),i.precision=e,i.rounding=t,eb(2==j||4==j?n.neg():n,e,t,!0)):new i(NaN)},ep.times=ep.mul=function(e){var t,n,i,o,r,s,a,u,c,l=this.constructor,d=this.d,m=(e=new l(e)).d;if(e.s*=this.s,!d||!d[0]||!m||!m[0])return new l(e.s&&(!d||d[0]||m)&&(!m||m[0]||d)?d&&m?0*e.s:e.s/0:NaN);for(n=er(this.e/7)+er(e.e/7),(u=d.length)<(c=m.length)&&(r=d,d=m,m=r,s=u,u=c,c=s),r=[],i=s=u+c;i--;)r.push(0);for(i=c;--i>=0;){for(t=0,o=u+i;o>i;)a=r[o]+m[i]*d[o-i-1]+t,r[o--]=a%1e7|0,t=a/1e7|0;r[o]=(r[o]+t)%1e7|0}for(;!r[--s];)r.pop();return t?++n:r.shift(),e.d=r,e.e=eA(r,n),J?eb(e,l.precision,l.rounding):e},ep.toBinary=function(e,t){return eF(this,2,e,t)},ep.toDecimalPlaces=ep.toDP=function(e,t){var n=this,i=n.constructor;return n=new i(n),void 0===e?n:(eh(e,0,1e9),void 0===t?t=i.rounding:eh(t,0,8),eb(n,e+n.e+1,t))},ep.toExponential=function(e,t){var n,i=this,o=i.constructor;return void 0===e?n=ek(i,!0):(eh(e,0,1e9),void 0===t?t=o.rounding:eh(t,0,8),n=ek(i=eb(new o(i),e+1,t),!0,e+1)),i.isNeg()&&!i.isZero()?"-"+n:n},ep.toFixed=function(e,t){var n,i,o=this.constructor;return void 0===e?n=ek(this):(eh(e,0,1e9),void 0===t?t=o.rounding:eh(t,0,8),n=ek(i=eb(new o(this),e+this.e+1,t),!1,e+i.e+1)),this.isNeg()&&!this.isZero()?"-"+n:n},ep.toFraction=function(e){var t,n,i,o,r,s,a,u,c,l,d,m,p=this.d,g=this.constructor;if(!p)return new g(this);if(c=n=new g(1),i=u=new g(0),s=(r=(t=new g(i)).e=eT(p)-this.e-1)%7,t.d[0]=es(10,s<0?7+s:s),null==e)e=r>0?t:c;else{if(!(a=new g(e)).isInt()||a.lt(c))throw Error(et+a);e=a.gt(t)?r>0?t:c:a}for(J=!1,a=new g(eg(p)),l=g.precision,g.precision=r=14*p.length;d=ew(a,t,0,1,1),1!=(o=n.plus(d.times(i))).cmp(e);)n=i,i=o,o=c,c=u.plus(d.times(o)),u=o,o=t,t=a.minus(d.times(o)),a=o;return o=ew(e.minus(n),i,0,1,1),u=u.plus(o.times(c)),n=n.plus(o.times(i)),u.s=c.s=this.s,m=1>ew(c,i,r,1).minus(this).abs().cmp(ew(u,n,r,1).minus(this).abs())?[c,i]:[u,n],g.precision=l,J=!0,m},ep.toHexadecimal=ep.toHex=function(e,t){return eF(this,16,e,t)},ep.toNearest=function(e,t){var n=this,i=n.constructor;if(n=new i(n),null==e){if(!n.d)return n;e=new i(1),t=i.rounding}else{if(e=new i(e),void 0===t?t=i.rounding:eh(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(J=!1,n=ew(n,e,0,t,1).times(e),J=!0,eb(n)):(e.s=n.s,n=e),n},ep.toNumber=function(){return+this},ep.toOctal=function(e,t){return eF(this,8,e,t)},ep.toPower=ep.pow=function(e){var t,n,i,o,r,s,a=this,u=a.constructor,c=+(e=new u(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new u(es(+a,c));if((a=new u(a)).eq(1))return a;if(i=u.precision,r=u.rounding,e.eq(1))return eb(a,i,r);if((t=er(e.e/7))>=e.d.length-1&&(n=c<0?-c:c)<=9007199254740991)return o=eB(u,a,n,i),e.s<0?new u(1).div(o):eb(o,i,r);if((s=a.s)<0){if(t<e.d.length-1)return new u(NaN);if((1&e.d[t])==0&&(s=1),0==a.e&&1==a.d[0]&&1==a.d.length)return a.s=s,a}return(t=0!=(n=es(+a,c))&&isFinite(n)?new u(n+"").e:er(c*(Math.log("0."+eg(a.d))/Math.LN10+a.e+1)))>u.maxE+1||t<u.minE-1?new u(t>0?s/0:0):(J=!1,u.rounding=a.s=1,n=Math.min(12,(t+"").length),(o=eC(e.times(ex(a,i+n)),i)).d&&ey((o=eb(o,i+5,1)).d,i,r)&&(t=i+10,+eg((o=eb(eC(e.times(ex(a,t+n)),t),t+5,1)).d).slice(i+1,i+15)+1==1e14&&(o=eb(o,i+1,0))),o.s=s,J=!0,u.rounding=r,eb(o,i,r))},ep.toPrecision=function(e,t){var n,i=this,o=i.constructor;return void 0===e?n=ek(i,i.e<=o.toExpNeg||i.e>=o.toExpPos):(eh(e,1,1e9),void 0===t?t=o.rounding:eh(t,0,8),n=ek(i=eb(new o(i),e,t),e<=i.e||i.e<=o.toExpNeg,e)),i.isNeg()&&!i.isZero()?"-"+n:n},ep.toSignificantDigits=ep.toSD=function(e,t){var n=this.constructor;return void 0===e?(e=n.precision,t=n.rounding):(eh(e,1,1e9),void 0===t?t=n.rounding:eh(t,0,8)),eb(new n(this),e,t)},ep.toString=function(){var e=this.constructor,t=ek(this,this.e<=e.toExpNeg||this.e>=e.toExpPos);return this.isNeg()&&!this.isZero()?"-"+t:t},ep.truncated=ep.trunc=function(){return eb(new this.constructor(this),this.e+1,1)},ep.valueOf=ep.toJSON=function(){var e=this.constructor,t=ek(this,this.e<=e.toExpNeg||this.e>=e.toExpPos);return this.isNeg()?"-"+t:t};var ew=function(){function e(e,t,n){var i,o=0,r=e.length;for(e=e.slice();r--;)i=e[r]*t+o,e[r]=i%n|0,o=i/n|0;return o&&e.unshift(o),e}function t(e,t,n,i){var o,r;if(n!=i)r=n>i?1:-1;else for(o=r=0;o<n;o++)if(e[o]!=t[o]){r=e[o]>t[o]?1:-1;break}return r}function n(e,t,n,i){for(var o=0;n--;)e[n]-=o,o=e[n]<t[n]?1:0,e[n]=o*i+e[n]-t[n];for(;!e[0]&&e.length>1;)e.shift()}return function(i,o,r,s,a,u){var c,l,d,m,p,g,h,y,f,w,b,k,A,I,P,T,S,B,v,K,C=i.constructor,x=i.s==o.s?1:-1,O=i.d,q=o.d;if(!O||!O[0]||!q||!q[0])return new C(i.s&&o.s&&(O?!q||O[0]!=q[0]:q)?O&&0==O[0]||!q?0*x:x/0:NaN);for(u?(p=1,l=i.e-o.e):(u=1e7,p=7,l=er(i.e/p)-er(o.e/p)),v=q.length,S=O.length,w=(f=new C(x)).d=[],d=0;q[d]==(O[d]||0);d++);if(q[d]>(O[d]||0)&&l--,null==r?(I=r=C.precision,s=C.rounding):I=a?r+(i.e-o.e)+1:r,I<0)w.push(1),g=!0;else{if(I=I/p+2|0,d=0,1==v){for(m=0,q=q[0],I++;(d<S||m)&&I--;d++)P=m*u+(O[d]||0),w[d]=P/q|0,m=P%q|0;g=m||d<S}else{for((m=u/(q[0]+1)|0)>1&&(q=e(q,m,u),O=e(O,m,u),v=q.length,S=O.length),T=v,k=(b=O.slice(0,v)).length;k<v;)b[k++]=0;(K=q.slice()).unshift(0),B=q[0],q[1]>=u/2&&++B;do m=0,(c=t(q,b,v,k))<0?(A=b[0],v!=k&&(A=A*u+(b[1]||0)),(m=A/B|0)>1?(m>=u&&(m=u-1),y=(h=e(q,m,u)).length,k=b.length,1==(c=t(h,b,y,k))&&(m--,n(h,v<y?K:q,y,u))):(0==m&&(c=m=1),h=q.slice()),(y=h.length)<k&&h.unshift(0),n(b,h,k,u),-1==c&&(k=b.length,(c=t(q,b,v,k))<1&&(m++,n(b,v<k?K:q,k,u))),k=b.length):0===c&&(m++,b=[0]),w[d++]=m,c&&b[0]?b[k++]=O[T]||0:(b=[O[T]],k=1);while((T++<S||void 0!==b[0])&&I--);g=void 0!==b[0]}w[0]||w.shift()}if(1==p)f.e=l,z=g;else{for(d=1,m=w[0];m>=10;m/=10)d++;f.e=d+l*p-1,eb(f,a?r+f.e+1:r,s,g)}return f}}();function eb(e,t,n,i){var o,r,s,a,u,c,l,d,m,p=e.constructor;e:if(null!=t){if(!(d=e.d))return e;for(o=1,a=d[0];a>=10;a/=10)o++;if((r=t-o)<0)r+=7,s=t,u=(l=d[m=0])/es(10,o-s-1)%10|0;else if((m=Math.ceil((r+1)/7))>=(a=d.length)){if(i){for(;a++<=m;)d.push(0);l=u=0,o=1,r%=7,s=r-7+1}else break e}else{for(l=a=d[m],o=1;a>=10;a/=10)o++;r%=7,u=(s=r-7+o)<0?0:l/es(10,o-s-1)%10|0}if(i=i||t<0||void 0!==d[m+1]||(s<0?l:l%es(10,o-s-1)),c=n<4?(u||i)&&(0==n||n==(e.s<0?3:2)):u>5||5==u&&(4==n||i||6==n&&(r>0?s>0?l/es(10,o-s):0:d[m-1])%10&1||n==(e.s<0?8:7)),t<1||!d[0])return d.length=0,c?(t-=e.e+1,d[0]=es(10,(7-t%7)%7),e.e=-t||0):d[0]=e.e=0,e;if(0==r?(d.length=m,a=1,m--):(d.length=m+1,a=es(10,7-r),d[m]=s>0?(l/es(10,o-s)%es(10,s)|0)*a:0),c)for(;;)if(0==m){for(r=1,s=d[0];s>=10;s/=10)r++;for(s=d[0]+=a,a=1;s>=10;s/=10)a++;r!=a&&(e.e++,1e7==d[0]&&(d[0]=1));break}else{if(d[m]+=a,1e7!=d[m])break;d[m--]=0,a=1}for(r=d.length;0===d[--r];)d.pop()}return J&&(e.e>p.maxE?(e.d=null,e.e=NaN):e.e<p.minE&&(e.e=0,e.d=[0])),e}function ek(e,t,n){if(!e.isFinite())return eO(e);var i,o=e.e,r=eg(e.d),s=r.length;return t?(n&&(i=n-s)>0?r=r.charAt(0)+"."+r.slice(1)+eS(i):s>1&&(r=r.charAt(0)+"."+r.slice(1)),r=r+(e.e<0?"e":"e+")+e.e):o<0?(r="0."+eS(-o-1)+r,n&&(i=n-s)>0&&(r+=eS(i))):o>=s?(r+=eS(o+1-s),n&&(i=n-o-1)>0&&(r=r+"."+eS(i))):((i=o+1)<s&&(r=r.slice(0,i)+"."+r.slice(i)),n&&(i=n-s)>0&&(o+1===s&&(r+="."),r+=eS(i))),r}function eA(e,t){var n=e[0];for(t*=7;n>=10;n/=10)t++;return t}function eI(e,t,n){if(t>ed)throw J=!0,n&&(e.precision=n),Error(en);return eb(new e(Z),t,1,!0)}function eP(e,t,n){if(t>em)throw Error(en);return eb(new e(Y),t,n,!0)}function eT(e){var t=e.length-1,n=7*t+1;if(t=e[t]){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function eS(e){for(var t="";e--;)t+="0";return t}function eB(e,t,n,i){var o,r=new e(1),s=Math.ceil(i/7+4);for(J=!1;;){if(n%2&&eM((r=r.times(t)).d,s)&&(o=!0),0===(n=er(n/2))){n=r.d.length-1,o&&0===r.d[n]&&++r.d[n];break}eM((t=t.times(t)).d,s)}return J=!0,r}function ev(e){return 1&e.d[e.d.length-1]}function eK(e,t,n){for(var i,o=new e(t[0]),r=0;++r<t.length;)if((i=new e(t[r])).s)o[n](i)&&(o=i);else{o=i;break}return o}function eC(e,t){var n,i,o,r,s,a,u,c=0,l=0,d=0,m=e.constructor,p=m.rounding,g=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(null==t?(J=!1,u=g):u=t,a=new m(.03125);e.e>-2;)e=e.times(a),d+=5;for(u+=i=Math.log(es(2,d))/Math.LN10*2+5|0,n=r=s=new m(1),m.precision=u;;){if(r=eb(r.times(e),u,1),n=n.times(++l),eg((a=s.plus(ew(r,n,u,1))).d).slice(0,u)===eg(s.d).slice(0,u)){for(o=d;o--;)s=eb(s.times(s),u,1);if(null!=t)return m.precision=g,s;if(!(c<3&&ey(s.d,u-i,p,c)))return eb(s,m.precision=g,p,J=!0);m.precision=u+=10,n=r=a=new m(1),l=0,c++}s=a}}function ex(e,t){var n,i,o,r,s,a,u,c,l,d,m,p=1,g=e,h=g.d,y=g.constructor,f=y.rounding,w=y.precision;if(g.s<0||!h||!h[0]||!g.e&&1==h[0]&&1==h.length)return new y(h&&!h[0]?-1/0:1!=g.s?NaN:h?0:g);if(null==t?(J=!1,l=w):l=t,y.precision=l+=10,i=(n=eg(h)).charAt(0),!(15e14>Math.abs(r=g.e)))return c=eI(y,l+2,w).times(r+""),g=ex(new y(i+"."+n.slice(1)),l-10).plus(c),y.precision=w,null==t?eb(g,w,f,J=!0):g;for(;i<7&&1!=i||1==i&&n.charAt(1)>3;)i=(n=eg((g=g.times(e)).d)).charAt(0),p++;for(r=g.e,i>1?(g=new y("0."+n),r++):g=new y(i+"."+n.slice(1)),d=g,u=s=g=ew(g.minus(1),g.plus(1),l,1),m=eb(g.times(g),l,1),o=3;;){if(s=eb(s.times(m),l,1),eg((c=u.plus(ew(s,new y(o),l,1))).d).slice(0,l)===eg(u.d).slice(0,l)){if(u=u.times(2),0!==r&&(u=u.plus(eI(y,l+2,w).times(r+""))),u=ew(u,new y(p),l,1),null!=t)return y.precision=w,u;if(!ey(u.d,l-10,f,a))return eb(u,y.precision=w,f,J=!0);y.precision=l+=10,c=s=g=ew(d.minus(1),d.plus(1),l,1),m=eb(g.times(g),l,1),o=a=1}u=c,o+=2}}function eO(e){return String(e.s*e.s/0)}function eq(e,t){var n,i,o;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(i=t.search(/e/i))>0?(n<0&&(n=i),n+=+t.slice(i+1),t=t.substring(0,i)):n<0&&(n=t.length),i=0;48===t.charCodeAt(i);i++);for(o=t.length;48===t.charCodeAt(o-1);--o);if(t=t.slice(i,o)){if(o-=i,e.e=n=n-i-1,e.d=[],i=(n+1)%7,n<0&&(i+=7),i<o){for(i&&e.d.push(+t.slice(0,i)),o-=7;i<o;)e.d.push(+t.slice(i,i+=7));i=7-(t=t.slice(i)).length}else i-=o;for(;i--;)t+="0";e.d.push(+t),J&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function eR(e,t,n,i,o){var r,s,a,u,c=e.precision,l=Math.ceil(c/7);for(J=!1,u=n.times(n),a=new e(i);;){if(s=ew(a.times(u),new e(t++*t++),c,1),a=o?i.plus(s):i.minus(s),i=ew(s.times(u),new e(t++*t++),c,1),void 0!==(s=a.plus(i)).d[l]){for(r=l;s.d[r]===a.d[r]&&r--;);if(-1==r)break}r=a,a=i,i=s,s=r}return J=!0,s.d.length=l+1,s}function eL(e,t){for(var n=e;--t;)n*=e;return n}function eE(e,t){var n,i=t.s<0,o=eP(e,e.precision,1),r=o.times(.5);if((t=t.abs()).lte(r))return j=i?4:1,t;if((n=t.divToInt(o)).isZero())j=i?3:2;else{if((t=t.minus(n.times(o))).lte(r))return j=ev(n)?i?2:3:i?4:1,t;j=ev(n)?i?1:4:i?3:2}return t.minus(o).abs()}function eF(e,t,n,i){var o,r,s,a,u,c,l,d,m,p=e.constructor,g=void 0!==n;if(g?(eh(n,1,1e9),void 0===i?i=p.rounding:eh(i,0,8)):(n=p.precision,i=p.rounding),e.isFinite()){for(s=(l=ek(e)).indexOf("."),g?(o=2,16==t?n=4*n-3:8==t&&(n=3*n-2)):o=t,s>=0&&(l=l.replace(".",""),(m=new p(1)).e=l.length-s,m.d=ef(ek(m),10,o),m.e=m.d.length),r=u=(d=ef(l,10,o)).length;0==d[--u];)d.pop();if(d[0]){if(s<0?r--:((e=new p(e)).d=d,e.e=r,d=(e=ew(e,m,n,i,0,o)).d,r=e.e,c=z),s=d[n],a=o/2,c=c||void 0!==d[n+1],c=i<4?(void 0!==s||c)&&(0===i||i===(e.s<0?3:2)):s>a||s===a&&(4===i||c||6===i&&1&d[n-1]||i===(e.s<0?8:7)),d.length=n,c)for(;++d[--n]>o-1;)d[n]=0,n||(++r,d.unshift(1));for(u=d.length;!d[u-1];--u);for(s=0,l="";s<u;s++)l+=Q.charAt(d[s]);if(g){if(u>1){if(16==t||8==t){for(s=16==t?4:3,--u;u%s;u++)l+="0";for(u=(d=ef(l,o,t)).length;!d[u-1];--u);for(s=1,l="1.";s<u;s++)l+=Q.charAt(d[s])}else l=l.charAt(0)+"."+l.slice(1)}l=l+(r<0?"p":"p+")+r}else if(r<0){for(;++r;)l="0"+l;l="0."+l}else if(++r>u)for(r-=u;r--;)l+="0";else r<u&&(l=l.slice(0,r)+"."+l.slice(r))}else l=g?"0p+0":"0";l=(16==t?"0x":2==t?"0b":8==t?"0o":"")+l}else l=eO(e);return e.s<0?"-"+l:l}function eM(e,t){if(e.length>t)return e.length=t,!0}function eW(e){return new this(e).abs()}function e_(e){return new this(e).acos()}function eD(e){return new this(e).acosh()}function eN(e,t){return new this(e).plus(t)}function eV(e){return new this(e).asin()}function eU(e){return new this(e).asinh()}function eX(e){return new this(e).atan()}function eH(e){return new this(e).atanh()}function eG(e,t){e=new this(e),t=new this(t);var n,i=this.precision,o=this.rounding,r=i+4;return e.s&&t.s?e.d||t.d?!t.d||e.isZero()?(n=t.s<0?eP(this,i,o):new this(0)).s=e.s:!e.d||t.isZero()?(n=eP(this,r,1).times(.5)).s=e.s:t.s<0?(this.precision=r,this.rounding=1,n=this.atan(ew(e,t,r,1)),t=eP(this,r,1),this.precision=i,this.rounding=o,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(ew(e,t,r,1)):(n=eP(this,r,1).times(t.s>0?.25:.75)).s=e.s:n=new this(NaN),n}function ez(e){return new this(e).cbrt()}function ej(e){return eb(e=new this(e),e.e+1,2)}function eQ(e,t,n){return new this(e).clamp(t,n)}function eZ(e){if(!e||"object"!=typeof e)throw Error(ee+"Object expected");var t,n,i,o=!0===e.defaults,r=["precision",1,1e9,"rounding",0,8,"toExpNeg",-9e15,0,"toExpPos",0,9e15,"maxE",0,9e15,"minE",-9e15,0,"modulo",0,9];for(t=0;t<r.length;t+=3)if(n=r[t],o&&(this[n]=$[n]),void 0!==(i=e[n])){if(er(i)===i&&i>=r[t+1]&&i<=r[t+2])this[n]=i;else throw Error(et+n+": "+i)}if(n="crypto",o&&(this[n]=$[n]),void 0!==(i=e[n])){if(!0===i||!1===i||0===i||1===i){if(i){if("u">typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(ei)}else this[n]=!1}else throw Error(et+n+": "+i)}return this}function eY(e){return new this(e).cos()}function e$(e){return new this(e).cosh()}function eJ(e,t){return new this(e).div(t)}function e1(e){return new this(e).exp()}function e0(e){return eb(e=new this(e),e.e+1,3)}function e4(){var e,t,n=new this(0);for(J=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return J=!0,new this(1/0);n=t}return J=!0,n.sqrt()}function e6(e){return e instanceof tg||e&&e.toStringTag===eo||!1}function e2(e){return new this(e).ln()}function e5(e,t){return new this(e).log(t)}function e8(e){return new this(e).log(2)}function e3(e){return new this(e).log(10)}function e7(){return eK(this,arguments,"lt")}function e9(){return eK(this,arguments,"gt")}function te(e,t){return new this(e).mod(t)}function tt(e,t){return new this(e).mul(t)}function tn(e,t){return new this(e).pow(t)}function ti(e){var t,n,i,o,r=0,s=new this(1),a=[];if(void 0===e?e=this.precision:eh(e,1,1e9),i=Math.ceil(e/7),this.crypto){if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(i));r<i;)(o=t[r])>=429e7?t[r]=crypto.getRandomValues(new Uint32Array(1))[0]:a[r++]=o%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(i*=4);r<i;)(o=t[r]+(t[r+1]<<8)+(t[r+2]<<16)+((127&t[r+3])<<24))>=214e7?crypto.randomBytes(4).copy(t,r):(a.push(o%1e7),r+=4);r=i/4}else throw Error(ei)}else for(;r<i;)a[r++]=1e7*Math.random()|0;for(i=a[--r],e%=7,i&&e&&(o=es(10,7-e),a[r]=(i/o|0)*o);0===a[r];r--)a.pop();if(r<0)n=0,a=[0];else{for(n=-1;0===a[0];n-=7)a.shift();for(i=1,o=a[0];o>=10;o/=10)i++;i<7&&(n-=7-i)}return s.e=n,s.d=a,s}function to(e){return eb(e=new this(e),e.e+1,this.rounding)}function tr(e){return(e=new this(e)).d?e.d[0]?e.s:0*e.s:e.s||NaN}function ts(e){return new this(e).sin()}function ta(e){return new this(e).sinh()}function tu(e){return new this(e).sqrt()}function tc(e,t){return new this(e).sub(t)}function tl(){var e=0,t=arguments,n=new this(t[e]);for(J=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return J=!0,eb(n,this.precision,this.rounding)}function td(e){return new this(e).tan()}function tm(e){return new this(e).tanh()}function tp(e){return eb(e=new this(e),e.e+1,1)}ep[Symbol.for("nodejs.util.inspect.custom")]=ep.toString,ep[Symbol.toStringTag]="Decimal";var tg=ep.constructor=function e(t){var n,i,o;function r(e){var t,n,i;if(!(this instanceof r))return new r(e);if(this.constructor=r,e6(e)){this.s=e.s,J?!e.d||e.e>r.maxE?(this.e=NaN,this.d=null):e.e<r.minE?(this.e=0,this.d=[0]):(this.e=e.e,this.d=e.d.slice()):(this.e=e.e,this.d=e.d?e.d.slice():e.d);return}if("number"==(i=typeof e)){if(0===e){this.s=1/e<0?-1:1,this.e=0,this.d=[0];return}if(e<0?(e=-e,this.s=-1):this.s=1,e===~~e&&e<1e7){for(t=0,n=e;n>=10;n/=10)t++;J?t>r.maxE?(this.e=NaN,this.d=null):t<r.minE?(this.e=0,this.d=[0]):(this.e=t,this.d=[e]):(this.e=t,this.d=[e]);return}if(0*e!=0){e||(this.s=NaN),this.e=NaN,this.d=null;return}return eq(this,e.toString())}if("string"!==i)throw Error(et+e);return 45===(n=e.charCodeAt(0))?(e=e.slice(1),this.s=-1):(43===n&&(e=e.slice(1)),this.s=1),el.test(e)?eq(this,e):function(e,t){var n,i,o,r,s,a,u,c,l;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),el.test(t))return eq(e,t)}else if("Infinity"===t||"NaN"===t)return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(eu.test(t))n=16,t=t.toLowerCase();else if(ea.test(t))n=2;else if(ec.test(t))n=8;else throw Error(et+t);for((r=t.search(/p/i))>0?(u=+t.slice(r+1),t=t.substring(2,r)):t=t.slice(2),s=(r=t.indexOf("."))>=0,i=e.constructor,s&&(r=(a=(t=t.replace(".","")).length)-r,o=eB(i,new i(n),r,2*r)),r=l=(c=ef(t,n,1e7)).length-1;0===c[r];--r)c.pop();return r<0?new i(0*e.s):(e.e=eA(c,l),e.d=c,J=!1,s&&(e=ew(e,o,4*a)),u&&(e=e.times(54>Math.abs(u)?es(2,u):tg.pow(2,u))),J=!0,e)}(this,e)}if(r.prototype=ep,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=eZ,r.clone=e,r.isDecimal=e6,r.abs=eW,r.acos=e_,r.acosh=eD,r.add=eN,r.asin=eV,r.asinh=eU,r.atan=eX,r.atanh=eH,r.atan2=eG,r.cbrt=ez,r.ceil=ej,r.clamp=eQ,r.cos=eY,r.cosh=e$,r.div=eJ,r.exp=e1,r.floor=e0,r.hypot=e4,r.ln=e2,r.log=e5,r.log10=e3,r.log2=e8,r.max=e7,r.min=e9,r.mod=te,r.mul=tt,r.pow=tn,r.random=ti,r.round=to,r.sign=tr,r.sin=ts,r.sinh=ta,r.sqrt=tu,r.sub=tc,r.sum=tl,r.tan=td,r.tanh=tm,r.trunc=tp,void 0===t&&(t={}),t&&!0!==t.defaults)for(o=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],n=0;n<o.length;)t.hasOwnProperty(i=o[n++])||(t[i]=this[i]);return r.config(t),r}($);function th({pubkey:e,isSigner:t=!1,isWritable:n=!0}){return{pubkey:e,isWritable:n,isSigner:t}}Z=new tg(Z),Y=new tg(Y);var ty=[th({pubkey:b.H_,isWritable:!1}),th({pubkey:y.SystemProgram.programId,isWritable:!1}),th({pubkey:y.SYSVAR_RENT_PUBKEY,isWritable:!1})];function tf({publicKey:e,transformSol:t}){let n=tw(e.toString());if(n instanceof y.PublicKey)return t&&n.equals(tB)?tS:n;if(t&&n.toString()===tB.toBase58())return tS;if("string"==typeof n){if(n===y.PublicKey.default.toBase58())return y.PublicKey.default;try{return new y.PublicKey(n)}catch{}}throw Error("invalid public key")}function tw(e){try{return new y.PublicKey(e)}catch{return e}}var tb=new y.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),tk=new y.PublicKey("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),tA=new y.PublicKey("SysvarRent111111111111111111111111111111111"),tI=new y.PublicKey("SysvarC1ock11111111111111111111111111111111"),tP=new y.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),tT=(new y.PublicKey("Sysvar1nstructions1111111111111111111111111"),y.SystemProgram.programId),tS=(new y.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),new y.PublicKey("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),new y.PublicKey("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),new y.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),new y.PublicKey("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),new y.PublicKey("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),new y.PublicKey("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),new y.PublicKey("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),new y.PublicKey("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),new y.PublicKey("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),new y.PublicKey("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),new y.PublicKey("So11111111111111111111111111111111111111112")),tB=y.PublicKey.default;function tv(e){return tf({publicKey:e,transformSol:!0})}var tK={chainId:101,address:y.PublicKey.default.toBase58(),programId:b.H_.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},tC={chainId:101,address:"So11111111111111111111111111111111111111112",programId:b.H_.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},tx=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:r=!1}){if(e===tB.toBase58()||e instanceof y.PublicKey&&tB.equals(e)){this.decimals=tC.decimals,this.symbol=tC.symbol,this.name=tC.name,this.mint=new y.PublicKey(tC.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?y.PublicKey.default:tf({publicKey:e}),this.isToken2022=r}equals(e){return this===e||this.mint.equals(e.mint)}};tx.WSOL=new tx(_(W({},tC),{mint:tC.address}));var tO=H("module/fraction"),tq=A(w.Z),tR=A(k),tL={0:tR.ROUND_DOWN,1:tR.ROUND_HALF_UP,2:tR.ROUND_UP},tE={0:w.Z.roundDown,1:w.Z.roundHalfUp,2:w.Z.roundUp},tF=class{constructor(e,t=new f(1)){this.numerator=tG(e),this.denominator=tG(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new tF(this.denominator,this.numerator)}add(e){let t=e instanceof tF?e:new tF(tG(e));return this.denominator.eq(t.denominator)?new tF(this.numerator.add(t.numerator),this.denominator):new tF(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof tF?e:new tF(tG(e));return this.denominator.eq(t.denominator)?new tF(this.numerator.sub(t.numerator),this.denominator):new tF(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof tF?e:new tF(tG(e));return new tF(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof tF?e:new tF(tG(e));return new tF(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||tO.logWithError(`${e} is not an integer.`),e<=0&&tO.logWithError(`${e} is not positive.`),tR.set({precision:e+1,rounding:tL[n]});let i=new tR(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||tO.logWithError(`${e} is not an integer.`),e<0&&tO.logWithError(`${e} is negative.`),tq.DP=e,tq.RM=tE[n]||1,new tq(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}},tM=H("Raydium_price"),tW=class extends tF{constructor(e){var t,n;let{baseToken:i,quoteToken:o,numerator:r,denominator:s}=e;super(r,s),this.baseToken=i,this.quoteToken=o,this.scalar=new tF((t=i.decimals,tH.pow(tG(t))),(n=o.decimals,tH.pow(tG(n))))}get raw(){return new tF(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new tW({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(e){this.quoteToken!==e.baseToken&&tM.logWithError("mul token not equals");let t=super.mul(e);return new tW({baseToken:this.baseToken,quoteToken:e.quoteToken,denominator:t.denominator,numerator:t.numerator})}toSignificant(e=this.quoteToken.decimals,t,n){return this.adjusted.toSignificant(e,t,n)}toFixed(e=this.quoteToken.decimals,t,n){return this.adjusted.toFixed(e,t,n)}},t_=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}};t_.SOL=new t_(tK);var tD=new tF(new f(100)),tN=class extends tF{toSignificant(e=5,t,n){return this.mul(tD).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(tD).toFixed(e,t,n)}},tV=((r=tV||{})[r.ROUND_DOWN=0]="ROUND_DOWN",r[r.ROUND_HALF_UP=1]="ROUND_HALF_UP",r[r.ROUND_UP=2]="ROUND_UP",r),tU=new f(0),tX=new f(1),tH=(new f(2),new f(3),new f(5),new f(10));function tG(e){let t=H("Raydium_parseBigNumberish");if(e instanceof f)return e;if("string"==typeof e){if(e.match(/^-?[0-9]+$/))return new f(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return"number"==typeof e?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=9007199254740991||e<=-9007199254740991)&&t.logWithError(`BigNumberish number overflow: ${e}`),new f(String(e))):"bigint"==typeof e?new f(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new f(0))}function tz(e,t){let n=e.divmod(t);return n.mod.isZero()?n.div:n.div.isNeg()?n.div.isubn(1):n.div.iaddn(1)}new f(100),new f(1e3),new f(1e4);var tj=H("Raydium_amount"),tQ=A(w.Z),tZ=class extends tF{constructor(e,t,n=!0,i){let o=new f(0),r=tH.pow(new f(e.decimals));if(n)o=tG(t);else{let n=new f(0),i=new f(0);if("string"==typeof t||"number"==typeof t||"bigint"==typeof t){let[o,r]=function(e,t){let n="0",i="0";if(e.includes(".")){let o=e.split(".");2===o.length?([n,i]=o,i=i.padEnd(t,"0")):tj.logWithError(`invalid number string, num: ${e}`)}else n=e;return[n,i.slice(0,t)||i]}(t.toString(),e.decimals);n=tG(o),i=tG(r)}o=(n=n.mul(r)).add(i)}super(o,r),this.logger=H(i||"TokenAmount"),this.token=e}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(e){return this.token.equals(e.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(e.raw)}lt(e){return this.token.equals(e.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(e.raw)}add(e){return this.token.equals(e.token)||this.logger.logWithError("add token not equals"),new tZ(this.token,this.raw.add(e.raw))}subtract(e){return this.token.equals(e.token)||this.logger.logWithError("sub token not equals"),new tZ(this.token,this.raw.sub(e.raw))}toSignificant(e=this.token.decimals,t,n=0){return super.toSignificant(e,t,n)}toFixed(e=this.token.decimals,t,n=0){return e>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(e,t,n)}toExact(e={groupSeparator:""}){return tQ.DP=this.token.decimals,new tQ(this.numerator.toString()).div(this.denominator.toString()).toFormat(e)}};function tY(e){return"string"==typeof e?tw(e):Array.isArray(e)?e.map(e=>tY(e)):"object"!=typeof e||null===e||[tx,tZ,y.PublicKey,tF,f,tW,tN].some(t=>"object"==typeof t&&e instanceof t)?e:Object.fromEntries(Object.entries(e).map(([e,t])=>[e,tY(t)]))}var t$=((s=t$||{})[s.V0=0]="V0",s[s.LEGACY=1]="LEGACY",s),tJ={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMarket:"InitMarket",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4CreatePool:"AmmV4CreatePool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",RouteSwap:"RouteSwap",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut"},t1=H("Raydium_txUtil");function t0(e){let t=[],n=[];return e.microLamports&&(t.push(y.ComputeBudgetProgram.setComputeUnitPrice({microLamports:e.microLamports})),n.push(tJ.SetComputeUnitPrice)),e.units&&(t.push(y.ComputeBudgetProgram.setComputeUnitLimit({units:e.units})),n.push(tJ.SetComputeUnitLimit)),{instructions:t,instructionTypes:n}}async function t4(e,t){var n,i;let o=null!=t?t:"confirmed";try{return(null==(i=await (null==(n=e.getLatestBlockhash)?void 0:n.call(e,{commitment:o})))?void 0:i.blockhash)||(await e.getRecentBlockhash(o)).blockhash}catch{return(await e.getRecentBlockhash(o)).blockhash}}function t6(e,t){e.length<1&&t1.logWithError(`no instructions provided: ${e.toString()}`),t.length<1&&t1.logWithError(`no signers provided:, ${t.toString()}`);let n=new y.Transaction;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=t[0],n.add(...e);try{return x.from(n.serialize({verifySignatures:!1})).toString("base64").length<1644}catch{return!1}}async function t2(e,t,n,i=!0){let o=new y.PublicKey("RaydiumSimuLateTransaction11111111111111111"),r=[],s=new y.Transaction;for(let e of(s.feePayer=o,t))t6([...s.instructions,e],[o])||(r.push(s),(s=new y.Transaction).feePayer=o),s.add(e);s.instructions.length>0&&r.push(s);let a=[];try{if((a=await t3(e,r,i)).find(e=>null!==e.err))throw Error("rpc simulateTransaction error")}catch(e){e instanceof Error&&t1.logWithError("failed to simulate for instructions","RPC_ERROR",{message:e.message})}let u=[];for(let e of a)if(t1.debug("simulate result:",e),e.logs){let t=e.logs.filter(e=>e&&e.includes(n));t1.debug("filteredLog:",u),t.length||t1.logWithError("simulate log not match keyword","keyword",n),u.push(...t)}return u}function t5(e,t){let n=RegExp(`"${t}":(\\d+)`,"g").exec(e);return n&&2===n.length?n[1]:t1.logWithError(`simulate log fail to match key", key: ${t}`)}function t8(e,t){let[n,i]=y.PublicKey.findProgramAddressSync(e,t);return{publicKey:n,nonce:i}}async function t3(e,t,n){let i=[];if(n){let n=await e.getLatestBlockhash(),o=[];for(let e of t){e.recentBlockhash=n.blockhash,e.lastValidBlockHeight=n.lastValidBlockHeight;let t=e._compile().serialize(),i=e._serialize(t).toString("base64");o.push(i)}let r=o.map(t=>({methodName:"simulateTransaction",args:e._buildArgs([t],void 0,"base64")})),s=[];for(let e=0;e<Math.ceil(r.length/20);e++)s.push(r.slice(20*e,(e+1)*20));i=await (await Promise.all(s.map(async t=>(await e._rpcBatchRequest(t)).map(e=>e.result.value)))).flat()}else try{i=await Promise.all(t.map(async t=>await (await e.simulateTransaction(t)).value))}catch(e){e instanceof Error&&t1.logWithError("failed to get info for multiple accounts","RPC_ERROR",{message:e.message})}return i}function t7({instructions:e,payer:t,signers:n}){return t6(e,[t,...n])}function t9({instructions:e,payer:t,lookupTableAddressAccount:n,recentBlockhash:i=y.Keypair.generate().publicKey.toString()}){let o=new y.TransactionMessage({payerKey:t,recentBlockhash:i,instructions:e}).compileToV0Message(Object.values(null!=n?n:{}));try{return x.from(new y.VersionedTransaction(o).serialize()).toString("base64").length<1644}catch{return!1}}var ne=e=>x.isBuffer(e)?e:e instanceof Uint8Array?x.from(e.buffer,e.byteOffset,e.byteLength):x.from(e);function nt(e){let t=[];return e.forEach(e=>{e instanceof y.Transaction&&(e.recentBlockhash||(e.recentBlockhash=b.H_.toBase58()),e.feePayer||(e.feePayer=y.Keypair.generate().publicKey));let n=e.serialize({requireAllSignatures:!1,verifySignatures:!1});e instanceof y.VersionedTransaction&&(n=ne(n));let i=n.toString("base64");t.push(i)}),console.log("simulate tx string:",t),t}var nn=H("Raydium_accountInfo_util");async function ni(e,t,n){let{batchRequest:i,commitment:o="confirmed",chunkCount:r=100}=W({batchRequest:!1},n),s=nd(t,r),a=Array(s.length).fill([]);if(i){let t=nd(s.map(t=>({methodName:"getMultipleAccounts",args:e._buildArgs([t.map(e=>e.toBase58())],o,"base64")})),10);a=(await (await Promise.all(t.map(async t=>await e._rpcBatchRequest(t)))).flat()).map(e=>(e.error&&nn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${e.error.message}`),e.result.value.map(e=>{if(e){let{data:t,executable:n,lamports:i,owner:o,rentEpoch:r}=e;return 2!==t.length&&"base64"!==t[1]&&nn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:x.from(t[0],"base64"),executable:n,lamports:i,owner:new y.PublicKey(o),rentEpoch:r}}return null})))}else try{a=await Promise.all(s.map(t=>e.getMultipleAccountsInfo(t,o)))}catch(e){e instanceof Error&&nn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${e.message}`)}return a.flat()}async function no(e,t,n){let i=await ni(e,t.map(e=>e.pubkey),n);return t.map((e,t)=>_(W({},e),{accountInfo:i[t]}))}var nr=((a=nr||{})[a.Uninitialized=0]="Uninitialized",a[a.Mint=1]="Mint",a[a.Account=2]="Account",a);async function ns({connection:e,mints:t,config:n}){var i,o,r;if(0===t.length)return{};let s=await no(e,t.map(e=>({pubkey:tv(e)})),n),a={};for(let e of s){if(!e.accountInfo||e.accountInfo.data.length<I.Bl){console.log("invalid mint account",e.pubkey.toBase58());continue}let t=(0,I.rs)(e.pubkey,e.accountInfo,null==(i=e.accountInfo)?void 0:i.owner);a[e.pubkey.toString()]=_(W({},t),{programId:(null==(o=e.accountInfo)?void 0:o.owner)||b.H_,feeConfig:null!=(r=(0,P.E0)(t))?r:void 0})}return a[y.PublicKey.default.toBase58()]=a[tS.toBase58()],a}async function na({connection:e,address:t}){let n=await ni(e,[...new Set(t.map(e=>e.toString()))].map(e=>new y.PublicKey(e))),i={};for(let e=0;e<t.length;e++){let o=n[e],r=t[e];if(!o)continue;let s=new y.AddressLookupTableAccount({key:r,state:y.AddressLookupTableAccount.deserialize(o.data)});i[r.toString()]=s,nu[r.toString()]=s}return i}var nu={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new y.AddressLookupTableAccount({key:new y.PublicKey("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:y.AddressLookupTableAccount.deserialize(x.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})},nc=class{constructor(e){this.instructions=[],this.endInstructions=[],this.lookupTableAddress=[],this.signers=[],this.instructionTypes=[],this.endInstructionTypes=[],this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.api=e.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var e;let t=(await g.Z.get("https://solanacompass.com/api/fees?cacheFreshTime=300000")).data,{avg:n}=null!=(e=null==t?void 0:t[15])?e:{};if(n)return{units:6e5,microLamports:Math.min(Math.ceil(1e6*n/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=t0(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:r=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...r.filter(e=>e!==y.PublicKey.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return 0===e?await this.buildV0(W({},t||{})):this.build(t)}build(e){var t;let n=new y.Transaction;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,(null==(t=this.owner)?void 0:t.signer)&&!this.signers.some(e=>e.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:n,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async e=>{var t;let{recentBlockHash:i,skipPreflight:o=!0,sendAndConfirm:r}=e||{},s=null!=i?i:await t4(this.connection,this.blockhashCommitment);if(n.recentBlockhash=s,this.signers.length&&n.sign(...this.signers),nt([n]),null!=(t=this.owner)&&t.isKeyPair)return{txId:r?await (0,y.sendAndConfirmTransaction)(this.connection,n,this.signers.find(e=>e.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:o}):await this.connection.sendRawTransaction(n.serialize(),{skipPreflight:o}),signedTx:n};if(this.signAllTransactions){let e=await this.signAllTransactions([n]);return{txId:await this.connection.sendRawTransaction(e[0].serialize(),{skipPreflight:o}),signedTx:e[0]}}throw Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var t;let{extraPreBuildData:n=[],extInfo:i}=e,{transaction:o}=this.build(i),r=n.filter(e=>e.transaction.instructions.length>0),s=[o,...r.map(e=>e.transaction)],a=[this.signers,...r.map(e=>e.signers)],u=[...this.instructionTypes,...r.map(e=>e.instructionTypes).flat()];return null!=(t=this.owner)&&t.signer&&a.forEach(e=>{e.some(e=>e.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async e=>{var t;let{sequentially:n,onTxUpdate:i,recentBlockHash:o,skipPreflight:r=!0}=e||{},u=null!=o?o:await t4(this.connection,this.blockhashCommitment);if(null!=(t=this.owner)&&t.isKeyPair){if(n){let e=[];for(let t of s){let n=await (0,y.sendAndConfirmTransaction)(this.connection,t,this.signers.find(e=>e.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:r});e.push(n)}return{txIds:e,signedTxs:s}}return{txIds:await await Promise.all(s.map(async e=>(e.recentBlockhash=u,await this.connection.sendRawTransaction(e.serialize(),{skipPreflight:r})))),signedTxs:s}}if(this.signAllTransactions){let e=s.map((e,t)=>(e.recentBlockhash=u,a[t].length&&e.sign(...a[t]),e));nt(e);let t=await this.signAllTransactions(e);if(n){let e=0,n=[],o=async()=>{if(!t[e])return;let s=await this.connection.sendRawTransaction(t[e].serialize(),{skipPreflight:r});n.push({txId:s,status:"sent",signedTx:t[e]}),null==i||i([...n]),e++,this.connection.onSignature(s,e=>{let t=n.findIndex(e=>e.txId===s);t>-1&&(n[t].status=e.err?"error":"success"),null==i||i([...n]),e.err||o()},"processed"),this.connection.getSignatureStatus(s)};return await o(),{txIds:n.map(e=>e.txId),signedTxs:t}}{let e=[];for(let n=0;n<t.length;n+=1){let i=await this.connection.sendRawTransaction(t[n].serialize(),{skipPreflight:r});e.push(i)}return{txIds:e,signedTxs:t}}}throw Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return 0===t?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var t;let n=e||{},{lookupTableCache:i={},lookupTableAddress:o=[],forerunCreate:r}=n,s=D(n,["lookupTableCache","lookupTableAddress","forerunCreate"]),a=W(W({},"devnet"===this.cluster?{}:nu),i),u=Array.from(new Set([...o,...this.lookupTableAddress])),c=[];for(let e of u)void 0===a[e]&&c.push(new y.PublicKey(e));for(let[e,t]of Object.entries(await na({connection:this.connection,address:c})))a[e]=t;let l=new y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:r?y.PublicKey.default.toBase58():await t4(this.connection,this.blockhashCommitment),instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));(null==(t=this.owner)?void 0:t.signer)&&!this.signers.some(e=>e.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let d=new y.VersionedTransaction(l);return d.sign(this.signers),{builder:this,transaction:d,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async e=>{var t;let{recentBlockHash:n,skipPreflight:i=!0,sendAndConfirm:o}=e||{};if(n&&(d.message.recentBlockhash=n),nt([d]),null!=(t=this.owner)&&t.isKeyPair){let e=await this.connection.sendTransaction(d,{skipPreflight:i});if(o){let{lastValidBlockHeight:t,blockhash:n}=await this.connection.getLatestBlockhash({commitment:this.blockhashCommitment});await this.connection.confirmTransaction({blockhash:n,lastValidBlockHeight:t,signature:e},"confirmed")}return{txId:e,signedTx:d}}if(this.signAllTransactions){let e=await this.signAllTransactions([d]);return{txId:await this.connection.sendTransaction(e[0],{skipPreflight:i}),signedTx:e[0]}}throw Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var t;let{extraPreBuildData:n=[],buildProps:i}=e,{transaction:o}=await this.buildV0(i),r=n.filter(e=>e.builder.instructions.length>0),s=[o,...r.map(e=>e.transaction)],a=[this.signers,...r.map(e=>e.signers)],u=[...this.instructionTypes,...r.map(e=>e.instructionTypes).flat()];return null!=(t=this.owner)&&t.signer&&a.forEach(e=>{e.some(e=>e.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(e,t)=>{e.sign(a[t])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:i,execute:async e=>{var t;let{sequentially:n,onTxUpdate:i,recentBlockHash:o,skipPreflight:r=!0}=e||{};if(o&&s.forEach(e=>e.message.recentBlockhash=o),nt(s),null!=(t=this.owner)&&t.isKeyPair){if(n){let e=[];for(let t of s){let n=await this.connection.sendTransaction(t,{skipPreflight:r}),{lastValidBlockHeight:i,blockhash:o}=await this.connection.getLatestBlockhash({commitment:this.blockhashCommitment});await this.connection.confirmTransaction({blockhash:o,lastValidBlockHeight:i,signature:n},"confirmed"),e.push(n)}return{txIds:e,signedTxs:s}}return{txIds:await Promise.all(s.map(async e=>await this.connection.sendTransaction(e,{skipPreflight:r}))),signedTxs:s}}if(this.signAllTransactions){let e=await this.signAllTransactions(s);if(n){let t=0,n=[],o=async()=>{if(!e[t])return;let s=await this.connection.sendTransaction(e[t],{skipPreflight:r});n.push({txId:s,status:"sent",signedTx:e[t]}),null==i||i([...n]),t++,this.connection.onSignature(s,e=>{let t=n.findIndex(e=>e.txId===s);t>-1&&(n[t].status=e.err?"error":"success"),null==i||i([...n]),e.err||o()},"processed"),this.connection.getSignatureStatus(s)};return o(),{txIds:[],signedTxs:e}}{let t=[];for(let n=0;n<e.length;n+=1){let i=await this.connection.sendTransaction(e[n],{skipPreflight:r});t.push(i)}return{txIds:t,signedTxs:e}}}throw Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuild(e){var t;let n=e||{},{computeBudgetConfig:i}=n,o=D(n,["computeBudgetConfig"]),r=i?t0(i):{instructions:[],instructionTypes:[]},s=this.signers.reduce((e,t)=>_(W({},e),{[t.publicKey.toBase58()]:t}),{}),a=[],u=[],c=[];if(this.allInstructions.forEach(e=>{let t=[...c,e],n=i?[...r.instructions,...t]:t,o=[...new Set(t.map(e=>e.keys.filter(e=>e.isSigner).map(e=>e.pubkey.toString())).flat()).values()].map(e=>new y.PublicKey(e));if(c.length<12&&t7({instructions:n,payer:this.feePayer,signers:o})||t7({instructions:t,payer:this.feePayer,signers:o}))c.push(e);else{if(0===c.length)throw Error("item ins too big");t7({instructions:i?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:o})?a.push(new y.Transaction().add(...r.instructions,...c)):a.push(new y.Transaction().add(...c)),u.push(Array.from(new Set(c.map(e=>e.keys.filter(e=>e.isSigner).map(e=>e.pubkey.toString())).flat())).map(e=>s[e]).filter(e=>void 0!==e)),c=[e]}}),c.length>0){let e=[...new Set(c.map(e=>e.keys.filter(e=>e.isSigner).map(e=>e.pubkey.toString())).flat()).values()].map(e=>s[e]).filter(e=>void 0!==e);t7({instructions:i?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:e.map(e=>e.publicKey)})?a.push(new y.Transaction().add(...r.instructions,...c)):a.push(new y.Transaction().add(...c)),u.push(e)}return a.forEach(e=>e.feePayer=this.feePayer),null!=(t=this.owner)&&t.signer&&u.forEach(e=>{e.some(e=>e.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:a,signers:u,instructionTypes:this.instructionTypes,execute:async e=>{var t;let{sequentially:n,onTxUpdate:i,recentBlockHash:o,skipPreflight:r=!0}=e||{},s=null!=o?o:await t4(this.connection,this.blockhashCommitment);if(a.forEach(async(e,t)=>{e.recentBlockhash=s,u[t].length&&e.sign(...u[t])}),nt(a),null!=(t=this.owner)&&t.isKeyPair){if(n){let e=[];for(let t of a){let n=await (0,y.sendAndConfirmTransaction)(this.connection,t,this.signers.find(e=>e.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:r});e.push(n)}return{txIds:e,signedTxs:a}}return{txIds:await Promise.all(a.map(async e=>await this.connection.sendRawTransaction(e.serialize(),{skipPreflight:r}))),signedTxs:a}}if(this.signAllTransactions){let e=await this.signAllTransactions(a);if(n){let t=0,n=[],o=async()=>{if(!e[t])return;let s=await this.connection.sendRawTransaction(e[t].serialize(),{skipPreflight:r});n.push({txId:s,status:"sent",signedTx:e[t]}),null==i||i([...n]),t++,this.connection.onSignature(s,e=>{let t=n.findIndex(e=>e.txId===s);t>-1&&(n[t].status=e.err?"error":"success"),null==i||i([...n]),e.err||o()},"processed"),this.connection.getSignatureStatus(s)};return await o(),{txIds:n.map(e=>e.txId),signedTxs:e}}{let t=[];for(let n=0;n<e.length;n+=1){let i=await this.connection.sendRawTransaction(e[n].serialize(),{skipPreflight:r});t.push(i)}return{txIds:t,signedTxs:e}}}throw Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}async sizeCheckBuildV0(e){var t;let n=e||{},{computeBudgetConfig:i,lookupTableCache:o={},lookupTableAddress:r=[]}=n,s=D(n,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),a=W(W({},"devnet"===this.cluster?{}:nu),o),u=Array.from(new Set([...this.lookupTableAddress,...r])),c=[];for(let e of u)void 0===a[e]&&c.push(new y.PublicKey(e));for(let[e,t]of Object.entries(await na({connection:this.connection,address:c})))a[e]=t;let l=i?t0(i):{instructions:[],instructionTypes:[]},d=await t4(this.connection,this.blockhashCommitment),m=this.signers.reduce((e,t)=>_(W({},e),{[t.publicKey.toBase58()]:t}),{}),p=[],g=[],h=[];if(this.allInstructions.forEach(e=>{let t=[...h,e],n=i?[...l.instructions,...t]:t;if(h.length<12&&t9({instructions:n,payer:this.feePayer,lookupTableAddressAccount:a})||t9({instructions:t,payer:this.feePayer,lookupTableAddressAccount:a}))h.push(e);else{if(0===h.length)throw Error("item ins too big");let t={};for(let e of[...new Set(u)])void 0!==a[e]&&(t[e]=a[e]);if(i&&t9({instructions:[...l.instructions,...h],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let e=new y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:d,instructions:[...l.instructions,...h]}).compileToV0Message(Object.values(a));p.push(new y.VersionedTransaction(e))}else{let e=new y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:d,instructions:[...h]}).compileToV0Message(Object.values(a));p.push(new y.VersionedTransaction(e))}g.push(Array.from(new Set(h.map(e=>e.keys.filter(e=>e.isSigner).map(e=>e.pubkey.toString())).flat())).map(e=>m[e]).filter(e=>void 0!==e)),h=[e]}}),h.length>0){let e=[...new Set(h.map(e=>e.keys.filter(e=>e.isSigner).map(e=>e.pubkey.toString())).flat()).values()].map(e=>m[e]).filter(e=>void 0!==e);if(i&&t9({instructions:[...l.instructions,...h],payer:this.feePayer,lookupTableAddressAccount:a,recentBlockhash:d})){let e=new y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:d,instructions:[...l.instructions,...h]}).compileToV0Message(Object.values(a));p.push(new y.VersionedTransaction(e))}else{let e=new y.TransactionMessage({payerKey:this.feePayer,recentBlockhash:d,instructions:[...h]}).compileToV0Message(Object.values(a));p.push(new y.VersionedTransaction(e))}g.push(e)}return null!=(t=this.owner)&&t.signer&&g.forEach(e=>{e.some(e=>e.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:p,buildProps:e,signers:g,instructionTypes:this.instructionTypes,execute:async e=>{var t;let{sequentially:n,onTxUpdate:i,recentBlockHash:o,skipPreflight:r=!0}=e||{};if(p.map(async(e,t)=>{g[t].length&&e.sign(g[t]),o&&(e.message.recentBlockhash=o)}),nt(p),null!=(t=this.owner)&&t.isKeyPair){if(n){let e=[];for(let t of p){let n=await this.connection.sendTransaction(t,{skipPreflight:r}),{lastValidBlockHeight:i,blockhash:o}=await this.connection.getLatestBlockhash({commitment:this.blockhashCommitment});await this.connection.confirmTransaction({blockhash:o,lastValidBlockHeight:i,signature:n},"confirmed"),e.push(n)}return{txIds:e,signedTxs:p}}return{txIds:await Promise.all(p.map(async e=>await this.connection.sendTransaction(e,{skipPreflight:r}))),signedTxs:p}}if(this.signAllTransactions){let e=await this.signAllTransactions(p);if(n){let t=0,n=[],o=async()=>{if(!e[t])return;let s=await this.connection.sendTransaction(e[t],{skipPreflight:r});n.push({txId:s,status:"sent",signedTx:e[t]}),null==i||i([...n]),t++,this.connection.onSignature(s,e=>{let t=n.findIndex(e=>e.txId===s);t>-1&&(n[t].status=e.err?"error":"success"),null==i||i([...n]),e.err||o()},"processed"),this.connection.getSignatureStatus(s)};return o(),{txIds:[],signedTxs:e}}{let t=[];for(let n=0;n<e.length;n+=1){let i=await this.connection.sendTransaction(e[n],{skipPreflight:r});t.push(i)}return{txIds:t,signedTxs:e}}}throw Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}},nl=class{constructor(e){this._owner=e}get publicKey(){return nl.isKeyPair(this._owner)?this._owner.publicKey:this._owner}get signer(){return nl.isKeyPair(this._owner)?this._owner:void 0}get isKeyPair(){return nl.isKeyPair(this._owner)}get isPublicKey(){return nl.isPublicKey(this._owner)}static isKeyPair(e){return void 0!==e.secretKey}static isPublicKey(e){return!nl.isKeyPair(e)}};function nd(e,t=1,n=[]){let i=[...e];if(t<=0)return n;for(;i.length;)n.push(i.splice(0,t));return n}var nm=new y.PublicKey("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),np=new y.PublicKey("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),ng=new y.PublicKey("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),nh=(new y.PublicKey("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),new y.PublicKey("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),new y.PublicKey("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin")),ny=new y.PublicKey("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),nf=(new y.PublicKey("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),new y.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo")),nw=new y.PublicKey("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),nb=(new y.PublicKey("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),new y.PublicKey("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),new y.PublicKey("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF")),nk=new y.PublicKey("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),nA=new y.PublicKey("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),nI=new y.PublicKey("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),nP=new y.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),nT=(new y.PublicKey("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),new y.PublicKey("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),new y.PublicKey("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),new y.PublicKey("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),new y.PublicKey("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),{IDO_PROGRAM_ID_V1:nb,IDO_PROGRAM_ID_V2:nk,IDO_PROGRAM_ID_V3:nA,IDO_PROGRAM_ID_V4:nI});function nS(e,t,n){return t8([e.toBuffer(),(null!=n?n:b.H_).toBuffer(),t.toBuffer()],new y.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}function nB(e,t,n,i){if(void 0===t)return{amount:e,fee:void 0,expirationTime:void 0};let o=_(W({},t),{olderTransferFee:{epoch:BigInt(t.olderTransferFee.epoch),maximumFee:BigInt(t.olderTransferFee.maximumFee),transferFeeBasisPoints:t.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(t.newerTransferFee.epoch),maximumFee:BigInt(t.newerTransferFee.maximumFee),transferFeeBasisPoints:t.newerTransferFee.transferFeeBasisPoints}}),r=n.epoch<o.newerTransferFee.epoch?o.olderTransferFee:o.newerTransferFee,s=new f(r.maximumFee.toString()),a=n.epoch<o.newerTransferFee.epoch?(Number(o.newerTransferFee.epoch)*n.slotsInEpoch-n.absoluteSlot)*400/1e3:void 0;if(i){if(1e4===r.transferFeeBasisPoints){let t=new f(r.maximumFee.toString());return{amount:e.add(t),fee:t,expirationTime:a}}{let t=nK(e.mul(new f(1e4)),new f(1e4-r.transferFeeBasisPoints)),n=new f(r.maximumFee.toString()),i=t.sub(e).gt(n)?e.add(n):t,o=nK(i.mul(new f(r.transferFeeBasisPoints)),new f(1e4));return{amount:i,fee:o.gt(s)?s:o,expirationTime:a}}}{let t=nK(e.mul(new f(r.transferFeeBasisPoints)),new f(1e4));return{amount:e,fee:t.gt(s)?s:t,expirationTime:a}}}function nv(e,t){return void 0===e?t:void 0===t?e:Math.min(e,t)}function nK(e,t){let{div:n,mod:i}=e.divmod(t);return i.gt(new f(0))?n.add(new f(1)):n}y.PublicKey.default,new y.PublicKey("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),y.PublicKey.default,new y.PublicKey("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),new y.PublicKey("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),new y.PublicKey("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),new y.PublicKey("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),new y.PublicKey("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),new y.PublicKey("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),new y.PublicKey("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),new y.PublicKey("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR");var nC=((u=nC||{}).ALL="all",u.Strict="strict",u),nx=((c=nx||{}).All="all",c.Standard="standard",c.Concentrated="concentrated",c.AllFarm="allFarm",c.StandardFarm="standardFarm",c.ConcentratedFarm="concentratedFarm",c),nO={BASE_HOST:"https://api-v3.raydium.io",OWNER_BASE_HOST:"https://owner-v1.raydium.io",SERVICE_BASE_HOST:"https://service.raydium.io",SEND_TRANSACTION:"/send-transaction",FARM_ARP:"/main/farm/info",FARM_ARP_LINE:"/main/farm-apr-tv",CLMM_CONFIG:"/main/clmm-config",VERSION:"/main/version",CHECK_AVAILABILITY:"/v3/main/AvailabilityCheckAPI",RPCS:"/main/rpcs",INFO:"/main/info",STAKE_POOLS:"/main/stake-pools",CHAIN_TIME:"/main/chain-time",TOKEN_LIST:"/mint/list",MINT_INFO_ID:"/mint/ids",JUP_TOKEN_LIST:"https://token.jup.ag/{type}",POOL_LIST:"/pools/info/list",POOL_SEARCH_BY_ID:"/pools/info/ids",POOL_SEARCH_MINT:"/pools/info/mint",POOL_SEARCH_LP:"/pools/info/lps",POOL_KEY_BY_ID:"/pools/key/ids",POOL_LIQUIDITY_LINE:"/pools/line/liquidity",POOL_POSITION_LINE:"/pools/line/position",FARM_INFO:"/farms/info/ids",FARM_LP_INFO:"/farms/info/lp",FARM_KEYS:"/farms/key/ids",OWNER_CREATED_FARM:"/create-pool/{owner}",OWNER_IDO:"/main/ido/{owner}",OWNER_STAKE_FARMS:"/position/stake/{owner}",IDO_KEYS:"/ido/key/ids",SWAP_HOST:"https://transaction-v1.raydium.io",SWAP_COMPUTE:"/compute/",SWAP_TX:"/transaction/",MINT_PRICE:"/mint/price",MIGRATE_CONFIG:"/main/migrate-lp",PRIORITY_FEE:"/main/auto-fee",JITO:"https://mainnet.block-engine.jito.wtf",JITO_TRANSACTION:"/api/v1/transactions",JITO_BUNDLE:"/api/v1/bundles"};W({},nO);var nq="ray_tab_hash",nR="ray_req_hash",nL=()=>{let e=sessionStorage.getItem(nq);return e||(e=`ray-${Date.now()}`,sessionStorage.setItem(nq,e)),e},nE=async e=>{var{logCount:t=1e3,removeLastLog:n}=e,i=D(e,["logCount","removeLastLog"]);let o=JSON.parse(localStorage.getItem(nR)||"[]").slice(0,t-1);n&&o.pop(),new Blob([JSON.stringify(i.data)]).size>1024&&(i.data=JSON.stringify(i.data).substring(0,200)+"..."),o.unshift(_(W({},i),{time:Date.now(),session:nL()}));try{localStorage.setItem(nR,JSON.stringify(o))}catch{if(n){let e=!1,t=JSON.stringify(i.data).substring(0,100);for(o[0].data=t+(t.length>100?"...":"");!e;){o.pop();let t=JSON.stringify(i.data).substring(0,100);o[0].data=t+(t.length>100?"...":"");try{localStorage.setItem(nR,JSON.stringify(o)),e=!0}catch{e=!1}}return new Promise(e=>e())}return nE(_(W({},i),{logCount:t,removeLastLog:!0}))}},nF=H("Raydium_Api"),nM=new Map,nW=class{constructor({cluster:e,timeout:t,logRequests:n,logCount:i,urlConfigs:o}){this.cluster=e,this.urlConfigs=o||{},this.logCount=i||1e3,this.api=g.Z.create({baseURL:this.urlConfigs.BASE_HOST||nO.BASE_HOST,timeout:t}),this.api.interceptors.request.use(e=>{let{method:t,baseURL:n,url:i}=e;return nF.debug(`${null==t?void 0:t.toUpperCase()} ${n}${i}`),e},e=>(nF.error("Request failed"),Promise.reject(e))),this.api.interceptors.response.use(e=>{let{config:t,data:i,status:o}=e,{method:r,baseURL:s,url:a}=t;return n&&nE({status:o,url:`${s}${a}`,params:t.params,data:i,logCount:this.logCount}),nF.debug(`${null==r?void 0:r.toUpperCase()} ${s}${a}  ${o}`),i},e=>{let{config:t,response:i={}}=e,{status:o}=i,{method:r,baseURL:s,url:a}=t;return n&&nE({status:o,url:`${s}${a}`,params:t.params,data:e.message,logCount:this.logCount}),nF.error(`${r.toUpperCase()} ${s}${a} ${o||e.message}`),Promise.reject(e)})}async getClmmConfigs(){return(await this.api.get(this.urlConfigs.CLMM_CONFIG||nO.CLMM_CONFIG)).data}async getClmmPoolLines(e){return(await this.api.get(`${this.urlConfigs.POOL_LIQUIDITY_LINE||nO.POOL_LIQUIDITY_LINE}?pool_id=${e}`)).data}async getBlockSlotCountForSecond(e){if(!e)return 2;let t=(await g.Z.post(e,{id:"getRecentPerformanceSamples",jsonrpc:"2.0",method:"getRecentPerformanceSamples",params:[4]})).result.map(e=>e.numSlots);return t.reduce((e,t)=>e+t,0)/t.length/60}async getChainTimeOffset(){return(await this.api.get(this.urlConfigs.CHAIN_TIME||nO.CHAIN_TIME)).data}async getRpcs(){return this.api.get(this.urlConfigs.RPCS||nO.RPCS)}async getTokenList(){return(await this.api.get(this.urlConfigs.TOKEN_LIST||nO.TOKEN_LIST)).data}async getJupTokenList(e){return this.api.get("",{baseURL:(this.urlConfigs.JUP_TOKEN_LIST||nO.JUP_TOKEN_LIST).replace("{type}",e||"all")})}async getTokenInfo(e){return(await this.api.get((this.urlConfigs.MINT_INFO_ID||nO.MINT_INFO_ID)+`?mints=${e.map(e=>e.toString()).join(",")}`)).data}async getPoolList(e={}){let{type:t="all",sort:n="liquidity",order:i="desc",page:o=0,pageSize:r=100}=e;return(await this.api.get((this.urlConfigs.POOL_LIST||nO.POOL_LIST)+`?poolType=${t}&poolSortField=${n}&sortType=${i}&page=${o}&pageSize=${r}`)).data}async fetchPoolById(e){let{ids:t}=e;return(await this.api.get((this.urlConfigs.POOL_SEARCH_BY_ID||nO.POOL_SEARCH_BY_ID)+`?ids=${t}`)).data}async fetchPoolKeysById(e){let{idList:t}=e,n=[],i=t.filter(e=>!nM.has(e)||(n.push(nM.get(e)),!1)),o=[];return i.length&&(o=(await this.api.get((this.urlConfigs.POOL_KEY_BY_ID||nO.POOL_KEY_BY_ID)+`?ids=${i.join(",")}`)).data.filter(Boolean)).forEach(e=>{nM.set(e.id,e)}),n.concat(o)}async fetchPoolByMints(e){let{mint1:t,mint2:n,type:i="all",sort:o="default",order:r="desc",page:s=1}=e,[a,u]=[t&&tv(t).toBase58(),n&&"undefined"!==n?tv(n).toBase58():""],[c,l]=u&&a>u?[u,a]:[a,u];return(await this.api.get((this.urlConfigs.POOL_SEARCH_MINT||nO.POOL_SEARCH_MINT)+`?mint1=${c}&mint2=${l}&poolType=${i}&poolSortField=${o}&sortType=${r}&pageSize=100&page=${s}`)).data}async fetchFarmInfoById(e){let{ids:t}=e;return(await this.api.get((this.urlConfigs.FARM_INFO||nO.FARM_INFO)+`?ids=${t}`)).data}async fetchFarmKeysById(e){let{ids:t}=e;return(await this.api.get((this.urlConfigs.FARM_KEYS||nO.FARM_KEYS)+`?ids=${t}`)).data}async fetchAvailabilityStatus(){return(await this.api.get(this.urlConfigs.CHECK_AVAILABILITY||nO.CHECK_AVAILABILITY)).data}async sendTxToJito(e,t){let n=t?this.urlConfigs.JITO_BUNDLE||nO.JITO_BUNDLE:this.urlConfigs.JITO_TRANSACTION||nO.JITO_TRANSACTION;return(await this.api.post(n,{jsonrpc:"2.0",id:1,method:t?"sendBundle":"sendTransaction",params:e},{baseURL:this.urlConfigs.JITO||nO.JITO})).data}},n_="please provide owner in load() initialization or you can set by calling raydium.setOwner(owner)",nD=(...e)=>e.map(e=>{try{return"object"==typeof e?JSON.stringify(e):e}catch{return e}}).join(", "),nN=class{constructor({scope:e,moduleName:t}){this.disabled=!1,this.scope=e,this.logger=H(t)}createTxBuilder(e){return this.scope.checkOwner(),new nc({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(nD(e))}logInfo(...e){this.logger.info(nD(e))}logAndCreateError(...e){throw Error(nD(e))}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}},nV=C.Ar,nU=C.vA,nX=C.fP,nH=C.u8,nG=C.KB,nz=C.Jq,nj=C._O,nQ=C.Xo,nZ=C.A9,nY=C.Ik,n$=C.pc,nJ=class extends nV{constructor(e,t,n){super(e,n),this.blob=nY(e),this.signed=t}decode(e,t=0){let n=new f(this.blob.decode(e,t),10,"le");return this.signed?n.fromTwos(8*this.span).clone():n}encode(e,t,n=0){return"number"==typeof e&&(e=new f(e)),this.signed&&(e=e.toTwos(8*this.span)),this.blob.encode(e.toArrayLike(x,"le",this.span),t,n)}},n1=class extends nV{constructor(e){super(8,e),this._lower=n$(nz(),!1),this._upper=n$(nz(),!1)}addBoolean(e){this._lower.fields.length<32?this._lower.addBoolean(e):this._upper.addBoolean(e)}decode(e,t=0){let n=this._lower.decode(e,t),i=this._upper.decode(e,t+this._lower.span);return W(W({},n),i)}encode(e,t,n=0){return this._lower.encode(e,t,n)+this._upper.encode(e,t,n+this._lower.span)}};function n0(e){return new nX(1,e)}function n4(e){return new nX(4,e)}function n6(e){return new nJ(8,!1,e)}function n2(e){return new nJ(16,!1,e)}function n5(e){return new nJ(8,!0,e)}var n8=class extends nV{constructor(e,t,n,i){super(e.span,i),this.layout=e,this.decoder=t,this.encoder=n}decode(e,t){return this.decoder(this.layout.decode(e,t))}encode(e,t,n){return this.layout.encode(this.encoder(e),t,n)}getSpan(e,t){return this.layout.getSpan(e,t)}};function n3(e){return new n8(nY(32),e=>new y.PublicKey(e),e=>e.toBuffer(),e)}function n7(e){return new n8(nH(),n9,ie,e)}function n9(e){if(0===e)return!1;if(1===e)return!0;throw Error("Invalid bool: "+e)}function ie(e){return e?1:0}var it=class extends nU{decode(e,t){return super.decode(e,t)}};function ii(e,t,n){return new it(e,t,n)}function io(e,t,n){let i;return nZ(e,"number"==typeof t?t:(0,f.isBN)(t)?t.toNumber():new Proxy(t,{get(e,t){if(!i){let t=Reflect.get(e,"count");i=(0,f.isBN)(t)?t.toNumber():t,Reflect.set(e,"count",i)}return Reflect.get(e,t)},set:(e,t,n)=>("count"===t&&(i=n),Reflect.set(e,t,n))}),n)}var ir=ii([n3("mint"),n3("owner"),n6("amount"),n4("delegateOption"),n3("delegate"),n0("state"),n4("isNativeOption"),n6("isNative"),n6("delegatedAmount"),n4("closeAuthorityOption"),n3("closeAuthority")]);function is(e,...t){if(!(e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function ia(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}var iu=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),ic=(e,t)=>e<<32-t|e>>>t;function il(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}(e)),is(e),e}new Uint8Array(new Uint32Array([287454020]).buffer)[0];var id=class{clone(){return this._cloneInto()}},im=(e,t,n)=>e&t^~e&n,ip=(e,t,n)=>e&t^e&n^t&n,ig=class extends id{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=iu(this.buffer)}update(e){ia(this);let{view:t,buffer:n,blockLen:i}=this,o=(e=il(e)).length;for(let r=0;r<o;){let s=Math.min(i-this.pos,o-r);if(s===i){let t=iu(e);for(;i<=o-r;r+=i)this.process(t,r);continue}n.set(e.subarray(r,r+s),this.pos),this.pos+=s,r+=s,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ia(this),function(e,t){is(e);let n=t.outputLen;if(e.length<n)throw Error(`digestInto() expects output buffer of length at least ${n}`)}(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:i,isLE:o}=this,{pos:r}=this;t[r++]=128,this.buffer.subarray(r).fill(0),this.padOffset>i-r&&(this.process(n,0),r=0);for(let e=r;e<i;e++)t[e]=0;(function(e,t,n,i){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,i);let o=BigInt(32),r=BigInt(4294967295),s=Number(n>>o&r),a=Number(n&r),u=i?4:0,c=i?0:4;e.setUint32(t+u,s,i),e.setUint32(t+c,a,i)})(n,i-8,BigInt(8*this.length),o),this.process(n,0);let s=iu(e),a=this.outputLen;if(a%4)throw Error("_sha2: outputLen should be aligned to 32bit");let u=a/4,c=this.get();if(u>c.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<u;e++)s.setUint32(4*e,c[e],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:i,finished:o,destroyed:r,pos:s}=this;return e.length=i,e.pos=s,e.finished=o,e.destroyed=r,i%t&&e.buffer.set(n),e}},ih=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),iy=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),iw=new Uint32Array(64),ib=class extends ig{constructor(){super(64,32,8,!1),this.A=0|iy[0],this.B=0|iy[1],this.C=0|iy[2],this.D=0|iy[3],this.E=0|iy[4],this.F=0|iy[5],this.G=0|iy[6],this.H=0|iy[7]}get(){let{A:e,B:t,C:n,D:i,E:o,F:r,G:s,H:a}=this;return[e,t,n,i,o,r,s,a]}set(e,t,n,i,o,r,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|i,this.E=0|o,this.F=0|r,this.G=0|s,this.H=0|a}process(e,t){for(let n=0;n<16;n++,t+=4)iw[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=iw[e-15],n=iw[e-2],i=ic(t,7)^ic(t,18)^t>>>3,o=ic(n,17)^ic(n,19)^n>>>10;iw[e]=o+iw[e-7]+i+iw[e-16]|0}let{A:n,B:i,C:o,D:r,E:s,F:a,G:u,H:c}=this;for(let e=0;e<64;e++){let t=c+(ic(s,6)^ic(s,11)^ic(s,25))+im(s,a,u)+ih[e]+iw[e]|0,l=(ic(n,2)^ic(n,13)^ic(n,22))+ip(n,i,o)|0;c=u,u=a,a=s,s=r+t|0,r=o,o=i,i=n,n=t+l|0}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,r=r+this.D|0,s=s+this.E|0,a=a+this.F|0,u=u+this.G|0,c=c+this.H|0,this.set(n,i,o,r,s,a,u,c)}roundClean(){iw.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},ik=(l=()=>new ib,i=e=>l().update(il(e)).digest(),o=l(),i.outputLen=o.outputLen,i.blockLen=o.blockLen,i.create=()=>l(),i);function iA({fromPublicKey:e,programId:t=b.H_}){let n,i=y.Keypair.generate().publicKey.toBase58().slice(0,32);return{publicKey:(n=ik(x.concat([e.toBuffer(),x.from(i),t.toBuffer()])),new y.PublicKey(n)),seed:i}}function iI(e){let{mint:t,tokenAccount:n,owner:i,programId:o=b.H_}=e;return(0,B.FJ)(n,t,i,o)}function iP(e){let{tokenAccount:t,payer:n,multiSigners:i=[],owner:o,programId:r=b.H_}=e;return(0,v.Zu)(t,n,o,i,r)}async function iT(e){let{connection:t,amount:n,commitment:i,payer:o,owner:r,skipCloseAccount:s}=e,a=await t.getMinimumBalanceForRentExemption(ir.span,i),u=tG(n).add(new f(a)),c=iA({fromPublicKey:o,programId:b.H_});return{addresses:{newAccount:c.publicKey},signers:[],instructions:[y.SystemProgram.createAccountWithSeed({fromPubkey:o,basePubkey:o,seed:c.seed,newAccountPubkey:c.publicKey,lamports:u.toNumber(),space:ir.span,programId:b.H_}),iI({mint:new y.PublicKey(tC.address),tokenAccount:c.publicKey,owner:r,programId:b.H_})],instructionTypes:[tJ.CreateAccount,tJ.InitAccount],endInstructionTypes:s?[]:[tJ.CloseAccount],endInstructions:s?[]:[iP({tokenAccount:c.publicKey,payer:o,owner:r})]}}function iS({source:e,destination:t,owner:n,amount:i,multiSigners:o=[],tokenProgram:r=b.H_}){return(0,K.$B)(e,t,n,BigInt(String(i)),o,r)}H("Raydium_Util");var iB=class extends nN{constructor(e){super(e),this._tokenAccounts=[],this._tokenAccountRawInfos=[],this._accountListener=[],this._clientOwnedToken=!1;let{tokenAccounts:t,tokenAccountRawInfos:n}=e;this._tokenAccounts=t||[],this._tokenAccountRawInfos=n||[],this._clientOwnedToken=!!(t||n)}get tokenAccounts(){return this._tokenAccounts}get tokenAccountRawInfos(){return this._tokenAccountRawInfos}updateTokenAccount({tokenAccounts:e,tokenAccountRawInfos:t}){return e&&(this._tokenAccounts=e),t&&(this._tokenAccountRawInfos=t),this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=void 0,this._clientOwnedToken=!0,this}addAccountChangeListener(e){return this._accountListener.push(e),this}removeAccountChangeListener(e){return this._accountListener=this._accountListener.filter(t=>t!==e),this}getAssociatedTokenAccount(e,t){return nS(this.scope.ownerPubKey,e,t).publicKey}async fetchWalletTokenAccounts(e){if(this._clientOwnedToken||!(null!=e&&e.forceUpdate)&&this._tokenAccounts.length)return{tokenAccounts:this._tokenAccounts,tokenAccountRawInfos:this._tokenAccountRawInfos};this.scope.checkOwner();let t=W(W({},{}),e),[n,i,o]=await Promise.all([this.scope.connection.getAccountInfo(this.scope.ownerPubKey,t.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:b.H_},t.commitment),this.scope.connection.getTokenAccountsByOwner(this.scope.ownerPubKey,{programId:b.nA},t.commitment)]),{tokenAccounts:r,tokenAccountRawInfos:s}=function({owner:e,solAccountResp:t,tokenAccountResp:n}){let i=[],o=[];for(let{pubkey:t,account:r}of n.value){let n=ir.decode(r.data),{mint:s,amount:a}=n;i.push({publicKey:t,mint:s,amount:a,isAssociated:nS(e,s,r.owner).publicKey.equals(t),isNative:!1,programId:r.owner}),o.push({pubkey:t,accountInfo:n,programId:r.owner})}return t&&i.push({mint:y.PublicKey.default,amount:new f(t.lamports),isNative:!0,programId:t.owner}),{tokenAccounts:i,tokenAccountRawInfos:o}}({owner:this.scope.ownerPubKey,solAccountResp:n,tokenAccountResp:{context:i.context,value:[...i.value,...o.value]}});return this._tokenAccounts=r,this._tokenAccountRawInfos=s,this._accountChangeListenerId&&this.scope.connection.removeAccountChangeListener(this._accountChangeListenerId),this._accountChangeListenerId=this.scope.connection.onAccountChange(this.scope.ownerPubKey,()=>this.fetchWalletTokenAccounts({forceUpdate:!0}),null==e?void 0:e.commitment),{tokenAccounts:r,tokenAccountRawInfos:s}}async getCreatedTokenAccount({mint:e,programId:t=b.H_,associatedOnly:n=!0}){await this.fetchWalletTokenAccounts();let i=this._tokenAccounts.filter(({mint:t})=>null==t?void 0:t.equals(e)).sort((e,t)=>e.amount.lt(t.amount)?1:-1),o=this.getAssociatedTokenAccount(e,t);for(let e of i){let{publicKey:t}=e;if(t&&(!n||n&&o.equals(t)))return t}}async getOrCreateTokenAccount(e){var t,n,i,o;await this.fetchWalletTokenAccounts();let{mint:r,createInfo:s,associatedOnly:a,owner:u,notUseTokenAccount:c=!1,skipCloseAccount:l=!1,checkCreateATAOwner:d=!1}=e,m=new y.PublicKey(e.tokenProgram||b.H_),p=this.getAssociatedTokenAccount(r,new y.PublicKey(m)),g=(c?[]:this.tokenAccountRawInfos).filter(e=>e.accountInfo.mint.equals(r)&&(!a||e.pubkey.equals(p))).sort((e,t)=>e.accountInfo.amount.lt(t.accountInfo.amount)?1:-1);if(void 0===s||g.length>0)return g.length>0?{account:g[0].pubkey}:{};let h={instructions:[],endInstructions:[],signers:[],instructionTypes:[],endInstructionTypes:[]};if(a){let e=(0,T.Ek)(u,p,u,r,m);if(d){let n=await this.scope.connection.getAccountInfo(p);if(null===n)null==(t=h.instructions)||t.push(e),h.instructionTypes.push(tJ.CreateATA);else if(!(n.owner.equals(m)&&S.p0.decode(n.data).mint.equals(r)&&S.p0.decode(n.data).owner.equals(u)))throw Error(`create ata check error -> mint: ${r.toString()}, ata: ${p.toString()}`)}else h.instructions.push(e),h.instructionTypes.push(tJ.CreateATA);if(r.equals(tS)&&s.amount){let e=await iT({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:s.payer||this.scope.ownerPubKey,amount:null!=(n=s.amount)?n:0,skipCloseAccount:l});h.instructions.push(...e.instructions||[]),h.endInstructions.push(...e.endInstructions||[]),h.instructionTypes.push(...e.instructionTypes||[]),h.endInstructionTypes.push(...e.endInstructionTypes||[]),s.amount&&(h.instructions.push(iS({source:e.addresses.newAccount,destination:p,owner:this.scope.ownerPubKey,amount:s.amount,tokenProgram:b.H_})),h.instructionTypes.push(tJ.TransferAmount))}return l||(h.endInstructions.push(iP({owner:u,payer:s.payer||u,tokenAccount:p,programId:m})),h.endInstructionTypes.push(tJ.CloseAccount)),{account:p,instructionParams:h}}{let e=iA({fromPublicKey:u,programId:m}),t=await this.scope.connection.getMinimumBalanceForRentExemption(S.p0.span),n=y.SystemProgram.createAccountWithSeed({fromPubkey:u,basePubkey:u,seed:e.seed,newAccountPubkey:e.publicKey,lamports:t+Number(null!=(o=null==(i=s.amount)?void 0:i.toString())?o:0),space:S.p0.span,programId:m});return h.instructions.push(n,iI({mint:r,tokenAccount:e.publicKey,owner:this.scope.ownerPubKey,programId:m})),h.instructionTypes.push(tJ.CreateAccount),h.instructionTypes.push(tJ.InitAccount),l||(h.endInstructions.push(iP({owner:u,payer:s.payer||u,tokenAccount:e.publicKey,programId:m})),h.endInstructionTypes.push(tJ.CloseAccount)),{account:e.publicKey,instructionParams:h}}}async checkOrCreateAta({mint:e,programId:t=b.H_,autoUnwrapWSOLToSOL:n}){var i;await this.fetchWalletTokenAccounts();let o=null==(i=this.scope.account.tokenAccounts.find(({mint:t})=>(null==t?void 0:t.toBase58())===e.toBase58()))?void 0:i.publicKey,r=this.scope.ownerPubKey,s={};if(!o){let n=this.getAssociatedTokenAccount(e,t),i=await (0,T.Ek)(r,n,r,e,t);s.instructions=[i],s.instructionTypes=[tJ.CreateATA],o=n}return n&&tS.toBase58()===e.toBase58()&&(s.endInstructions=[iP({owner:r,payer:r,tokenAccount:o,programId:t})],s.endInstructionTypes=[tJ.CloseAccount]),{pubKey:o,newInstructions:s}}async handleTokenAccount(e){let{side:t,amount:n,mint:i,programId:o=b.H_,tokenAccount:r,payer:s=this.scope.ownerPubKey,bypassAssociatedCheck:a,skipCloseAccount:u,checkCreateATAOwner:c}=e,l=this.getAssociatedTokenAccount(i,o);if(new y.PublicKey(tS).equals(i)){let e=await iT({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:s,amount:n,skipCloseAccount:u});return W({tokenAccount:e.addresses.newAccount},e)}if(!r||"out"===t&&!l.equals(r)&&!a){let e=[],t=(0,T.Ek)(this.scope.ownerPubKey,l,this.scope.ownerPubKey,i,o);if(c){let n=await this.scope.connection.getAccountInfo(l);if(null===n)e.push(t);else if(!(n.owner.equals(b.H_)&&S.p0.decode(n.data).mint.equals(i)&&S.p0.decode(n.data).owner.equals(this.scope.ownerPubKey)))throw Error(`create ata check error -> mint: ${i.toString()}, ata: ${l.toString()}`)}else e.push(t);return{tokenAccount:l,instructions:e,instructionTypes:[tJ.CreateATA]}}return{tokenAccount:r}}async processTokenAccount(e){let{mint:t,programId:n=b.H_,amount:i,useSOLBalance:o,handleTokenAccount:r}=e,s,a=this.createTxBuilder();if(t.equals(new y.PublicKey(tS))&&o){let e=await this.handleTokenAccount({side:"in",amount:i||0,mint:t,bypassAssociatedCheck:!0,programId:n}),{tokenAccount:o}=e,r=D(e,["tokenAccount"]);s=o,a.addInstruction(r)}else if(!(s=await this.getCreatedTokenAccount({mint:t,associatedOnly:!1,programId:n}))&&r){let e=await this.scope.account.handleTokenAccount({side:"in",amount:0,mint:t,bypassAssociatedCheck:!0,programId:n}),{tokenAccount:i}=e,o=D(e,["tokenAccount"]);s=i,a.addInstruction(o)}return W({tokenAccount:s},a.AllTxData)}},iv=ii([n0("instruction")]),iK=ii([n0("instruction")]),iC=ii([n6("rewardState"),n6("rewardOpenTime"),n6("rewardEndTime"),n6("rewardLastUpdateTime"),n6("totalReward"),n6("totalRewardEmissioned"),n6("rewardClaimed"),n6("rewardPerSecond"),n2("accRewardPerShare"),n3("rewardVault"),n3("rewardMint"),n3("rewardSender"),n6("rewardType"),io(n6(),15,"padding")]),ix=ii([n6("state"),n6("nonce"),n3("lpVault"),n3("rewardVault"),n3(),n3(),n6(),n6(),n6("totalReward"),n2("perShareReward"),n6("lastSlot"),n6("perSlotReward")]),iO=ii([n6("state"),n6("nonce"),n3("lpVault"),n3("rewardVaultA"),n6("totalRewardA"),n2("perShareRewardA"),n6("perSlotRewardA"),n0("option"),n3("rewardVaultB"),nY(7),n6("totalRewardB"),n2("perShareRewardB"),n6("perSlotRewardB"),n6("lastSlot"),n3()]),iq=ii([n6(),n6("state"),n6("nonce"),n6("validRewardTokenNum"),n2("rewardMultiplier"),n6("rewardPeriodMax"),n6("rewardPeriodMin"),n6("rewardPeriodExtend"),n3("lpMint"),n3("lpVault"),io(iC,5,"rewardInfos"),n3("creator"),n3(),io(n6(),32,"padding")]),iR=(new Proxy(ix,{get:(e,t,n)=>"decode"===t?(...t)=>{let n=e.decode(...t);return _(W({},n),{version:3,rewardInfos:[{rewardVault:n.rewardVault,totalReward:n.totalReward,perSlotReward:n.perSlotReward,perShareReward:n.perShareReward}]})}:Reflect.get(e,t,n)}),new Proxy(iO,{get:(e,t,n)=>"decode"===t?(...t)=>{let n=e.decode(...t);return _(W({},n),{version:5,rewardInfos:[{rewardVault:n.rewardVaultA,totalReward:n.totalRewardA,perSlotReward:n.perSlotRewardA,perShareReward:n.perShareRewardA},{rewardVault:n.rewardVaultB,totalReward:n.totalRewardB,perSlotReward:n.perSlotRewardB,perShareReward:n.perShareRewardB}]})}:Reflect.get(e,t,n)}),new Proxy(iq,{get:(e,t,n)=>"decode"===t?(...t)=>{let n=e.decode(...t);return _(W({},n),{version:6,rewardInfos:n.rewardInfos.map(e=>{var t;return _(W({},e),{rewardType:(null!=(t=Object.entries(iZ).find(t=>String(t[1])===e.rewardType.toString()))?t:["Standard SPL"])[0]})})})}:Reflect.get(e,t,n)})),iL=ii([n6("isSet"),n6("rewardPerSecond"),n6("rewardOpenTime"),n6("rewardEndTime"),n6("rewardType")]),iE=ii([n0("instruction"),n6("nonce"),io(iL,5,"rewardTimeInfo")]),iF=ii([n0("instruction"),n6("rewardReopenTime"),n6("rewardEndTime"),n6("rewardPerSecond")]),iM=ii([n0("instruction"),n6("isSet"),n6("rewardPerSecond"),n6("rewardOpenTime"),n6("rewardEndTime"),n6("rewardType")]),iW=(ii([n6("state"),n3("id"),n3("owner"),n6("deposited"),io(n6(),1,"rewardDebts")]),ii([n6("state"),n3("id"),n3("owner"),n6("deposited"),io(n2(),1,"rewardDebts"),n6(""),n6("voteLockedBalance"),io(n6(),15)])),i_=(ii([n6("state"),n3("id"),n3("owner"),n6("deposited"),io(n6(),2,"rewardDebts")]),ii([n6("state"),n3("id"),n3("owner"),n6("deposited"),io(n2(),2,"rewardDebts"),io(n6(),17)])),iD=ii([n6(),n6("state"),n3("id"),n3("owner"),n6("deposited"),io(n2(),5,"rewardDebts"),io(n6(),16)]),iN=ii([n0("instruction"),n6("amount")]),iV=ii([n3("mint"),n3("grantAuthority"),n6("baselineVoteWeightScaledFactor"),n6("maxExtraLockupVoteWeightScaledFactor"),n6("lockupSaturationSecs"),new nJ(1,!0,"digitShift"),io(n0(),7,"reserved1"),io(n6(),7,"reserved2")]),iU=(ii([nY(8),n3("governanceProgramId"),n3("realm"),n3("realmGoverningTokenMint"),n3("realmAuthority"),io(n0(),32,"reserved1"),io(iV,4,"votingMints"),n5("timeOffset"),n0("bump"),io(n0(),7,"reserved2"),io(n6(),11,"reserved3")]),ii([n5("startTime"),n5("endTime"),n0("kind"),io(n0(),15,"reserved")])),iX=ii([io(iU,1,"lockup"),n6("amountDeposited_native"),n6("amountInitiallyLockedNative"),n7("isUsed"),n7("allowClawback"),n0("votingMintConfigIdx"),io(n0(),29,"reserved")]);ii([nY(8),n3("voterAuthority"),n3("registrar"),io(iX,32,"deposits"),n0("voterBump"),n0("voterWweightRecordBump"),io(n0(),94,"reserved")]),H("Raydium_farm_config");var iH=new y.PublicKey("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),iG=new y.PublicKey("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1"),iz={3:iW,5:i_,6:iD},ij=e=>-1!==[3,5,6].indexOf(e),iQ=e=>{var t;let{version:n,rewardInfos:i,rewardTokenAccountsPublicKeys:o}=e,r=`rewardInfo:${JSON.stringify(i)}, rewardAccount:${JSON.stringify(o)}`,s={3:()=>{if(1!==i.length||1!==o.length)return`rewardInfos or rewardTokenAccounts lengths not equal 1: ${r}`},5:()=>{if(i.length!==o.length)return`rewardInfos and rewardTokenAccounts lengths not equal: ${r}`},6:()=>{if(!o.length||i.length!==o.length)return`no rewardTokenAccounts or rewardInfos and rewardTokenAccounts lengths not equal: ${r}`}};return null==(t=s[n])?void 0:t.call(s)},iZ={"Standard SPL":0,"Option tokens":1},iY={[nm.toString()]:3,[np.toString()]:5,[ng.toString()]:6},i$=H("Raydium.farm.util");function iJ({programId:e,poolId:t,mint:n,type:i}){let{publicKey:o}=t8([t.toBuffer(),n.toBuffer(),x.from("lpVault"===i?"lp_vault_associated_seed":"rewardVault"===i?"reward_vault_associated_seed":"","utf-8")],e);return o}function i1({programId:e,poolId:t,owner:n,version:i}){let{publicKey:o}=t8([t.toBuffer(),n.toBuffer(),x.from(6===i?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],e);return o}var i0=({programId:e,poolId:t})=>t8([t.toBuffer()],e);function i4(e){return tG(e.endTime).sub(tG(e.openTime)).mul(tG(e.perSecond))}function i6(e){let t=iz[e];return t||i$.logWithError("invalid version",e),t}var i2=H("Raydium_farm_instruction");function i5(e){let{version:t,id:n,ledger:i,programId:o,owner:r}=e,s={3:9,5:10}[t];s||i2.logWithError(`invalid farm pool version: ${t}`);let a=x.alloc(iv.span);iv.encode({instruction:s},a);let u=[th({pubkey:n}),th({pubkey:i}),th({pubkey:r,isWritable:!1}),th({pubkey:y.SystemProgram.programId,isWritable:!1}),th({pubkey:y.SYSVAR_RENT_PUBKEY,isWritable:!1})];return{instruction:new y.TransactionInstruction({programId:o,keys:u,data:a}),instructionType:tJ.FarmV3CreateLedger}}function i8({payer:e,rewardVault:t,userRewardTokenPub:n,farmKeys:i,rewardInfo:o}){let r=x.alloc(iF.span);iF.encode({instruction:3,rewardReopenTime:tG(o.openTime),rewardEndTime:tG(o.endTime),rewardPerSecond:tG(o.perSecond)},r);let s=[th({pubkey:b.H_,isWritable:!1}),th({pubkey:i.id}),th({pubkey:i.lpVault,isWritable:!1}),th({pubkey:t}),th({pubkey:n}),th({pubkey:e,isWritable:!1,isSigner:!0})];return new y.TransactionInstruction({programId:i.programId,keys:s,data:r})}function i3({payer:e,userRewardTokenPub:t,farmKeys:n,rewardVault:i,rewardInfo:o}){let r=x.alloc(iM.span);iM.encode({instruction:4,isSet:new f(1),rewardPerSecond:tG(o.perSecond),rewardOpenTime:tG(o.openTime),rewardEndTime:tG(o.endTime),rewardType:tG(iZ[o.rewardType])},r);let s=[...ty,th({pubkey:n.id}),th({pubkey:n.authority,isWritable:!1}),th({pubkey:o.mint,isWritable:!1}),th({pubkey:i}),th({pubkey:t}),th({pubkey:e,isWritable:!1,isSigner:!0})];return new y.TransactionInstruction({programId:n.programId,keys:s,data:r})}function i7(e){let{farmInfo:t,farmKeys:n,lpAccount:i,rewardAccounts:o,owner:r,amount:s}=e,[a,u]=[new y.PublicKey(t.programId),new y.PublicKey(t.id)],c=i1({programId:a,poolId:u,owner:r,version:6}),l=x.alloc(iN.span);iN.encode({instruction:2,amount:tG(s)},l);let d=[th({pubkey:b.H_,isWritable:!1}),th({pubkey:u}),th({pubkey:new y.PublicKey(n.authority),isWritable:!1}),th({pubkey:new y.PublicKey(n.lpVault)}),th({pubkey:c}),th({pubkey:r,isWritable:!1,isSigner:!0}),th({pubkey:i})];for(let e=0;e<n.rewardInfos.length;e++)d.push(th({pubkey:new y.PublicKey(n.rewardInfos[e].vault)})),d.push(th({pubkey:o[e]}));return new y.TransactionInstruction({programId:a,keys:d,data:l})}function i9(e){let{farmInfo:t,farmKeys:n,lpAccount:i,rewardAccounts:o,owner:r,amount:s,userAuxiliaryLedgers:a}=e,[u,c]=[new y.PublicKey(t.programId),new y.PublicKey(t.id)],l=i1({programId:u,poolId:c,owner:r,version:5}),d=x.alloc(iN.span);iN.encode({instruction:12,amount:tG(s)},d);let m=[th({pubkey:c}),th({pubkey:new y.PublicKey(n.authority),isWritable:!1}),th({pubkey:l}),th({pubkey:r,isWritable:!1,isSigner:!0}),th({pubkey:i}),th({pubkey:new y.PublicKey(n.lpVault)}),th({pubkey:o[0]}),th({pubkey:new y.PublicKey(n.rewardInfos[0].vault)}),th({pubkey:y.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),th({pubkey:b.H_,isWritable:!1})];for(let e=1;e<n.rewardInfos.length;e++)m.push(th({pubkey:o[e]})),m.push(th({pubkey:new y.PublicKey(n.rewardInfos[e].vault)}));if(a)for(let e of a)m.push(th({pubkey:e}));return new y.TransactionInstruction({programId:u,keys:m,data:d})}function oe(e){let{farmInfo:t,farmKeys:n,lpAccount:i,rewardAccounts:o,owner:r,amount:s,userAuxiliaryLedgers:a}=e,[u,c]=[new y.PublicKey(t.programId),new y.PublicKey(t.id)],l=i1({programId:u,poolId:c,owner:r,version:3}),d=x.alloc(iN.span);iN.encode({instruction:11,amount:tG(s)},d);let m=[th({pubkey:c}),th({pubkey:new y.PublicKey(n.authority),isWritable:!1}),th({pubkey:l}),th({pubkey:r,isWritable:!1,isSigner:!0}),th({pubkey:i}),th({pubkey:new y.PublicKey(n.lpVault)}),th({pubkey:o[0]}),th({pubkey:new y.PublicKey(n.rewardInfos[0].vault)}),th({pubkey:y.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),th({pubkey:b.H_,isWritable:!1})];if(a)for(let e of a)m.push(th({pubkey:e}));return new y.TransactionInstruction({programId:u,keys:m,data:d})}x.from([6,24,245,52,243,255,148,25]),x.from([185,131,167,186,159,125,19,67]),x.from([242,35,198,137,82,225,242,182]),x.from([183,18,70,156,148,109,161,34]),x.from([45,185,3,36,109,190,115,169]);var ot=class extends nN{async _getUserRewardInfo({payer:e,rewardInfo:t}){if(t.mint.equals(tB)){let n=await iT({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:e,amount:i4(_(W({},t),{openTime:t.openTime.toString(),endTime:t.endTime.toString()}))});return{rewardPubKey:n.addresses.newAccount,newInstruction:n}}return{rewardPubKey:await this.scope.account.getCreatedTokenAccount({mint:t.mint,associatedOnly:!1})}}async create({poolInfo:e,rewardInfos:t,payer:n,programId:i=ng,txVersion:o}){this.checkDisabled(),this.scope.checkOwner();let r={lpMint:new y.PublicKey(e.lpMint.address),lockInfo:{lockMint:iH,lockVault:iG},version:6,rewardInfos:t,programId:i},s=this.createTxBuilder(),a=null!=n?n:this.scope.ownerPubKey,u=iA({fromPublicKey:a,programId:r.programId}),c=await this.scope.connection.getMinimumBalanceForRentExemption(iR.span);s.addInstruction({instructions:[y.SystemProgram.createAccountWithSeed({fromPubkey:a,basePubkey:a,seed:u.seed,newAccountPubkey:u.publicKey,lamports:c,space:iR.span,programId:r.programId})]});let{publicKey:l,nonce:d}=i0({programId:new y.PublicKey(r.programId),poolId:u.publicKey}),m=iJ({programId:r.programId,poolId:u.publicKey,mint:r.lpMint,type:"lpVault"}),p=[],g=[];for(let e of r.rewardInfos){e.openTime>=e.endTime&&this.logAndCreateError("start time error","rewardInfo.rewardOpenTime",e.openTime.toString()),isNaN(iZ[e.rewardType])&&this.logAndCreateError("rewardType error",e.rewardType),0>=Number(e.perSecond)&&this.logAndCreateError("rewardPerSecond error",e.perSecond),p.push({isSet:new f(1),rewardPerSecond:tG(e.perSecond),rewardOpenTime:tG(e.openTime),rewardEndTime:tG(e.endTime),rewardType:tG(iZ[e.rewardType])});let{rewardPubKey:t,newInstruction:n}=await this._getUserRewardInfo({rewardInfo:e,payer:a});n&&s.addInstruction(n),t||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let i=e.mint.equals(tB)?new y.PublicKey(tC.address):e.mint;g.push({rewardMint:i,rewardVault:iJ({programId:r.programId,poolId:u.publicKey,mint:i,type:"rewardVault"}),userRewardToken:t})}let{account:h,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({mint:new y.PublicKey(r.lockInfo.lockMint),owner:this.scope.ownerPubKey,skipCloseAccount:!1,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:!1});w&&s.addInstruction(w),h||this.logAndCreateError("cannot found lock vault","tokenAccounts",this.scope.account.tokenAccounts);let{instruction:b,instructionType:k}=function(e){var t;let n=x.alloc(iE.span);iE.encode({instruction:0,nonce:new f(e.nonce),rewardTimeInfo:e.rewardInfoConfig},n);let i=[...ty,th({pubkey:e.farmId}),th({pubkey:e.farmAuthority,isWritable:!1}),th({pubkey:e.lpVault}),th({pubkey:e.lpMint,isWritable:!1}),th({pubkey:e.lockVault}),th({pubkey:e.lockMint,isWritable:!1}),th({pubkey:null!=(t=e.lockUserAccount)?t:tB}),th({pubkey:e.owner,isWritable:!1,isSigner:!0})];for(let t of e.rewardInfo)i.push(th({pubkey:t.rewardMint,isWritable:!1}),th({pubkey:t.rewardVault}),th({pubkey:t.userRewardToken}));return{instruction:new y.TransactionInstruction({programId:e.programId,keys:i,data:n}),instructionType:tJ.FarmV6Create}}({farmId:u.publicKey,owner:this.scope.ownerPubKey,farmAuthority:l,lpVault:m,lpMint:r.lpMint,lockVault:r.lockInfo.lockVault,lockMint:r.lockInfo.lockMint,lockUserAccount:h,programId:r.programId,rewardInfo:g,rewardInfoConfig:p,nonce:d});return s.addInstruction({instructions:[b],instructionTypes:[k]}).versionBuild({txVersion:o,extInfo:{farmId:u.publicKey,farmAuthority:l,lpVault:m,lockUserAccount:h,nonce:d}})}async restartReward({farmInfo:e,payer:t,newRewardInfo:n,txVersion:i}){var o;let r=iY[e.programId];6!==r&&this.logAndCreateError("invalid farm version ",r);let s=tY((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),a={id:s.id,rewardInfos:e.rewardInfos,lpVault:s.lpVault,programId:s.programId};n.openTime>=n.endTime&&this.logAndCreateError("start time error","newRewardInfo",n);let u=t||this.scope.ownerPubKey,c=n.mint.equals(tB)?new y.PublicKey(tC.address):n.mint,l=a.rewardInfos.findIndex(e=>new y.PublicKey(e.mint.address).equals(c)),d=s.rewardInfos[l];d||this.logAndCreateError("configuration does not exist","rewardMint",c);let m=null!=(o=d.vault)?o:tB,p=this.createTxBuilder(),{rewardPubKey:g,newInstruction:h}=await this._getUserRewardInfo({rewardInfo:n,payer:u});return h&&p.addInstruction(h),g||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts),p.addInstruction({instructions:[i8({payer:this.scope.ownerPubKey,rewardVault:m,userRewardTokenPub:g,farmKeys:a,rewardInfo:n})],instructionTypes:[tJ.FarmV6Restart]}).versionBuild({txVersion:i})}async restartRewards({farmInfo:e,payer:t,newRewardInfos:n,txVersion:i}){var o;let r=iY[e.programId];6!==r&&this.logAndCreateError("invalid farm version ",r);let s=tY((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),a={id:s.id,rewardInfos:e.rewardInfos,lpVault:s.lpVault,programId:s.programId};n.forEach(e=>{e.openTime>=e.endTime&&this.logAndCreateError("start time error","newRewardInfo",e)});let u=t||this.scope.ownerPubKey,c=this.createTxBuilder();for(let e of n){let t=e.mint.equals(tB)?new y.PublicKey(tC.address):e.mint,n=a.rewardInfos.findIndex(e=>new y.PublicKey(e.mint.address).equals(t)),i=s.rewardInfos[n];i||this.logAndCreateError("configuration does not exist","rewardMint",t);let r=null!=(o=i.vault)?o:tB,{rewardPubKey:l,newInstruction:d}=await this._getUserRewardInfo({rewardInfo:e,payer:u});d&&c.addInstruction(d),l||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let m=i8({payer:this.scope.ownerPubKey,rewardVault:r,userRewardTokenPub:l,farmKeys:a,rewardInfo:e});c.addInstruction({instructions:[m],instructionTypes:[tJ.FarmV6Restart]})}return c.versionBuild({txVersion:i})}async addNewRewardToken(e){let{txVersion:t,farmInfo:n,newRewardInfo:i,payer:o}=e,r=iY[n.programId];6!==r&&this.logAndCreateError("invalid farm version ",r);let s=tY((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),a=null!=o?o:this.scope.ownerPubKey,u=this.createTxBuilder(),c=i.mint.equals(tB)?new y.PublicKey(tC.address):i.mint,l=iJ({programId:new y.PublicKey(n.programId),poolId:new y.PublicKey(n.id),mint:c,type:"rewardVault"}),{rewardPubKey:d,newInstruction:m}=await this._getUserRewardInfo({rewardInfo:i,payer:a});return m&&u.addInstruction(m),d||this.logAndCreateError("annot found target token accounts",this.scope.account.tokenAccounts),i.mint=c,u.addInstruction({instructions:[i3({payer:this.scope.ownerPubKey,userRewardTokenPub:d,farmKeys:s,rewardVault:l,rewardInfo:i})],instructionTypes:[tJ.FarmV6CreatorAddReward]}).versionBuild({txVersion:t})}async addNewRewardsToken(e){let{txVersion:t,farmInfo:n,newRewardInfos:i,payer:o}=e,r=iY[n.programId];6!==r&&this.logAndCreateError("invalid farm version ",r);let s=tY((await this.scope.api.fetchFarmKeysById({ids:n.id}))[0]),a=null!=o?o:this.scope.ownerPubKey,u=this.createTxBuilder();for(let e of i){let t=e.mint.equals(tB)?new y.PublicKey(tC.address):e.mint,i=iJ({programId:new y.PublicKey(n.programId),poolId:new y.PublicKey(n.id),mint:t,type:"rewardVault"}),{rewardPubKey:o,newInstruction:r}=await this._getUserRewardInfo({rewardInfo:e,payer:a});r&&u.addInstruction(r),o||this.logAndCreateError("cannot found target token accounts",this.scope.account.tokenAccounts);let c=i3({payer:this.scope.ownerPubKey,userRewardTokenPub:o,farmKeys:s,rewardVault:i,rewardInfo:_(W({},e),{mint:t})});u.addInstruction({instructions:[c],instructionTypes:[tJ.FarmV6CreatorAddReward]})}return u.versionBuild({txVersion:t})}async deposit(e){let{txVersion:t,farmInfo:n,amount:i,feePayer:o,useSOLBalance:r,associatedOnly:s=!0,checkCreateATAOwner:a=!1,userAuxiliaryLedgers:u,computeBudgetConfig:c}=e;!1===this.scope.availability.addFarm&&this.logAndCreateError("farm deposit feature disabled in your region");let{rewardInfos:l,programId:d}=n,m=iY[d];ij(m)||this.logAndCreateError("invalid farm program:",n.programId);let[p,g]=[new y.PublicKey(n.programId),new y.PublicKey(n.id)],h=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],f=i1({programId:p,poolId:g,owner:this.scope.ownerPubKey,version:m}),w=this.createTxBuilder();w.addCustomComputeBudget(c);let k={};for(let e of this.scope.account.tokenAccounts)if(s){let t=nS(this.scope.ownerPubKey,e.mint,e.programId).publicKey;e.publicKey&&t.equals(e.publicKey)&&(k[e.mint.toString()]=e.publicKey)}else k[e.mint.toString()]=e.publicKey;let A=k[h.lpMint.address];A||this.logAndCreateError("you don't have any lp","lp zero",k);let I=[];for(let e of l){let t=r&&e.mint.address===tS.toString(),n=k[e.mint.address];if(!n){let{account:i,instructionParams:r}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mint.programId,mint:new y.PublicKey(e.mint.address),notUseTokenAccount:t,createInfo:{payer:o||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!t,associatedOnly:!t&&s,checkCreateATAOwner:a});n=i,r&&w.addInstruction(r)}k[e.mint.address]=n,I.push(n)}let P,T=await this.scope.connection.getAccountInfo(f);if(T&&(P=i6(m).decode(T.data)),n.programId!==ng.toString()&&!P){let{instruction:e,instructionType:t}=i5({id:g,programId:p,version:m,ledger:f,owner:this.scope.ownerPubKey});w.addInstruction({instructions:[e],instructionTypes:[t]})}let S=iQ({version:m,rewardInfos:l,rewardTokenAccountsPublicKeys:I});S&&this.logAndCreateError(S);let B={amount:tG(i),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:h,lpAccount:A,rewardAccounts:I,userAuxiliaryLedgers:null==u?void 0:u.map(e=>new y.PublicKey(e))},v=6===m?function(e){let{farmInfo:t,farmKeys:n,lpAccount:i,rewardAccounts:o,owner:r,amount:s}=e,[a,u]=[new y.PublicKey(t.programId),new y.PublicKey(t.id)],c=i1({programId:a,poolId:u,owner:r,version:6}),l=x.alloc(iN.span);iN.encode({instruction:1,amount:tG(s)},l);let d=[th({pubkey:b.H_,isWritable:!1}),th({pubkey:y.SystemProgram.programId,isWritable:!1}),th({pubkey:u}),th({pubkey:new y.PublicKey(n.authority),isWritable:!1}),th({pubkey:new y.PublicKey(n.lpVault)}),th({pubkey:c}),th({pubkey:r,isWritable:!1,isSigner:!0}),th({pubkey:i})];for(let e=0;e<n.rewardInfos.length;e++)d.push(th({pubkey:new y.PublicKey(n.rewardInfos[e].vault)})),d.push(th({pubkey:o[e]}));return new y.TransactionInstruction({programId:a,keys:d,data:l})}(B):5===m?function(e){let{farmInfo:t,farmKeys:n,lpAccount:i,rewardAccounts:o,owner:r,amount:s,userAuxiliaryLedgers:a}=e,[u,c]=[new y.PublicKey(t.programId),new y.PublicKey(t.id)],l=i1({programId:u,poolId:c,owner:r,version:5}),d=x.alloc(iN.span);iN.encode({instruction:11,amount:tG(s)},d);let m=[th({pubkey:c}),th({pubkey:new y.PublicKey(n.authority),isWritable:!1}),th({pubkey:l}),th({pubkey:r,isWritable:!1,isSigner:!0}),th({pubkey:i}),th({pubkey:new y.PublicKey(n.lpVault)}),th({pubkey:o[0]}),th({pubkey:new y.PublicKey(n.rewardInfos[0].vault)}),th({pubkey:y.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),th({pubkey:b.H_,isWritable:!1})];for(let e=1;e<n.rewardInfos.length;e++)m.push(th({pubkey:o[e]})),m.push(th({pubkey:new y.PublicKey(n.rewardInfos[e].vault)}));if(a)for(let e of a)m.push(th({pubkey:e}));return new y.TransactionInstruction({programId:u,keys:m,data:d})}(B):function(e){let{farmInfo:t,farmKeys:n,lpAccount:i,rewardAccounts:o,owner:r,amount:s,userAuxiliaryLedgers:a}=e,[u,c]=[new y.PublicKey(t.programId),new y.PublicKey(t.id)],l=i1({programId:u,poolId:c,owner:r,version:3}),d=x.alloc(iN.span);iN.encode({instruction:10,amount:tG(s)},d);let m=[th({pubkey:c}),th({pubkey:new y.PublicKey(n.authority),isWritable:!1}),th({pubkey:l}),th({pubkey:r,isWritable:!1,isSigner:!0}),th({pubkey:i}),th({pubkey:new y.PublicKey(n.lpVault)}),th({pubkey:o[0]}),th({pubkey:new y.PublicKey(n.rewardInfos[0].vault)}),th({pubkey:y.SYSVAR_CLOCK_PUBKEY,isWritable:!1}),th({pubkey:b.H_,isWritable:!1})];if(a)for(let e of a)m.push(th({pubkey:e}));return new y.TransactionInstruction({programId:u,keys:m,data:d})}(B),K={3:tJ.FarmV3Deposit,5:tJ.FarmV5Deposit,6:tJ.FarmV6Deposit};return w.addInstruction({instructions:[v],instructionTypes:[K[m]]}).versionBuild({txVersion:t})}async withdraw(e){let{txVersion:t,farmInfo:n,amount:i,deposited:o,useSOLBalance:r,feePayer:s,associatedOnly:a=!0,checkCreateATAOwner:u=!1,userAuxiliaryLedgers:c,computeBudgetConfig:l}=e,{rewardInfos:d}=n;!1===this.scope.availability.removeFarm&&this.logAndCreateError("farm withdraw feature disabled in your region");let m=iY[n.programId];ij(m)||this.logAndCreateError("invalid farm program:",n.programId);let p=(await this.scope.api.fetchFarmKeysById({ids:n.id}))[0],g=this.createTxBuilder();g.addCustomComputeBudget(l);let h={};for(let e of this.scope.account.tokenAccounts)if(a){let t=nS(this.scope.ownerPubKey,e.mint).publicKey;e.publicKey&&t.equals(e.publicKey)&&(h[e.mint.toString()]=e.publicKey)}else h[e.mint.toString()]=e.publicKey;if(o)o.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else{let e=i1({programId:new y.PublicKey(n.programId),poolId:new y.PublicKey(n.id),owner:this.scope.ownerPubKey,version:m}),t=await this.scope.connection.getAccountInfo(e);if(t)i6(m).decode(t.data).deposited.isZero()&&this.logAndCreateError("no deposited lp",{farmId:n.id});else if(6!==m&&(c||[]).length>0){let{instruction:t,instructionType:n}=i5({id:new y.PublicKey(p.id),programId:new y.PublicKey(p.programId),version:m,ledger:e,owner:this.scope.ownerPubKey});g.addInstruction({instructions:[t],instructionTypes:[n]})}else this.logAndCreateError("no lp data",{farmId:n.id,version:m,ledgerData:t})}let f=p.lpMint.address,w=r&&f===tS.toString(),b=h[f.toString()];if(!b){let{account:e,instructionParams:t}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:p.lpMint.programId,mint:new y.PublicKey(f),notUseTokenAccount:w,createInfo:{payer:s||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:!w&&a,checkCreateATAOwner:u});b=e,t&&g.addInstruction(t)}h[f.toString()]=b;let k=[];for(let e of d){let t=r&&e.mint.address===tS.toString(),n=h[e.mint.address];if(!n){let{account:i,instructionParams:o}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mint.programId,mint:new y.PublicKey(e.mint.address),notUseTokenAccount:t,createInfo:{payer:s||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!t,associatedOnly:!t&&a,checkCreateATAOwner:u});n=i,o&&g.addInstruction(o)}h[e.mint.address]=n,k.push(n)}let A=iQ({version:m,rewardInfos:d,rewardTokenAccountsPublicKeys:k});A&&this.logAndCreateError(A);let I={amount:tG(i),owner:this.scope.ownerPubKey,farmInfo:n,farmKeys:p,lpAccount:b,rewardAccounts:k,userAuxiliaryLedgers:null==c?void 0:c.map(e=>new y.PublicKey(e))},P=6===m?i7(I):5===m?i9(I):oe(I),T={3:tJ.FarmV3Withdraw,5:tJ.FarmV5Withdraw,6:tJ.FarmV6Withdraw};return g.addInstruction({instructions:[P],instructionTypes:[T[m]]}).versionBuild({txVersion:t})}async withdrawFarmReward({farmInfo:e,withdrawMint:t,txVersion:n}){var i,o;let r,s;this.scope.checkOwner();let a=tY((await this.scope.api.fetchFarmKeysById({ids:e.id}))[0]),u=iY[e.programId];6!==u&&this.logAndCreateError("invalid farm version",u);let c=e.rewardInfos.findIndex(e=>e.mint.address===tB.toString()?new y.PublicKey(tC.address):t),l=a.rewardInfos[c];l||this.logAndCreateError("withdraw mint error","rewardInfos",e);let d=null!=(i=null==l?void 0:l.vault)?i:tB,m=this.createTxBuilder(),p;if(t.equals(tB)){let e=await iT({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:i4(_(W({},l),{openTime:l.openTime,endTime:l.endTime,perSecond:new tg(l.perSecond).mul(10**l.mint.decimals).toString()}))});p=e.addresses.newAccount,m.addInstruction(e)}else{let e=await this.scope.account.getCreatedTokenAccount({mint:t});null===e?(p=await this.scope.account.getAssociatedTokenAccount(t),m.addInstruction({instructions:[(0,T.Ek)(this.scope.ownerPubKey,p,this.scope.ownerPubKey,t)],instructionTypes:[tJ.CreateATA]})):p=e}let{instruction:g,instructionType:h}=(o={programId:a.programId,id:a.id,authority:a.authority,lpVault:a.lpVault,rewardVault:d,userRewardToken:p,owner:this.scope.ownerPubKey},r=x.alloc(iK.span),iK.encode({instruction:5},r),s=[th({pubkey:b.H_,isWritable:!1}),th({pubkey:o.id}),th({pubkey:o.authority,isWritable:!1}),th({pubkey:o.lpVault,isWritable:!1}),th({pubkey:o.rewardVault}),th({pubkey:o.userRewardToken}),th({pubkey:o.owner,isWritable:!1,isSigner:!0})],{instruction:new y.TransactionInstruction({programId:o.programId,keys:s,data:r}),instructionType:tJ.FarmV6CreatorWithdraw});return m.addInstruction({instructions:[g],instructionTypes:[h]}).versionBuild({txVersion:n})}async harvestAllRewards(e){let{farmInfoList:t,useSOLBalance:n,feePayer:i,associatedOnly:o=!0,checkCreateATAOwner:r=!1,userAuxiliaryLedgers:s,txVersion:a,computeBudgetConfig:u}=e,c=this.createTxBuilder(),l={};for(let e of this.scope.account.tokenAccounts)if(o){let t=nS(this.scope.ownerPubKey,e.mint).publicKey;e.publicKey&&t.equals(e.publicKey)&&(l[e.mint.toString()]=e.publicKey)}else l[e.mint.toString()]=e.publicKey;let d=(await this.scope.api.fetchFarmKeysById({ids:Object.values(t).map(e=>e.id).join(",")})).reduce((e,t)=>_(W({},e),{[t.id]:t}),{});for(let e of Object.values(t)){let{programId:t,lpMint:a,rewardInfos:u,id:m}=e,p=iY[t],g=a.address,h=n&&g===tS.toString(),f=l[g];if(!f){let{account:e,instructionParams:t}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:a.programId,mint:new y.PublicKey(g),notUseTokenAccount:h,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!0,associatedOnly:!h&&o,checkCreateATAOwner:r});f=e,t&&c.addInstruction(t)}l[g.toString()]=f;let w=[];for(let e of u){let t=n&&e.mint.address===tS.toString(),s=l[e.mint.address];if(!s){let{account:n,instructionParams:a}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mint.programId,mint:new y.PublicKey(e.mint.address),notUseTokenAccount:t,createInfo:{payer:i||this.scope.ownerPubKey,amount:0},owner:this.scope.ownerPubKey,skipCloseAccount:!t,associatedOnly:!t&&o,checkCreateATAOwner:r});s=n,a&&c.addInstruction(a)}l[e.mint.address]=s,w.push(s)}let b=d[m],k={amount:tU,owner:this.scope.ownerPubKey,farmInfo:e,farmKeys:b,lpAccount:f,rewardAccounts:w,userAuxiliaryLedgers:null==s?void 0:s.map(e=>new y.PublicKey(e))},A=6===p?i7(k):5===p?i9(k):oe(k),I={3:tJ.FarmV3Withdraw,5:tJ.FarmV5Withdraw,6:tJ.FarmV6Withdraw};c.addInstruction({instructions:[A],instructionTypes:[I[p]]})}return 1===a?c.sizeCheckBuild({computeBudgetConfig:u}):c.sizeCheckBuildV0({computeBudgetConfig:u})}};ii([n4("mintAuthorityOption"),n3("mintAuthority"),n6("supply"),n0("decimals"),n0("isInitialized"),n4("freezeAuthorityOption"),n3("freezeAuthority")]);var on=e=>new tx({mint:e.address,decimals:e.decimals,symbol:e.symbol,name:e.name}),oi=e=>{var{amount:t,isRaw:n,name:i}=e,o=D(e,["amount","isRaw","name"]);return new tZ(new tx({mint:tv(o.address).toBase58(),decimals:o.decimals,symbol:o.symbol,name:i}),t,n,i)},oo=e=>{var{address:t,programId:n,decimals:i}=e,o=D(e,["address","programId","decimals"]);return W({chainId:101,address:tv(t).toBase58(),programId:n,logoURI:"",symbol:"",name:"",decimals:i,tags:[],extensions:o.extensions||{}},o)},or=e=>e?_(W({},e),{transferFeeConfigAuthority:e.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:e.withdrawWithheldAuthority.toBase58(),withheldAmount:e.withheldAmount.toString(),olderTransferFee:_(W({},e.olderTransferFee),{epoch:e.olderTransferFee.epoch.toString(),maximumFee:e.olderTransferFee.maximumFee.toString()}),newerTransferFee:_(W({},e.newerTransferFee),{epoch:e.newerTransferFee.epoch.toString(),maximumFee:e.newerTransferFee.maximumFee.toString()})}):void 0,os=ii([n0("instruction"),n6("amountIn"),n6("minAmountOut")]),oa=ii([n0("instruction"),n6("maxAmountIn"),n6("amountOut")]),ou=(ii([n0("instruction"),n0("nonce")]),ii([n0("instruction"),n0("nonce"),n6("startTime")]),ii([n6("status"),n6("nonce"),n6("maxOrder"),n6("depth"),n6("baseDecimal"),n6("quoteDecimal"),n6("state"),n6("resetFlag"),n6("minSize"),n6("volMaxCutRatio"),n6("amountWaveRatio"),n6("baseLotSize"),n6("quoteLotSize"),n6("minPriceMultiplier"),n6("maxPriceMultiplier"),n6("systemDecimalValue"),n6("minSeparateNumerator"),n6("minSeparateDenominator"),n6("tradeFeeNumerator"),n6("tradeFeeDenominator"),n6("pnlNumerator"),n6("pnlDenominator"),n6("swapFeeNumerator"),n6("swapFeeDenominator"),n6("baseNeedTakePnl"),n6("quoteNeedTakePnl"),n6("quoteTotalPnl"),n6("baseTotalPnl"),n6("poolOpenTime"),n6("punishPcAmount"),n6("punishCoinAmount"),n6("orderbookToInitTime"),n2("swapBaseInAmount"),n2("swapQuoteOutAmount"),n6("swapBase2QuoteFee"),n2("swapQuoteInAmount"),n2("swapBaseOutAmount"),n6("swapQuote2BaseFee"),n3("baseVault"),n3("quoteVault"),n3("baseMint"),n3("quoteMint"),n3("lpMint"),n3("openOrders"),n3("marketId"),n3("marketProgramId"),n3("targetOrders"),n3("withdrawQueue"),n3("lpVault"),n3("owner"),n6("lpReserve"),io(n6(),3,"padding")])),oc=(ii([n6("accountType"),n6("status"),n6("nonce"),n6("maxOrder"),n6("depth"),n6("baseDecimal"),n6("quoteDecimal"),n6("state"),n6("resetFlag"),n6("minSize"),n6("volMaxCutRatio"),n6("amountWaveRatio"),n6("baseLotSize"),n6("quoteLotSize"),n6("minPriceMultiplier"),n6("maxPriceMultiplier"),n6("systemDecimalsValue"),n6("abortTradeFactor"),n6("priceTickMultiplier"),n6("priceTick"),n6("minSeparateNumerator"),n6("minSeparateDenominator"),n6("tradeFeeNumerator"),n6("tradeFeeDenominator"),n6("pnlNumerator"),n6("pnlDenominator"),n6("swapFeeNumerator"),n6("swapFeeDenominator"),n6("baseNeedTakePnl"),n6("quoteNeedTakePnl"),n6("quoteTotalPnl"),n6("baseTotalPnl"),n6("poolOpenTime"),n6("punishPcAmount"),n6("punishCoinAmount"),n6("orderbookToInitTime"),n2("swapBaseInAmount"),n2("swapQuoteOutAmount"),n2("swapQuoteInAmount"),n2("swapBaseOutAmount"),n6("swapQuote2BaseFee"),n6("swapBase2QuoteFee"),n3("baseVault"),n3("quoteVault"),n3("baseMint"),n3("quoteMint"),n3("lpMint"),n3("modelDataAccount"),n3("openOrders"),n3("marketId"),n3("marketProgramId"),n3("targetOrders"),n3("owner"),io(n6(),64,"padding")]),ii([n0("instruction"),n6("baseAmountIn"),n6("quoteAmountIn"),n6("fixedSide")])),ol=ii([n0("instruction"),n6("amountIn")]),od=ii([n6("fee")]),om=new y.PublicKey("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),op=ii([n6("x"),n6("y"),n6("price")]),og=ii([n6("accountType"),n6("status"),n6("multiplier"),n6("validDataCount"),io(op,5e4,"DataElement")]);function oh(e,t,n){let[i,o,r]=function(e,t,n){let[i,o]=[0,49998],r=i,s=o,a=0,u=t*e.multiplier/n;for(;r<=s&&0!==(a=Math.floor((s+r)/2))&&!(a>=49998);){let t=e.DataElement[a].x*e.multiplier/e.DataElement[a].y,n=e.DataElement[a-1].x*e.multiplier/e.DataElement[a-1].y,i=e.DataElement[a+1].x*e.multiplier/e.DataElement[a+1].y;if(u===t)return[a,a,!0];if(u===n)return[a-1,a-1,!0];if(u===i)return[a+1,a+1,!0];if(u<n)s=a-1;else{if(u>n&&u<t)return[a-1,a,!0];if(u>t&&u<i)return[a,a+1,!0];r=a+1}}return[a,a,!1]}(e,t,n);if(!r)return 0;if(i===o){let n=e.DataElement[i].x;return t*e.multiplier/n}{let r=e.DataElement[i].x,s=e.DataElement[i].y,a=e.DataElement[o].x,u=e.DataElement[o].y,c=n*(a*s-r*u),l=(a-r)*(t*s-r*n)*u;return t*e.multiplier*c/(r*c+l)}}function oy(e,t,n){return t*e.multiplier/n}function of(e,t,n){return t*n/e.multiplier}function ow(e,t,n,i){let o=i?t+n:t-n,[r,s,a]=function(e,t){let[n,i]=[0,49998],o=n,r=i,s=0;for(;o<r&&!((s=Math.floor((r+o)/2))<=0)&&!(s>49998);){let n=e.DataElement[s].x,i=e.DataElement[s-1].x,a=e.DataElement[s+1].x;if(t===n)return[s,s,!0];if(t===i)return[s-1,s-1,!0];if(t===a)return[s+1,s+1,!0];if(t<i)r=s-1;else{if(t>i&&t<n)return[s-1,s,!0];if(t>n&&t<a)return[s,s+1,!0];o=s+1}}return[s,s,!1]}(e,o);if(!a)return[0,0,!1,a];if(r===s)return[e.DataElement[s].price,e.DataElement[s].y,!1,a];{let n=e.DataElement[r].x,u=e.DataElement[s].x,c=e.DataElement[r].price,l=e.DataElement[s].price,d=e.DataElement[r].y,m=e.DataElement[s].y;if(t>=n&&t<=u)return i?[l,m,!0,a]:[c,d,!0,a];{let r,s;return i?(r=c+(l-c)*(t-n)/(u-n),s=d-(o-n)*e.multiplier/l):(r=c+(l-c)*(t-n)/(u-n),s=m+(u-o)*e.multiplier/c),[r,s,!1,a]}}}var ob=class{constructor({connection:e}){this._layoutData={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]},this.connection=e}get stableModelData(){return this._layoutData}async initStableModelLayout(){if(0===this._layoutData.validDataCount&&this.connection){var e;let t,n=await this.connection.getAccountInfo(om);n&&(this._layoutData=(e=null==n?void 0:n.data,{accountType:(t=og.decode(e)).accountType.toNumber(),status:t.status.toNumber(),multiplier:t.multiplier.toNumber(),validDataCount:t.validDataCount.toNumber(),DataElement:t.DataElement.map(e=>({x:e.x.toNumber(),y:e.y.toNumber(),price:e.price.toNumber()}))}))}}},ok=H("Raydium_liquidity_instruction");function oA(e){let{poolInfo:t,poolKeys:n,userKeys:i,amountIn:o}=e,r=tY(n),s=4;if(t.pooltype.includes("StablePool")&&(s=5),4===s||5===s){let e=x.alloc(ol.span);ol.encode({instruction:4,amountIn:tG(o)},e);let t=[th({pubkey:b.H_,isWritable:!1}),th({pubkey:r.id}),th({pubkey:r.authority,isWritable:!1}),th({pubkey:r.openOrders}),th({pubkey:r.targetOrders}),th({pubkey:r.mintLp.address}),th({pubkey:r.vault.A}),th({pubkey:r.vault.B})];return 5===s?t.push(th({pubkey:om})):(t.push(th({pubkey:r.id})),t.push(th({pubkey:r.id}))),t.push(th({pubkey:r.marketProgramId,isWritable:!1}),th({pubkey:r.marketId}),th({pubkey:r.marketBaseVault}),th({pubkey:r.marketQuoteVault}),th({pubkey:r.marketAuthority,isWritable:!1}),th({pubkey:i.lpTokenAccount}),th({pubkey:i.baseTokenAccount}),th({pubkey:i.quoteTokenAccount}),th({pubkey:i.owner,isWritable:!1,isSigner:!0}),th({pubkey:r.marketEventQueue}),th({pubkey:r.marketBids}),th({pubkey:r.marketAsks})),new y.TransactionInstruction({programId:r.programId,keys:t,data:e})}return new y.TransactionInstruction({programId:r.programId,keys:[]})}function oI(e){let{poolKeys:t,version:n,userKeys:i,amountIn:o,amountOut:r,fixedSide:s}=e;if(4===n||5===n){let a={poolKeys:t,userKeys:i};if("in"===s)return function({poolKeys:e,userKeys:t,amountIn:n,minAmountOut:i},o){let r=tY(e),s=x.alloc(os.span);os.encode({instruction:9,amountIn:tG(n),minAmountOut:tG(i)},s);let a=[th({pubkey:b.H_,isWritable:!1}),th({pubkey:r.id}),th({pubkey:r.authority,isWritable:!1}),th({pubkey:r.openOrders})];return 4===o&&a.push(th({pubkey:r.targetOrders})),a.push(th({pubkey:r.vault.A}),th({pubkey:r.vault.B})),5===o&&a.push(th({pubkey:om})),a.push(th({pubkey:r.marketProgramId,isWritable:!1}),th({pubkey:r.marketId}),th({pubkey:r.marketBids}),th({pubkey:r.marketAsks}),th({pubkey:r.marketEventQueue}),th({pubkey:r.marketBaseVault}),th({pubkey:r.marketQuoteVault}),th({pubkey:r.marketAuthority,isWritable:!1}),th({pubkey:t.tokenAccountIn}),th({pubkey:t.tokenAccountOut}),th({pubkey:t.owner,isWritable:!1})),new y.TransactionInstruction({programId:r.programId,keys:a,data:s})}(_(W({},a),{amountIn:o,minAmountOut:r}),n);if("out"===s)return function({poolKeys:e,userKeys:t,maxAmountIn:n,amountOut:i},o){let r=tY(e),s=x.alloc(oa.span);oa.encode({instruction:11,maxAmountIn:tG(n),amountOut:tG(i)},s);let a=[th({pubkey:b.H_,isWritable:!1}),th({pubkey:r.id}),th({pubkey:r.authority,isWritable:!1}),th({pubkey:r.openOrders}),th({pubkey:r.targetOrders}),th({pubkey:r.vault.A}),th({pubkey:r.vault.B})];return 5===o&&a.push(th({pubkey:om})),a.push(th({pubkey:r.marketProgramId,isWritable:!1}),th({pubkey:r.marketId}),th({pubkey:r.marketBids}),th({pubkey:r.marketAsks}),th({pubkey:r.marketEventQueue}),th({pubkey:r.marketBaseVault}),th({pubkey:r.marketQuoteVault}),th({pubkey:r.marketAuthority,isWritable:!1}),th({pubkey:t.tokenAccountIn}),th({pubkey:t.tokenAccountOut}),th({pubkey:t.owner,isWritable:!1,isSigner:!0})),new y.TransactionInstruction({programId:r.programId,keys:a,data:s})}(_(W({},a),{maxAmountIn:o,amountOut:r}),n);ok.logWithError("invalid params","params",e)}throw ok.logWithError("invalid version","poolKeys.version",n),Error("invalid version")}function oP(e){let t=new ArrayBuffer(4);return new DataView(t).setInt32(0,e,!1),new Uint8Array(t)}function oT(e,t){let n=0;for(let i=e-1;i>=0&&!t.testn(i);i--)n++;return n}function oS(e,t){let n=0;for(let i=0;i<e&&!t.testn(i);i++)n++;return n}function oB(e,t){for(let n=0;n<e;n++)if(t.testn(n))return!1;return!0}x.from("amm_config","utf8");var ov=x.from("pool","utf8"),oK=x.from("pool_vault","utf8"),oC=x.from("pool_reward_vault","utf8"),ox=x.from("position","utf8"),oO=x.from("tick_array","utf8"),oq=x.from("operation","utf8"),oR=x.from("pool_tick_array_bitmap_extension","utf8");function oL(e,t,n){return t8([oK,t.toBuffer(),n.toBuffer()],e)}function oE(e,t,n){return t8([oO,t.toBuffer(),oP(n)],e)}function oF(e,t,n,i){return t8([ox,t.toBuffer(),oP(n),oP(i)],e)}function oM(e,t){return t8([ox,t.toBuffer()],e)}function oW(e){return t8([x.from("metadata","utf8"),tP.toBuffer(),e.toBuffer()],tP)}function o_(e,t){return t8([oR,t.toBuffer()],e)}var oD=new f(0),oN=new f(1),oV=new f(-1),oU=new f(1).shln(64),oX=new f(1).shln(128),oH=oU.sub(oN),oG=oX.subn(1),oz=new f("4295048016"),oj=new f("79226673521066979257578248091"),oQ=new f("4295048017"),oZ=new f("79226673521066979257578248090"),oY=new f(10).pow(new f(6)),o$=((d=o$||{})[d.rate_500=500]="rate_500",d[d.rate_3000=3e3]="rate_3000",d[d.rate_10000=1e4]="rate_10000",d),oJ={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]};new f("18446744073700000000");var o1=class{static async getTickArrays(e,t,n,i,o,r,s){let a=[],u=rr.getTickArrayStartIndexByTick(i,o),c=rr.getInitializedTickArrayInRange(r,s,o,u,Math.floor(7.5));for(let e=0;e<c.length;e++){let{publicKey:i}=oE(t,n,c[e]);a.push(i)}let l=(await ni(e,a)).map(e=>null!==e?rg.decode(e.data):null),d={};for(let e=0;e<a.length;e++){let t=l[e];null!==t&&(d[t.startTickIndex]=_(W({},t),{address:a[e]}))}return d}static nextInitializedTick(e,t,n,i,o,r){let{initializedTick:s,tickArrayAddress:a,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,i,o,r);for(;null==s||s.liquidityGross.lten(0);){if(u=rr.getNextTickArrayStartIndex(u,o,r),this.checkIsValidStartIndex(u,o))throw Error("No enough initialized tickArray");let i=n[u];if(void 0===i)continue;let{nextTick:c,tickArrayAddress:l,tickArrayStartTickIndex:d}=this.firstInitializedTickInOneArray(e,t,i,r);[s,a,u]=[c,l,d]}if(null==s)throw Error("No invaild tickArray cache");return{nextTick:s,tickArrayAddress:a,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,i,o){let r=Math.floor(e/o1.tickCount(t)),s=n?rr.searchLowBitFromStart(i,o,r-1,1,t):rr.searchHightBitFromStart(i,o,r+1,1,t);return s.length>0?{isExist:!0,nextStartIndex:s[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let o;if(i){let e=ri-1;for(;e>=0;){let t=n.ticks[e];if(t.liquidityGross.gtn(0)){o=t;break}e-=1}}else{let e=0;for(;e<ri;){let t=n.ticks[e];if(t.liquidityGross.gtn(0)){o=t;break}e+=1}}let{publicKey:r}=oE(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:r,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,o,r){let s,a=rr.getTickArrayStartIndexByTick(i,o),u=Math.floor((i-a)/o),c=n[a];if(null==c)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};if(r)for(;u>=0;){let e=c.ticks[u];if(e.liquidityGross.gtn(0)){s=e;break}u-=1}else for(u+=1;u<ri;){let e=c.ticks[u];if(e.liquidityGross.gtn(0)){s=e;break}u+=1}let{publicKey:l}=oE(e,t,a);return{initializedTick:s,tickArrayAddress:l,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){return rr.checkIsOutOfBoundary(e)?!(e>443636)&&e==rr.getTickArrayStartIndexByTick(-443636,t):e%this.tickCount(t)==0}static tickCount(e){return ri*e}},o0=class{static maxTickInTickarrayBitmap(e){return e*ri*ro}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let o=n*i;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){var o,r;if(!o1.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let s=this.maxTickInTickarrayBitmap(n),a=i?t-o1.tickCount(n):t+o1.tickCount(n);if(a<-s||a>=s)return{isInit:!1,tickIndex:t};let u=n*ri,c=a/u+512;a<0&&a%u!=0&&c--;let l=Math.abs(c);if(i){let t=oB(1024,o=e.shln(1024-l-1))?null:oT(1024,o);return null!==t?{isInit:!0,tickIndex:(l-t-512)*u}:{isInit:!1,tickIndex:-s}}{let t=oB(1024,r=e.shrn(l))?null:oS(1024,r);return null!==t?{isInit:!0,tickIndex:(l+t-512)*u}:{isInit:!1,tickIndex:s-o1.tickCount(n)}}}},o4=class{static getBitmapOffset(e,t){if(!o1.checkIsValidStartIndex(e,t))throw Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=o0.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n==0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=o0.maxTickInTickarrayBitmap(e),n=-t;if(443636<=t)throw Error(`extensionTickBoundary check error: 443636, ${t}`);if(n<=-443636)throw Error(`extensionTickBoundary check error: ${n}, -443636`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:rr.mergeTickArrayBitmap(i).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let o=o1.tickCount(t),r=n?e-o:e+o,{tickarrayBitmap:s}=this.getBitmap(r,t,i);return this.nextInitializedTickArrayInBitmap(s,r,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:o,maxValue:r}=o0.getBitmapTickBoundary(t,n),s=this.tickArrayOffsetInBitmap(t,n);if(i){let i=rr.mergeTickArrayBitmap(e).shln(ro-1-s),r=oB(512,i)?null:oT(512,i);return null!==r?{isInit:!0,tickIndex:t-r*o1.tickCount(n)}:{isInit:!1,tickIndex:o}}{let i=rr.mergeTickArrayBitmap(e).shrn(s),o=oB(512,i)?null:oS(512,i);return null!==o?{isInit:!0,tickIndex:t+o*o1.tickCount(n)}:{isInit:!1,tickIndex:r-o1.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%o0.maxTickInTickarrayBitmap(t),i=Math.floor(n/o1.tickCount(t));return e<0&&0!=n&&(i=ro-i),i}},o6=class{static getfeeGrowthInside(e,t,n){let i=new f(0),o=new f(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let r=new f(0),s=new f(0);return e.tickCurrent<n.tick?(r=n.feeGrowthOutsideX64A,s=n.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),s=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B)),{feeGrowthInsideX64A:o8.wrappingSubU128(o8.wrappingSubU128(e.feeGrowthGlobalX64A,i),r),feeGrowthInsideBX64:o8.wrappingSubU128(o8.wrappingSubU128(e.feeGrowthGlobalX64B,o),s)}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:r}=this.getfeeGrowthInside(e,n,i),s=o8.mulDivFloor(o8.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,oU),a=t.tokenFeesOwedA.add(s),u=o8.mulDivFloor(o8.wrappingSubU128(r,t.feeGrowthInsideLastX64B),t.liquidity,oU);return{tokenFeeAmountA:a,tokenFeeAmountB:t.tokenFeesOwedB.add(u)}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:r}=this.getfeeGrowthInside(e,n,i),s=o8.mulDivFloor(o8.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,oU),a=t.tokenFeesOwedA.add(s),u=o8.mulDivFloor(o8.wrappingSubU128(r,t.feeGrowthInsideLastX64B),t.liquidity,oU);return{tokenFeeAmountA:a,tokenFeeAmountB:t.tokenFeesOwedB.add(u)}}static GetPositionRewardsV2(e,t,n,i){let o=[],r=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let e=0;e<r.length;e++){let n=r[e],i=t.rewardInfos[e],s=o8.wrappingSubU128(n,i.growthInsideLastX64),a=o8.mulDivFloor(s,t.liquidity,oU),u=i.rewardAmountOwed.add(a);o.push(u)}return o}static GetPositionRewards(e,t,n,i){let o=[],r=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let e=0;e<r.length;e++){let n=r[e],i=t.rewardInfos[e],s=o8.wrappingSubU128(n,i.growthInsideLastX64),a=o8.mulDivFloor(s,t.liquidity,oU),u=i.rewardAmountOwed.add(a);o.push(u)}return o}static getRewardGrowthInside(e,t,n,i){let o=[];for(let r=0;r<i.length;r++){let s=new f(0);s=t.liquidityGross.eqn(0)?i[r].rewardGrowthGlobalX64:e<t.tick?i[r].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[r]):t.rewardGrowthsOutsideX64[r];let a=new f(0);n.liquidityGross.eqn(0)||(a=e<n.tick?n.rewardGrowthsOutsideX64[r]:i[r].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[r])),o.push(o8.wrappingSubU128(o8.wrappingSubU128(i[r].rewardGrowthGlobalX64,s),a))}return o}static getRewardGrowthInsideV2(e,t,n,i){let o=[];for(let r=0;r<i.length;r++){let s=new f(0);s=t.liquidityGross.eqn(0)?i[r].rewardGrowthGlobalX64:e<t.tick?i[r].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[r]):t.rewardGrowthsOutsideX64[r];let a=new f(0);n.liquidityGross.eqn(0)||(a=e<n.tick?n.rewardGrowthsOutsideX64[r]:i[r].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[r])),o.push(o8.wrappingSubU128(o8.wrappingSubU128(i[r].rewardGrowthGlobalX64,s),a))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:o,epochInfo:r}){var s,a,u,c;let l=o9.priceToSqrtPriceX64(new tg(e.price),e.mintA.decimals,e.mintB.decimals),d=o9.getSqrtPriceX64FromTick(t.tickLower),m=o9.getSqrtPriceX64FromTick(t.tickUpper),p=o?1+i:1-i,g=rt.getAmountsFromLiquidity(l,d,m,n,o),[h,y]=[nB(g.amountA,null==(s=e.mintA.extensions)?void 0:s.feeConfig,r,!0),nB(g.amountB,null==(a=e.mintB.extensions)?void 0:a.feeConfig,r,!0)],[w,b]=[nB(new f(new tg(g.amountA.toString()).mul(p).toFixed(0)),null==(u=e.mintA.extensions)?void 0:u.feeConfig,r,!0),nB(new f(new tg(g.amountB.toString()).mul(p).toFixed(0)),null==(c=e.mintB.extensions)?void 0:c.feeConfig,r,!0)];return{liquidity:n,amountA:h,amountB:y,amountSlippageA:w,amountSlippageB:b,expirationTime:nv(h.expirationTime,y.expirationTime)}}},o2=class{static getOutputAmountAndRemainAccounts(e,t,n,i,o,r=!1){let s=n.toBase58()===e.mintA.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||void 0===c||!l)throw Error("Invalid tick array");a.push(l);let{allTrade:d,amountCalculated:m,accounts:p,sqrtPriceX64:g,feeAmount:h}=rn.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,c,o,r);return a.push(...p),{allTrade:d,expectedAmountOut:m.mul(oV),remainingAccounts:a,executionPrice:g,feeAmount:h}}static getInputAmountAndRemainAccounts(e,t,n,i,o){let r=n.toBase58()===e.mintB.address,s=[],{isExist:a,startIndex:u,nextAccountMeta:c}=this.getFirstInitializedTickArray(e,r);if(!a||void 0===u||!c)throw Error("Invalid tick array");try{let t=this.preInitializedTickArrayStartIndex(e,r);if(t.isExist){let{publicKey:n}=oE(e.programId,e.id,t.nextStartIndex);s.push(n)}}catch{}s.push(c);let{amountCalculated:l,accounts:d,sqrtPriceX64:m,feeAmount:p}=rn.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,r,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(oV),u,o);return s.push(...d),{expectedAmountIn:l,remainingAccounts:s,executionPrice:m,feeAmount:p}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=o2.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?o4.checkTickArrayIsInit(o1.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):rr.checkTickArrayIsInitialized(rr.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:t}=oE(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:t}}let{isExist:o,nextStartIndex:r}=this.nextInitializedTickArrayStartIndex(e,o1.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:t}=oE(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:t}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/o1.tickCount(e.tickSpacing)),i=t?rr.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):rr.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=o1.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:o}=o0.nextInitializedTickArrayStartIndex(rr.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:r,tickIndex:s}=o4.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(r)return{isExist:!0,nextStartIndex:s};if((t=s)<-443636||t>443636)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:o}){var r,s,a;let u=[];for(let c=0;c<o.length;c++){let l=o[c],d=null!=(a=null==(r=t.rewardDefaultInfos[c])?void 0:r.mint.programId)?a:null==(s=await e.getAccountInfo(l.tokenMint))?void 0:s.owner;if(void 0===d)throw Error("get new reward mint info error");let m=_(W({},l),{perSecond:o8.x64ToDecimal(l.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new y.PublicKey(d)});if(m.tokenMint.equals(y.PublicKey.default))continue;if(n<=m.openTime.toNumber()||i.eq(oD)){u.push(m);continue}let p=new f(Math.min(m.endTime.toNumber(),n)),g=p.sub(m.lastUpdateTime),h=o8.mulDivFloor(g,m.emissionsPerSecondX64,i),w=m.rewardGrowthGlobalX64.add(h),b=o8.mulDivFloor(g,m.emissionsPerSecondX64,oU),k=m.rewardTotalEmissioned.add(b);u.push(_(W({},m),{rewardGrowthGlobalX64:w,rewardTotalEmissioned:k,lastUpdateTime:p}))}return u}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let o of t){let t=rr.getTickArrayStartIndexByTick(o,e);if(t>=n||t<i)return!0}return!1}static tickRange(e){let t=o0.maxTickInTickarrayBitmap(e),n=-t;return t>443636&&(t=o1.getArrayStartIndex(443636,e)+o1.tickCount(e)),n<-443636&&(n=o1.getArrayStartIndex(-443636,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!o1.checkIsValidStartIndex(e,t))throw Error("No enough initialized tickArray");return e/o1.tickCount(t)*ro}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await no(e,t.map(e=>({pubkey:e})),{batchRequest:n}),o={};for(let e of i)null!==e.accountInfo&&(o[e.pubkey.toString()]=ry.decode(e.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},o=[];for(let e of t){let t=rr.getTickArrayStartIndexByTick(e.tickCurrent,e.tickSpacing);for(let n of rr.getInitializedTickArrayInRange(e.tickArrayBitmap,e.exBitmapInfo,e.tickSpacing,t,7)){let{publicKey:t}=oE(e.programId,e.id,n);o.push({pubkey:t}),i[t.toString()]=e.id}}let r=await no(e,o,{batchRequest:n}),s={};for(let e of r){if(!e.accountInfo)continue;let t=i[e.pubkey.toString()];if(!t)continue;void 0===s[t.toString()]&&(s[t.toString()]={});let n=rg.decode(e.accountInfo.data);s[t.toString()][n.startTickIndex]=_(W({},n),{address:e.pubkey})}return s}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:o=!0}){var r;let s=[];for(let t=0;t<e.length;t++){let n=e[t];null!==n&&(s.find(e=>e.equals(n.state.programId))||s.push(n.state.programId))}if(n){let a=n.tokenAccounts.map(e=>e.accountInfo.mint),u=[];for(let e of a)for(let t of s)u.push(oM(t,e).publicKey);let c=await ni(t,u,{batchRequest:i}),l={};for(let t of c){if(null===t)continue;let n=rm.decode(t.data),i=n.poolId.toString(),o=e.find(e=>e.state.id.toBase58()===i);if(void 0===o)continue;let s=o.state,a=rr._getTickPriceLegacy({poolInfo:s,tick:n.tickLower,baseIn:!0}),u=rr._getTickPriceLegacy({poolInfo:s,tick:n.tickUpper,baseIn:!0}),{amountA:c,amountB:d}=rt.getAmountsFromLiquidity(s.sqrtPriceX64,a.tickSqrtPriceX64,u.tickSqrtPriceX64,n.liquidity,!1),m=1/(1-Math.sqrt(Math.sqrt(a.price.div(u.price).toNumber())));o.positionAccount=[...null!=(r=o.positionAccount)?r:[],{poolId:n.poolId,nftMint:n.nftMint,priceLower:a.price,priceUpper:u.price,amountA:c,amountB:d,tickLower:n.tickLower,tickUpper:n.tickUpper,liquidity:n.liquidity,feeGrowthInsideLastX64A:n.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:n.feeGrowthInsideLastX64B,tokenFeesOwedA:n.tokenFeesOwedA,tokenFeesOwedB:n.tokenFeesOwedB,rewardInfos:n.rewardInfos.map(e=>_(W({},e),{pendingReward:new f(0)})),leverage:m,tokenFeeAmountA:new f(0),tokenFeeAmountB:new f(0)}];let p=await rr.getTickArrayAddressByTick(o.state.programId,n.poolId,n.tickLower,o.state.tickSpacing),g=await rr.getTickArrayAddressByTick(o.state.programId,n.poolId,n.tickUpper,o.state.tickSpacing);l[`${o.state.programId.toString()}-${n.poolId.toString()}-${n.tickLower}`]=p,l[`${o.state.programId.toString()}-${n.poolId.toString()}-${n.tickUpper}`]=g}if(o){let n=Object.values(l),o=await ni(t,n,{batchRequest:i}),r={};for(let e=0;e<n.length;e++){let t=o[e];null!==t&&(r[n[e].toString()]=rg.decode(t.data))}for(let{state:t,positionAccount:n}of e)if(n)for(let e of n){let n=`${t.programId.toString()}-${t.id.toString()}-${e.tickLower}`,i=`${t.programId.toString()}-${t.id.toString()}-${e.tickUpper}`,o=r[l[n].toString()],s=r[l[i].toString()],a=o.ticks[rr.getTickOffsetInArray(e.tickLower,t.tickSpacing)],u=s.ticks[rr.getTickOffsetInArray(e.tickUpper,t.tickSpacing)],{tokenFeeAmountA:c,tokenFeeAmountB:d}=await o6.GetPositionFees(t,e,a,u),m=await o6.GetPositionRewards(t,e,a,u);e.tokenFeeAmountA=c.gte(new f(0))?c:new f(0),e.tokenFeeAmountB=d.gte(new f(0))?d:new f(0);for(let t=0;t<m.length;t++)e.rewardInfos[t].pendingReward=m[t].gte(new f(0))?m[t]:new f(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountIn:o,slippage:r,priceLimit:s=new tg(0),catchLiquidityInsufficient:a=!1}){var u;let c,l=n.toBase58()===e.mintA.address,[d,m]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];c=s.equals(new tg(0))?l?oz.add(new f(1)):oj.sub(new f(1)):o9.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let p=nB(o,d,i,!1),{allTrade:g,expectedAmountOut:h,remainingAccounts:y,executionPrice:w,feeAmount:b}=o2.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub(null!=(u=p.fee)?u:oD),c,a),k=nB(h,m,i,!1),A=o9.sqrtPriceX64ToPrice(w,e.mintA.decimals,e.mintB.decimals),I=l?A:new tg(1).div(A),P=nB(h.mul(new f(Math.floor((1-r)*1e10))).div(new f(1e10)),m,i,!1),T=l?e.currentPrice:new tg(1).div(e.currentPrice),S=new tg(I).sub(T).abs(),B=new tN(new tg(S).mul(1e15).toFixed(0),new tg(T).mul(1e15).toFixed(0));return{allTrade:g,realAmountIn:p,amountOut:k,minAmountOut:P,expirationTime:nv(p.expirationTime,k.expirationTime),currentPrice:e.currentPrice,executionPrice:I,priceImpact:B,fee:b,remainingAccounts:y,executionPriceX64:w}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:i,slippage:o,epochInfo:r,catchLiquidityInsufficient:s=!1}){let[a,u]=i.address===e.mintB.address?[e.mintA,e.mintB]:[e.mintB,e.mintA],[c,l]=[new tx(_(W({},a),{mint:a.address,isToken2022:a.programId===b.nA.toBase58()})),new tx(_(W({},u),{mint:u.address,isToken2022:u.programId===b.nA.toBase58()}))],{allTrade:d,realAmountIn:m,amountOut:p,minAmountOut:g,expirationTime:h,currentPrice:w,executionPrice:k,priceImpact:A,fee:I,remainingAccounts:P,executionPriceX64:T}=o2.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new y.PublicKey(a.address),amountIn:n,slippage:o,epochInfo:r,catchLiquidityInsufficient:s});return{allTrade:d,realAmountIn:_(W({},m),{amount:new tZ(c,m.amount),fee:void 0===m.fee?void 0:new tZ(c,m.fee)}),amountOut:_(W({},p),{amount:new tZ(l,p.amount),fee:void 0===p.fee?void 0:new tZ(l,p.fee)}),minAmountOut:_(W({},g),{amount:new tZ(l,g.amount),fee:void 0===g.fee?void 0:new tZ(l,g.fee)}),expirationTime:h,currentPrice:new tW({baseToken:c,denominator:new f(10).pow(new f(20+c.decimals)),quoteToken:l,numerator:w.mul(new tg(10**(20+l.decimals))).toFixed(0)}),executionPrice:new tW({baseToken:c,denominator:new f(10).pow(new f(20+c.decimals)),quoteToken:l,numerator:k.mul(new tg(10**(20+l.decimals))).toFixed(0)}),priceImpact:A,fee:new tZ(c,I),remainingAccounts:P,executionPriceX64:T}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var o,r,s;let a=e[t],u=rr.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),c=rr.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),l=Math.max(u,a.priceMin),d=Math.min(c,a.priceMax)-l,m=c-u,p=a.priceMax-a.priceMin,g;return g=d<=0?0:m===d?p/d:p===d?d/m:d/p*(d/m),{feeApr:a.feeApr*g,rewardsApr:[(null!=(o=a.rewardApr[0])?o:0)*g,(null!=(r=a.rewardApr[1])?r:0)*g,(null!=(s=a.rewardApr[2])?s:0)*g],apr:a.apr*g}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:o,positionTickLowerIndex:r,positionTickUpperIndex:s,chainTime:a}){let u=e[n],c=i[tv(e.mintA.address).toString()],l=i[tv(e.mintB.address).toString()],d=e.mintA.decimals,m=e.mintB.decimals;if(!u||!c||!l)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let p=o9.priceToSqrtPriceX64(new tg(e.price),e.mintA.decimals,e.mintB.decimals),g=o9.getSqrtPriceX64FromTick(r),h=o9.getSqrtPriceX64FromTick(s),{amountSlippageA:y,amountSlippageB:f}=rt.getAmountsFromLiquidityWithSlippage(p,g,h,t,!1,!1,0),{amountSlippageA:w,amountSlippageB:b}=rt.getAmountsFromLiquidityWithSlippage(p,g,h,o,!1,!1,0),k=new tg(y.toString()).div(new tg(10).pow(d)).mul(c.value).add(new tg(f.toString()).div(new tg(10).pow(m)).mul(l.value)),A=new tg(w.toString()).div(new tg(10).pow(d)).mul(c.value).add(new tg(b.toString()).div(new tg(10).pow(m)).mul(l.value)),I=new tg(1).div(k.add(A)),P=new tg(u.volumeFee).mul(365).div("day"===n?1:"week"===n?7:"month"===n?30:0).mul(I).mul(100).toNumber(),T=e.rewardDefaultInfos.map(e=>{var t,n;let o=e.mint.decimals,r=i[e.mint.address];return a<(null!=(t=e.startTime)?t:0)||a>(null!=(n=e.endTime)?n:0)||!e.perSecond||!r||void 0===o?0:new tg(r.value).mul(new tg(e.perSecond).mul(31536e3)).div(new tg(10).pow(o)).mul(I).mul(100).toNumber()});return{feeApr:P,rewardsApr:T,apr:P+T.reduce((e,t)=>e+t,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:o,slippage:r,add:s,epochInfo:a,amountHasFee:u}){var c,l;let d=o9.priceToSqrtPriceX64(new tg(e.price),e.mintA.decimals,e.mintB.decimals),m=o9.getSqrtPriceX64FromTick(n),p=o9.getSqrtPriceX64FromTick(i),g=nB(o,null==(c=e[t?"mintA":"mintB"].extensions)?void 0:c.feeConfig,a,!u),h=new f(new tg(g.amount.sub(null!=(l=g.fee)?l:oD).toString()).mul(s?1-r:1+r).toFixed(0)),y;if(d.lte(m))y=t?rt.getLiquidityFromTokenAmountA(m,p,h,!s):new f(0);else if(d.lte(p)){let e=rt.getLiquidityFromTokenAmountA(d,p,h,!s),n=rt.getLiquidityFromTokenAmountB(m,d,h);y=t?e:n}else y=t?new f(0):rt.getLiquidityFromTokenAmountB(m,p,h);return o2.getAmountsFromLiquidity({epochInfo:a,poolInfo:e,tickLower:n,tickUpper:i,liquidity:y,slippage:r,add:s})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:o,slippage:r,add:s}){var a,u,c,l;let d=o9.getSqrtPriceX64FromTick(n),m=o9.getSqrtPriceX64FromTick(i),p=s?1+r:1-r,g=rt.getAmountsFromLiquidity(o9.priceToSqrtPriceX64(new tg(t.price),t.mintA.decimals,t.mintB.decimals),d,m,o,s),[h,y]=[nB(g.amountA,null==(a=t.mintA.extensions)?void 0:a.feeConfig,e,!0),nB(g.amountB,null==(u=t.mintB.extensions)?void 0:u.feeConfig,e,!0)],[f,w]=[nB(g.amountA.muln(p),null==(c=t.mintA.extensions)?void 0:c.feeConfig,e,!0),nB(g.amountB.muln(p),null==(l=t.mintB.extensions)?void 0:l.feeConfig,e,!0)];return{liquidity:o,amountA:h,amountB:y,amountSlippageA:f,amountSlippageB:w,expirationTime:nv(h.expirationTime,y.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let i=t.filter(e=>!n[e.id]).map(e=>new y.PublicKey(e.id));(await ni(e,i)).forEach((e,t)=>{e&&(n[i[t].toBase58()]=rl.decode(e.data))});let o=t.map(e=>o_(new y.PublicKey(e.programId),new y.PublicKey(e.id)).publicKey),r=await o2.fetchExBitmaps({connection:e,exBitmapAddress:o,batchRequest:!1});return t.reduce((e,t)=>_(W({},e),{[t.id]:_(W({},n[t.id]),{id:new y.PublicKey(t.id),version:6,programId:new y.PublicKey(t.programId),mintA:t.mintA,mintB:t.mintB,ammConfig:_(W({},t.config),{id:new y.PublicKey(t.config.id),fundOwner:""}),currentPrice:new tg(t.price),exBitmapInfo:r[o_(new y.PublicKey(t.programId),new y.PublicKey(t.id)).publicKey.toBase58()],startTime:n[t.id].startTime.toNumber()})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}},o5={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]},o8=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),o=i.div(n);return i.mod(n).eq(oD)||(o=o.add(oN)),o}static mulDivFloor(e,t,n){if(n.eq(oD))throw Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(oD))throw Error("division by 0");return e.mul(t).add(n.sub(oN)).div(n)}static x64ToDecimal(e,t){return new tg(e.toString()).div(tg.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new f(e.mul(tg.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(oX).sub(t).mod(oX)}};function o3(e,t){return o7(e.mul(t),64,256)}function o7(e,t,n){let i=e.toTwos(n).shrn(t);return i.imaskn(n-t+1),i.fromTwos(n-t)}var o9=class{static sqrtPriceX64ToPrice(e,t,n){return o8.x64ToDecimal(e).pow(2).mul(tg.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return o8.decimalToX64(e.mul(tg.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(oD))throw Error("sqrtPriceX64 must greater than 0");if(!t.gt(oD))throw Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(oD))throw Error("sqrtPriceX64 must greater than 0");if(!t.gt(oD))throw Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(oD))return e;let o=t.shln(64);if(i){let t=o.add(n.mul(e));return t.gte(o)?o8.mulDivCeil(o,e,t):o8.mulDivRoundingUp(o,oN,o.div(e).add(n))}{let t=n.mul(e);if(!o.gt(t))throw Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let i=o.sub(t);return o8.mulDivCeil(o,e,i)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let o=n.shln(64);if(i)return e.add(o.div(t));{let n=o8.mulDivRoundingUp(o,oN,t);if(!e.gt(n))throw Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(n)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw Error("tick must be integer");if(e<-443636||e>443636)throw Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?-1*e:e,n=new f((1&t)!=0?"18445821805675395072":"18446744073709551616");return(2&t)!=0&&(n=o3(n,new f("18444899583751176192"))),(4&t)!=0&&(n=o3(n,new f("18443055278223355904"))),(8&t)!=0&&(n=o3(n,new f("18439367220385607680"))),(16&t)!=0&&(n=o3(n,new f("18431993317065453568"))),(32&t)!=0&&(n=o3(n,new f("18417254355718170624"))),(64&t)!=0&&(n=o3(n,new f("18387811781193609216"))),(128&t)!=0&&(n=o3(n,new f("18329067761203558400"))),(256&t)!=0&&(n=o3(n,new f("18212142134806163456"))),(512&t)!=0&&(n=o3(n,new f("17980523815641700352"))),(1024&t)!=0&&(n=o3(n,new f("17526086738831433728"))),(2048&t)!=0&&(n=o3(n,new f("16651378430235570176"))),(4096&t)!=0&&(n=o3(n,new f("15030750278694412288"))),(8192&t)!=0&&(n=o3(n,new f("12247334978884435968"))),(16384&t)!=0&&(n=o3(n,new f("8131365268886854656"))),(32768&t)!=0&&(n=o3(n,new f("3584323654725218816"))),(65536&t)!=0&&(n=o3(n,new f("696457651848324352"))),(131072&t)!=0&&(n=o3(n,new f("26294789957507116"))),(262144&t)!=0&&(n=o3(n,new f("37481735321082"))),e>0&&(n=oG.div(n)),n}static getTickFromPrice(e,t,n){return o9.getTickFromSqrtPriceX64(o9.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){let t;if(e.gt(oj)||e.lt(oz))throw Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let n=e.bitLength()-1,i=((t=new f(n-64).toTwos(128).shln(32)).imaskn(129),t.fromTwos(128)),o=new f("8000000000000000","hex"),r=0,s=new f(0),a=n>=64?e.shrn(n-63):e.shln(63-n);for(;o.gt(new f(0))&&r<16;){let e=(a=a.mul(a)).shrn(127);a=a.shrn(63+e.toNumber()),s=s.add(o.mul(e)),o=o.shrn(1),r+=1}let u=s.shrn(32),c=i.add(u).mul(new f("59543866431248")),l=o7(c.sub(new f("184467440737095516")),64,128).toNumber(),d=o7(c.add(new f("15793534762490258745")),64,128).toNumber();return l==d?l:o9.getSqrtPriceX64FromTick(d).lte(e)?d:l}},re=class{static getTickWithPriceAndTickspacing(e,t,n,i){let o=o9.getTickFromSqrtPriceX64(o9.priceToSqrtPriceX64(e,n,i))/t;return(o=o<0?Math.floor(o):Math.ceil(o))*t}static roundPriceWithTickspacing(e,t,n,i){let o=re.getTickWithPriceAndTickspacing(e,t,n,i),r=o9.getSqrtPriceX64FromTick(o);return o9.sqrtPriceX64ToPrice(r,n,i)}},rt=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(oD))throw Error("sqrtPriceX64A must greater than 0");let o=n.ushln(64),r=t.sub(e);return i?o8.mulDivRoundingUp(o8.mulDivCeil(o,r,t),oN,e):o8.mulDivFloor(o,r,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(oD))throw Error("sqrtPriceX64A must greater than 0");return i?o8.mulDivCeil(n,t.sub(e),oU):o8.mulDivFloor(n,t.sub(e),oU)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),r=t.sub(e),s=o.div(r);return i?o8.mulDivRoundingUp(s,oN,oH):s.shrn(64)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),o8.mulDivFloor(n,oH,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return rt.getLiquidityFromTokenAmountA(t,n,i,!1);if(!e.lt(n))return rt.getLiquidityFromTokenAmountB(t,n,o);{let r=rt.getLiquidityFromTokenAmountA(e,n,i,!1),s=rt.getLiquidityFromTokenAmountB(t,e,o);return r.lt(s)?r:s}}static getAmountsFromLiquidity(e,t,n,i,o){return(t.gt(n)&&([t,n]=[n,t]),e.lte(t))?{amountA:rt.getTokenAmountAFromLiquidity(t,n,i,o),amountB:new f(0)}:e.lt(n)?{amountA:rt.getTokenAmountAFromLiquidity(e,n,i,o),amountB:rt.getTokenAmountBFromLiquidity(t,e,i,o)}:{amountA:new f(0),amountB:rt.getTokenAmountBFromLiquidity(t,n,i,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,o,r,s){let{amountA:a,amountB:u}=rt.getAmountsFromLiquidity(e,t,n,i,r),c=o?1+s:1-s;return{amountSlippageA:new f(new tg(a.toString()).mul(c).toFixed(0)),amountSlippageB:new f(new tg(u.toString()).mul(c).toFixed(0))}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:o,add:r,epochInfo:s,amountAddFee:a}){var u,c,l,d;let m=o9.priceToSqrtPriceX64(new tg(e.price),e.mintA.decimals,e.mintB.decimals),p=o9.getSqrtPriceX64FromTick(t),g=o9.getSqrtPriceX64FromTick(n),h=r?1+o:1-o,y=rt.getAmountsFromLiquidity(m,p,g,i,r),[w,b]=[nB(y.amountA,null==(u=e.mintA.extensions)?void 0:u.feeConfig,s,a),nB(y.amountB,null==(c=e.mintB.extensions)?void 0:c.feeConfig,s,a)],[k,A]=[nB(new f(new tg(y.amountA.toString()).mul(h).toFixed(0)),null==(l=e.mintA.extensions)?void 0:l.feeConfig,s,a),nB(new f(new tg(y.amountB.toString()).mul(h).toFixed(0)),null==(d=e.mintB.extensions)?void 0:d.feeConfig,s,a)];return{liquidity:i,amountA:w,amountB:b,amountSlippageA:k,amountSlippageB:A,expirationTime:nv(w.expirationTime,b.expirationTime)}}},rn=class{static swapCompute(e,t,n,i,o,r,s,a,u,c,l,d,m,p,g=!1){if(d.eq(oD))throw Error("amountSpecified must not be 0");if(p||(p=r?oz.add(oN):oj.sub(oN)),r){if(p.lt(oz))throw Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(p.gte(l))throw Error("sqrtPriceX64 must smaller than current")}else{if(p.gt(oj))throw Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(p.lte(l))throw Error("sqrtPriceX64 must greater than current")}let h=d.gt(oD),y={amountSpecifiedRemaining:d,amountCalculated:oD,sqrtPriceX64:l,tick:u>m?Math.min(m+o1.tickCount(c)-1,u):m,accounts:[],liquidity:a,feeAmount:new f(0)},w=m,b=n[m],k=!r&&b.startTickIndex===y.tick;for(;!y.amountSpecifiedRemaining.eq(oD)&&!y.sqrtPriceX64.eq(p);){let a;let u={};u.sqrtPriceStartX64=y.sqrtPriceX64;let l=rr.nextInitTick(b,y.tick,c,r,k)||null,d=null;if(!(null!=l&&l.liquidityGross.gtn(0))){let s=o2.nextInitializedTickArrayStartIndex({tickCurrent:y.tick,tickSpacing:c,tickArrayBitmap:i,exBitmapInfo:o},w,r);if(!s.isExist){if(g)return{allTrade:!1,amountSpecifiedRemaining:y.amountSpecifiedRemaining,amountCalculated:y.amountCalculated,feeAmount:y.feeAmount,sqrtPriceX64:y.sqrtPriceX64,liquidity:y.liquidity,tickCurrent:y.tick,accounts:y.accounts};throw Error("swapCompute LiquidityInsufficient")}let{publicKey:a}=oE(e,t,w=s.nextStartIndex);d=a,b=n[w];try{l=rr.firstInitializedTick(b,r)}catch{throw Error("not found next tick info")}}if(u.tickNext=l.tick,u.initialized=l.liquidityGross.gtn(0),m!==w&&d&&(y.accounts.push(d),m=w),u.tickNext<-443636?u.tickNext=-443636:u.tickNext>443636&&(u.tickNext=443636),u.sqrtPriceNextX64=o9.getSqrtPriceX64FromTick(u.tickNext),a=r&&u.sqrtPriceNextX64.lt(p)||!r&&u.sqrtPriceNextX64.gt(p)?p:u.sqrtPriceNextX64,[y.sqrtPriceX64,u.amountIn,u.amountOut,u.feeAmount]=rn.swapStepCompute(y.sqrtPriceX64,a,y.liquidity,y.amountSpecifiedRemaining,s),y.feeAmount=y.feeAmount.add(u.feeAmount),h?(y.amountSpecifiedRemaining=y.amountSpecifiedRemaining.sub(u.amountIn.add(u.feeAmount)),y.amountCalculated=y.amountCalculated.sub(u.amountOut)):(y.amountSpecifiedRemaining=y.amountSpecifiedRemaining.add(u.amountOut),y.amountCalculated=y.amountCalculated.add(u.amountIn.add(u.feeAmount))),y.sqrtPriceX64.eq(u.sqrtPriceNextX64)){if(u.initialized){let e=l.liquidityNet;r&&(e=e.mul(oV)),y.liquidity=rt.addDelta(y.liquidity,e)}k=u.tickNext!=y.tick&&!r&&b.startTickIndex===u.tickNext,y.tick=r?u.tickNext-1:u.tickNext}else if(y.sqrtPriceX64!=u.sqrtPriceStartX64){let e=o9.getTickFromSqrtPriceX64(y.sqrtPriceX64);k=e!=y.tick&&!r&&b.startTickIndex===e,y.tick=e}}try{let{nextStartIndex:n,isExist:s}=o1.nextInitializedTickArray(y.tick,c,r,i,o);s&&m!==n&&(y.accounts.push(oE(e,t,n).publicKey),m=n)}catch{}return{allTrade:!0,amountSpecifiedRemaining:oD,amountCalculated:y.amountCalculated,feeAmount:y.feeAmount,sqrtPriceX64:y.sqrtPriceX64,liquidity:y.liquidity,tickCurrent:y.tick,accounts:y.accounts}}static swapStepCompute(e,t,n,i,o){let r={sqrtPriceX64Next:new f(0),amountIn:new f(0),amountOut:new f(0),feeAmount:new f(0)},s=e.gte(t),a=i.gte(oD);if(a){let a=o8.mulDivFloor(i,oY.sub(new f(o.toString())),oY);r.amountIn=s?rt.getTokenAmountAFromLiquidity(t,e,n,!0):rt.getTokenAmountBFromLiquidity(e,t,n,!0),a.gte(r.amountIn)?r.sqrtPriceX64Next=t:r.sqrtPriceX64Next=o9.getNextSqrtPriceX64FromInput(e,n,a,s)}else r.amountOut=s?rt.getTokenAmountBFromLiquidity(t,e,n,!1):rt.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(oV).gte(r.amountOut)?r.sqrtPriceX64Next=t:r.sqrtPriceX64Next=o9.getNextSqrtPriceX64FromOutput(e,n,i.mul(oV),s);let u=t.eq(r.sqrtPriceX64Next);return s?(u&&a||(r.amountIn=rt.getTokenAmountAFromLiquidity(r.sqrtPriceX64Next,e,n,!0)),u&&!a||(r.amountOut=rt.getTokenAmountBFromLiquidity(r.sqrtPriceX64Next,e,n,!1))):(r.amountIn=u&&a?r.amountIn:rt.getTokenAmountBFromLiquidity(e,r.sqrtPriceX64Next,n,!0),r.amountOut=u&&!a?r.amountOut:rt.getTokenAmountAFromLiquidity(e,r.sqrtPriceX64Next,n,!1)),!a&&r.amountOut.gt(i.mul(oV))&&(r.amountOut=i.mul(oV)),a&&!r.sqrtPriceX64Next.eq(t)?r.feeAmount=i.sub(r.amountIn):r.feeAmount=o8.mulDivCeil(r.amountIn,new f(o),oY.sub(new f(o))),[r.sqrtPriceX64Next,r.amountIn,r.amountOut,r.feeAmount]}},ri=60,ro=512,rr=class{static getTickArrayAddressByTick(e,t,n,i){let{publicKey:o}=oE(e,t,rr.getTickArrayStartIndexByTick(n,i));return o}static getTickOffsetInArray(e,t){if(e%t!=0)throw Error("tickIndex % tickSpacing not equal 0");let n=rr.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=ri)throw Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=o1.tickCount(t),i=e/n;return e<0&&e%n!=0?Math.ceil(i)-1:Math.floor(i)}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*o1.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){return Math.abs(Math.floor(e/(t*ri))+512)}static checkTickArrayIsInitialized(e,t,n){let i=n*ri,o=Math.abs(Math.floor(t/i)+512);return{isInitialized:e.testn(o),startIndex:(o-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*ri:e+t*ri}static mergeTickArrayBitmap(e){let t=new f(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,o){let r=Math.floor(i/(n*ri));return[...rr.searchLowBitFromStart(e,t,r-1,o,n),...rr.searchHightBitFromStart(e,t,r,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return rr.searchHightBitFromStart(e,t,0,ro,n)}static getAllInitializedTickArrayInfo(e,t,n,i,o){let r=[];for(let s of rr.getAllInitializedTickArrayStartIndex(n,i,o)){let{publicKey:n}=oE(e,t,s);r.push({tickArrayStartIndex:s,tickArrayAddress:n})}return r}static getAllInitializedTickInTickArray(e){return e.ticks.filter(e=>e.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,o){let r=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(e=>rr.mergeTickArrayBitmap(e)),s=[];for(;n>=-7680;){let e=Math.floor((n+7680)/512),t=(n+7680)%512;if(r[e].testn(t)&&s.push(n),n--,s.length===i)break}let a=o1.tickCount(o);return s.map(e=>e*a)}static searchHightBitFromStart(e,t,n,i,o){let r=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(e=>rr.mergeTickArrayBitmap(e)),s=[];for(;n<7680;){let e=Math.floor((n+7680)/512),t=(n+7680)%512;if(r[e].testn(t)&&s.push(n),n++,s.length===i)break}let a=o1.tickCount(o);return s.map(e=>e*a)}static checkIsOutOfBoundary(e){return e<-443636||e>443636}static nextInitTick(e,t,n,i,o){if(o1.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let r=Math.floor((t-e.startTickIndex)/n);if(i)for(;r>=0;){if(e.ticks[r].liquidityGross.gtn(0))return e.ticks[r];r-=1}else for(o||(r+=1);r<ri;){if(e.ticks[r].liquidityGross.gtn(0))return e.ticks[r];r+=1}return null}static firstInitializedTick(e,t){if(t){let t=ri-1;for(;t>=0;){if(e.ticks[t].liquidityGross.gtn(0))return e.ticks[t];t-=1}}else{let t=0;for(;t<ri;){if(e.ticks[t].liquidityGross.gtn(0))return e.ticks[t];t+=1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=o9.getSqrtPriceX64FromTick(t),o=o9.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new tg(1).div(o),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new tg(1).div(t),o=re.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),r=o9.getSqrtPriceX64FromTick(o),s=o9.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:s}:{tick:o,price:new tg(1).div(s)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=o9.getSqrtPriceX64FromTick(t),o=o9.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new tg(1).div(o),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new tg(1).div(t),o=re.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),r=o9.getSqrtPriceX64FromTick(o),s=o9.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:s}:{tick:o,price:new tg(1).div(s)}}},rs=ii([nY(8),n0("bump"),nG("index"),n3(""),n4("protocolFeeRate"),n4("tradeFeeRate"),nG("tickSpacing"),io(n6(),8,"")]),ra=ii([n4("blockTimestamp"),n2("sqrtPriceX64"),n2("cumulativeTimePriceX64"),io(n2(),1,"")]),ru=ii([nY(8),n7("initialized"),n3("poolId"),io(ra,1e3,"observations"),io(n2(),5,"")]),rc=ii([n0("rewardState"),n6("openTime"),n6("endTime"),n6("lastUpdateTime"),n2("emissionsPerSecondX64"),n6("rewardTotalEmissioned"),n6("rewardClaimed"),n3("tokenMint"),n3("tokenVault"),n3("creator"),n2("rewardGrowthGlobalX64")]),rl=ii([nY(8),n0("bump"),n3("ammConfig"),n3("creator"),n3("mintA"),n3("mintB"),n3("vaultA"),n3("vaultB"),n3("observationId"),n0("mintDecimalsA"),n0("mintDecimalsB"),nG("tickSpacing"),n2("liquidity"),n2("sqrtPriceX64"),nQ("tickCurrent"),nG("observationIndex"),nG("observationUpdateDuration"),n2("feeGrowthGlobalX64A"),n2("feeGrowthGlobalX64B"),n6("protocolFeesTokenA"),n6("protocolFeesTokenB"),n2("swapInAmountTokenA"),n2("swapOutAmountTokenB"),n2("swapInAmountTokenB"),n2("swapOutAmountTokenA"),n0("status"),io(n0(),7,""),io(rc,3,"rewardInfos"),io(n6(),16,"tickArrayBitmap"),n6("totalFeesTokenA"),n6("totalFeesClaimedTokenA"),n6("totalFeesTokenB"),n6("totalFeesClaimedTokenB"),n6("fundFeesTokenA"),n6("fundFeesTokenB"),n6("startTime"),io(n6(),57,"padding")]),rd=ii([n2("growthInsideLastX64"),n6("rewardAmountOwed")]),rm=ii([nY(8),n0("bump"),n3("nftMint"),n3("poolId"),nQ("tickLower"),nQ("tickUpper"),n2("liquidity"),n2("feeGrowthInsideLastX64A"),n2("feeGrowthInsideLastX64B"),n6("tokenFeesOwedA"),n6("tokenFeesOwedB"),io(rd,3,"rewardInfos"),io(n6(),8,"")]),rp=(ii([nY(8),n0("bump"),n3("poolId"),nQ("tickLowerIndex"),nQ("tickUpperIndex"),n2("liquidity"),n2("feeGrowthInsideLastX64A"),n2("feeGrowthInsideLastX64B"),n6("tokenFeesOwedA"),n6("tokenFeesOwedB"),io(n2(),3,"rewardGrowthInside"),io(n6(),8,"")]),ii([nQ("tick"),new nJ(16,!0,"liquidityNet"),n2("liquidityGross"),n2("feeGrowthOutsideX64A"),n2("feeGrowthOutsideX64B"),io(n2(),3,"rewardGrowthsOutsideX64"),io(n4(),13,"")])),rg=ii([nY(8),n3("poolId"),nQ("startTickIndex"),io(rp,ri,"ticks"),n0("initializedTickCount"),io(n0(),115,"")]),rh=ii([nY(329),io(n3(),100,"whitelistMints")]),ry=ii([nY(8),n3("poolId"),io(io(n6(),8),14,"positiveTickArrayBitmap"),io(io(n6(),8),14,"negativeTickArrayBitmap")]),rf=H("Raydium_Clmm"),rw={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},rb=class{static createPoolInstruction(e,t,n,i,o,r,s,a,u,c,l,d,m,p){let g=ii([n2("sqrtPriceX64"),n6("startTime")]),h=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:y.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:tA,isSigner:!1,isWritable:!1}],f=x.alloc(g.span);g.encode({sqrtPriceX64:m,startTime:p},f);let w=x.from([...rw.createPool,...f]);return new y.TransactionInstruction({keys:h,programId:e,data:w})}static async createPoolInstructions(e){let{connection:t,programId:n,owner:i,mintA:o,mintB:r,ammConfigId:s,initialPriceX64:a,startTime:u,forerunCreate:c}=e,l=iA({fromPublicKey:i,programId:n}),[d,m]=[new y.PublicKey(o.address),new y.PublicKey(r.address)],p=[y.SystemProgram.createAccountWithSeed({fromPubkey:i,basePubkey:i,seed:l.seed,newAccountPubkey:l.publicKey,lamports:c?0:await t.getMinimumBalanceForRentExemption(ru.span),space:ru.span,programId:n})],{publicKey:g}=t8([ov,s.toBuffer(),d.toBuffer(),m.toBuffer()],n),{publicKey:h}=oL(n,g,d),{publicKey:f}=oL(n,g,m);return p.push(this.createPoolInstruction(n,g,i,s,l.publicKey,d,h,new y.PublicKey(o.programId||b.H_),m,f,new y.PublicKey(r.programId||b.H_),o_(n,g).publicKey,a,u)),{signers:[],instructions:p,instructionTypes:[tJ.CreateAccount,tJ.ClmmCreatePool],address:{poolId:g,observationId:l.publicKey,mintAVault:h,mintBVault:f},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,o,r,s,a,u,c,l,d,m,p,g,h,f,w,k,A,I,P,T,S,B,v){let K=ii([nQ("tickLowerIndex"),nQ("tickUpperIndex"),nQ("tickArrayLowerStartIndex"),nQ("tickArrayUpperStartIndex"),n2("liquidity"),n6("amountMaxA"),n6("amountMaxB"),n7("withMetadata"),n0("optionBaseFlag"),n7("baseFlag")]),C=[...v?[{pubkey:v,isSigner:!1,isWritable:!0}]:[]],O=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:tA,isSigner:!1,isWritable:!1},{pubkey:y.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:b.H_,isSigner:!1,isWritable:!1},{pubkey:b._u,isSigner:!1,isWritable:!1},{pubkey:tP,isSigner:!1,isWritable:!1},{pubkey:b.nA,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},...C],q=x.alloc(K.span);K.encode({tickLowerIndex:w,tickUpperIndex:k,tickArrayLowerStartIndex:A,tickArrayUpperStartIndex:I,liquidity:P,amountMaxA:T,amountMaxB:S,withMetadata:"create"===B,baseFlag:!1,optionBaseFlag:0},q);let R=x.from([...rw.openPosition,...q]);return new y.TransactionInstruction({keys:O,programId:e,data:R})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:r,amountMaxA:s,amountMaxB:a,withMetadata:u,getEphemeralSigners:c}){let l=[],[d,m]=[new y.PublicKey(e.programId),new y.PublicKey(e.id)],p;if(c)p=new y.PublicKey((await c(1))[0]);else{let e=y.Keypair.generate();l.push(e),p=e.publicKey}let g=rr.getTickArrayStartIndexByTick(i,e.config.tickSpacing),h=rr.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:f}=oE(d,m,g),{publicKey:w}=oE(d,m,h),{publicKey:k}=nS(n.wallet,p,b.H_),{publicKey:A}=oW(p),{publicKey:I}=oM(d,p),{publicKey:P}=oF(d,m,i,o);return{signers:l,instructions:[this.openPositionFromLiquidityInstruction(d,n.feePayer,m,n.wallet,p,k,A,P,f,w,I,n.tokenAccountA,n.tokenAccountB,new y.PublicKey(t.vault.A),new y.PublicKey(t.vault.B),new y.PublicKey(e.mintA.address),new y.PublicKey(e.mintB.address),i,o,g,h,r,s,a,u)],instructionTypes:[tJ.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:p,tickArrayLower:f,tickArrayUpper:w,positionNftAccount:k,metadataAccount:A,personalPosition:I,protocolPosition:P}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:r,baseAmount:s,otherAmountMax:a,withMetadata:u,getEphemeralSigners:c}){let l=[],[d,m]=[new y.PublicKey(e.programId),new y.PublicKey(e.id)],p;if(c)p=new y.PublicKey((await c(1))[0]);else{let e=y.Keypair.generate();l.push(e),p=e.publicKey}let g=rr.getTickArrayStartIndexByTick(i,e.config.tickSpacing),h=rr.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:f}=oE(d,m,g),{publicKey:w}=oE(d,m,h),{publicKey:k}=nS(n.wallet,p,b.H_),{publicKey:A}=oW(p),{publicKey:I}=oM(d,p),{publicKey:P}=oF(d,m,i,o),T=this.openPositionFromBaseInstruction(d,n.feePayer,m,n.wallet,p,k,A,P,f,w,I,n.tokenAccountA,n.tokenAccountB,new y.PublicKey(t.vault.A),new y.PublicKey(t.vault.B),new y.PublicKey(e.mintA.address),new y.PublicKey(e.mintB.address),i,o,g,h,u,r,s,a,o2.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[g,h])?o_(d,m).publicKey:void 0);return{address:{nftMint:p,tickArrayLower:f,tickArrayUpper:w,positionNftAccount:k,metadataAccount:A,personalPosition:I,protocolPosition:P},instructions:[T],signers:l,instructionTypes:[tJ.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,o,r,s,a,u,c,l,d,m,p,g,h,w,k,A,I,P,T,S,B,v,K){let C=ii([nQ("tickLowerIndex"),nQ("tickUpperIndex"),nQ("tickArrayLowerStartIndex"),nQ("tickArrayUpperStartIndex"),n2("liquidity"),n6("amountMaxA"),n6("amountMaxB"),n7("withMetadata"),n0("optionBaseFlag"),n7("baseFlag")]),O=[...K?[{pubkey:K,isSigner:!1,isWritable:!0}]:[]],q=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:tA,isSigner:!1,isWritable:!1},{pubkey:y.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:b.H_,isSigner:!1,isWritable:!1},{pubkey:b._u,isSigner:!1,isWritable:!1},{pubkey:tP,isSigner:!1,isWritable:!1},{pubkey:b.nA,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...O],R=x.alloc(C.span);C.encode({tickLowerIndex:k,tickUpperIndex:A,tickArrayLowerStartIndex:I,tickArrayUpperStartIndex:P,liquidity:new f(0),amountMaxA:"MintA"===S?B:v,amountMaxB:"MintA"===S?v:B,withMetadata:"create"===T,baseFlag:"MintA"===S,optionBaseFlag:1},R);let L=x.from([...rw.openPosition,...R]);return new y.TransactionInstruction({keys:q,programId:e,data:L})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:r,amountMaxA:s,amountMaxB:a,withMetadata:u,getEphemeralSigners:c}){let l,d=[];if(c)l=new y.PublicKey((await c(1))[0]);else{let e=y.Keypair.generate();d.push(e),l=e.publicKey}let[m,p]=[new y.PublicKey(e.programId),new y.PublicKey(e.id)],g=rr.getTickArrayStartIndexByTick(i,e.config.tickSpacing),h=rr.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:f}=oE(m,p,g),{publicKey:w}=oE(m,p,h),{publicKey:k}=nS(n.wallet,l,b.H_),{publicKey:A}=oW(l),{publicKey:I}=oM(m,l),{publicKey:P}=oF(m,p,i,o),T=this.openPositionFromLiquidityInstruction(m,n.wallet,p,n.wallet,l,k,A,P,f,w,I,n.tokenAccountA,n.tokenAccountB,new y.PublicKey(t.vault.A),new y.PublicKey(t.vault.B),new y.PublicKey(t.mintA.address),new y.PublicKey(t.mintB.address),i,o,g,h,r,s,a,u,o2.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[g,h])?o_(m,p).publicKey:void 0);return{address:{nftMint:l,tickArrayLower:f,tickArrayUpper:w,positionNftAccount:k,metadataAccount:A,personalPosition:I,protocolPosition:P},instructions:[T],signers:d,instructionTypes:[tJ.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,o){let r=ii([]),s=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:y.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:b.H_,isSigner:!1,isWritable:!1}],a=x.alloc(r.span);r.encode({},a);let u=x.from([...rw.closePosition,...a]);return new y.TransactionInstruction({keys:s,programId:e,data:u})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i}){let o=new y.PublicKey(e.programId),{publicKey:r}=nS(n.wallet,i.nftMint,b.H_),{publicKey:s}=oM(o,i.nftMint),a=[];return a.push(this.closePositionInstruction(o,n.wallet,i.nftMint,r,s)),{address:{positionNftAccount:r,personalPosition:s},signers:[],instructions:a,instructionTypes:[tJ.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,o,r,s,a,u,c,l,d,m,p,g,h,f,w){let k=ii([n2("liquidity"),n6("amountMaxA"),n6("amountMaxB"),n0("optionBaseFlag"),n7("baseFlag")]),A=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[]],I=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:b.H_,isSigner:!1,isWritable:!1},{pubkey:b.nA,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...A],P=x.alloc(k.span);k.encode({liquidity:g,amountMaxA:h,amountMaxB:f,optionBaseFlag:0,baseFlag:!1},P);let T=x.from([...rw.increaseLiquidity,...P]);return new y.TransactionInstruction({keys:I,programId:e,data:T})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMaxA:r,amountMaxB:s}){let[a,u]=[new y.PublicKey(e.programId),new y.PublicKey(e.id)],c=rr.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),l=rr.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=oE(a,u,c),{publicKey:m}=oE(a,u,l),{publicKey:p}=nS(i.wallet,n.nftMint,b.H_),{publicKey:g}=oM(a,n.nftMint),{publicKey:h}=oF(a,u,n.tickLower,n.tickUpper),f=this.increasePositionFromLiquidityInstruction(a,i.wallet,p,g,u,h,d,m,i.tokenAccountA,i.tokenAccountB,new y.PublicKey(t.vault.A),new y.PublicKey(t.vault.B),new y.PublicKey(e.mintA.address),new y.PublicKey(e.mintB.address),o,r,s,o2.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,l])?o_(a,u).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:m,positionNftAccount:p,personalPosition:g,protocolPosition:h},signers:[],instructions:[f],instructionTypes:[tJ.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:o,baseAmount:r,otherAmountMax:s}){let[a,u]=[new y.PublicKey(e.programId),new y.PublicKey(e.id)],c=rr.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),l=rr.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=oE(a,u,c),{publicKey:m}=oE(a,u,l),{publicKey:p}=nS(i.wallet,n.nftMint,b.H_),{publicKey:g}=oM(a,n.nftMint),{publicKey:h}=oF(a,u,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:m,positionNftAccount:p,personalPosition:g,protocolPosition:h},instructions:[this.increasePositionFromBaseInstruction(a,i.wallet,p,g,u,h,d,m,i.tokenAccountA,i.tokenAccountB,new y.PublicKey(t.vault.A),new y.PublicKey(t.vault.B),new y.PublicKey(e.mintA.address),new y.PublicKey(e.mintB.address),o,r,s,o2.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[c,l])?o_(a,u).publicKey:void 0)],signers:[],instructionTypes:[tJ.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,o,r,s,a,u,c,l,d,m,p,g,h,w,k){let A=ii([n2("liquidity"),n6("amountMaxA"),n6("amountMaxB"),n0("optionBaseFlag"),n7("baseFlag")]),I=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[]],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:b.H_,isSigner:!1,isWritable:!1},{pubkey:b.nA,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...I],T=x.alloc(A.span);A.encode({liquidity:new f(0),amountMaxA:"MintA"===g?h:w,amountMaxB:"MintA"===g?w:h,baseFlag:"MintA"===g,optionBaseFlag:1},T);let S=x.from([...rw.increaseLiquidity,...T]);return new y.TransactionInstruction({keys:P,programId:e,data:S})}static decreaseLiquidityInstruction(e,t,n,i,o,r,s,a,u,c,l,d,m,p,g,h,f,w,k){let A=ii([n2("liquidity"),n6("amountMinA"),n6("amountMinB")]),I=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[],...g.map(e=>[{pubkey:e.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:e.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:e.rewardMint,isSigner:!1,isWritable:!1}]).flat()],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:b.H_,isSigner:!1,isWritable:!1},{pubkey:b.nA,isSigner:!1,isWritable:!1},{pubkey:tb,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...I],T=x.alloc(A.span);A.encode({liquidity:h,amountMinA:f,amountMinB:w},T);let S=x.from([...rw.decreaseLiquidity,...T]);return new y.TransactionInstruction({keys:P,programId:e,data:S})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMinA:r,amountMinB:s,programId:a}){let[u,c]=[new y.PublicKey(e.programId),new y.PublicKey(e.id)],l=rr.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=rr.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:m}=oE(u,c,l),{publicKey:p}=oE(u,c,d),{publicKey:g}=nS(i.wallet,n.nftMint,a),{publicKey:h}=oM(u,n.nftMint),{publicKey:f}=oF(u,c,n.tickLower,n.tickUpper),w=[];for(let n=0;n<e.rewardDefaultInfos.length;n++)w.push({poolRewardVault:new y.PublicKey(t.rewardInfos[n].vault),ownerRewardVault:i.rewardAccounts[n],rewardMint:new y.PublicKey(e.rewardDefaultInfos[n].mint.address)});let b=[];return b.push(this.decreaseLiquidityInstruction(u,i.wallet,g,h,c,f,m,p,i.tokenAccountA,i.tokenAccountB,new y.PublicKey(t.vault.A),new y.PublicKey(t.vault.B),new y.PublicKey(e.mintA.address),new y.PublicKey(e.mintB.address),w,o,r,s,o2.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,d])?o_(u,c).publicKey:void 0)),{address:{tickArrayLower:m,tickArrayUpper:p,positionNftAccount:g,personalPosition:h,protocolPosition:f},signers:[],instructions:b,instructionTypes:[tJ.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,o,r,s,a,u,c,l,d,m,p,g,h,f){let w=ii([n6("amount"),n6("otherAmountThreshold"),n2("sqrtPriceLimitX64"),n7("isBaseInput")]),k=[...f?[{pubkey:f,isSigner:!1,isWritable:!0}]:[],...l.map(e=>({pubkey:e,isSigner:!1,isWritable:!0}))],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:b.H_,isSigner:!1,isWritable:!1},{pubkey:b.nA,isSigner:!1,isWritable:!1},{pubkey:tb,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},...k],I=x.alloc(w.span);w.encode({amount:m,otherAmountThreshold:p,sqrtPriceLimitX64:g,isBaseInput:h},I);let P=x.from([...rw.swap,...I]);return new y.TransactionInstruction({keys:A,programId:e,data:P})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,inputMint:o,amountIn:r,amountOutMin:s,sqrtPriceLimitX64:a,remainingAccounts:u}){let[c,l]=[new y.PublicKey(e.programId),new y.PublicKey(e.id)],[d,m]=[new y.PublicKey(t.vault.A),new y.PublicKey(t.vault.B)],[p,g]=[new y.PublicKey(e.mintA.address),new y.PublicKey(e.mintB.address)],h=e.mintA.address===o.toString();return{signers:[],instructions:[this.swapInstruction(c,i.wallet,l,new y.PublicKey(e.config.id),h?i.tokenAccountA:i.tokenAccountB,h?i.tokenAccountB:i.tokenAccountA,h?d:m,h?m:d,h?p:g,h?g:p,u,n,r,s,a,!0,o_(c,l).publicKey)],instructionTypes:[tJ.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,o,r,s,a,u,c,l,d){let m=ii([n6("openTime"),n6("endTime"),n2("emissionsPerSecondX64")]),p=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:y.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:tA,isSigner:!1,isWritable:!1}],g=x.alloc(m.span);m.encode({openTime:tG(c),endTime:tG(l),emissionsPerSecondX64:d},g);let h=x.from([...rw.initReward,...g]);return new y.TransactionInstruction({keys:p,programId:e,data:h})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){var o;let[r,s]=[new y.PublicKey(e.programId),new y.PublicKey(e.id)],a=(o=i.mint,t8([oC,s.toBuffer(),o.toBuffer()],r)).publicKey,u=t8([oq],r).publicKey,c=[this.initRewardInstruction(r,n.wallet,s,u,new y.PublicKey(e.config.id),n.tokenAccount,i.programId,i.mint,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[tJ.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,o,r,s,a,u,c,l,d){let m=ii([n0("rewardIndex"),n2("emissionsPerSecondX64"),n6("openTime"),n6("endTime")]),p=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:b.H_,isSigner:!1,isWritable:!1},{pubkey:b.nA,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0}],g=x.alloc(m.span);m.encode({rewardIndex:u,emissionsPerSecondX64:d,openTime:tG(c),endTime:tG(l)},g);let h=x.from([...rw.setRewardEmissions,...g]);return new y.TransactionInstruction({keys:p,programId:e,data:h})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,r]=[new y.PublicKey(e.programId),new y.PublicKey(e.id)],s,a,u;for(let n=0;n<e.rewardDefaultInfos.length;n++)e.rewardDefaultInfos[n].mint.address===i.mint.toString()&&(s=n,a=new y.PublicKey(t.rewardInfos[n].vault),u=new y.PublicKey(t.rewardInfos[n].mint.address));(void 0===s||void 0===a)&&rf.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=t8([oq],o).publicKey,l=[this.setRewardInstruction(o,n.wallet,r,c,new y.PublicKey(e.config.id),n.tokenAccount,a,u,s,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:a,operationId:c},signers:[],instructions:l,instructionTypes:[tJ.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,o,r,s){let a=ii([n0("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:b.H_,isSigner:!1,isWritable:!1},{pubkey:b.nA,isSigner:!1,isWritable:!1},{pubkey:tb,isSigner:!1,isWritable:!1}],c=x.alloc(a.span);a.encode({rewardIndex:s},c);let l=x.from([...rw.collectReward,...c]);return new y.TransactionInstruction({keys:u,programId:e,data:l})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[o,r]=[new y.PublicKey(e.programId),new y.PublicKey(e.id)],s,a;for(let n=0;n<e.rewardDefaultInfos.length;n++)e.rewardDefaultInfos[n].mint.address===i.toString()&&(s=n,a=new y.PublicKey(t.rewardInfos[n].vault));(void 0===s||void 0===a)&&rf.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(o,n.wallet,r,n.tokenAccount,a,i,s)];return{address:{rewardVault:a},signers:[],instructions:u,instructionTypes:[tJ.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapBaseOutInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,outputMint:i,amountOut:o,amountInMax:r,sqrtPriceLimitX64:s,remainingAccounts:a}){let[u,c]=[new y.PublicKey(e.programId),new y.PublicKey(e.id)],[l,d]=[new y.PublicKey(t.vault.A),new y.PublicKey(t.vault.B)],[m,p]=[new y.PublicKey(e.mintA.address),new y.PublicKey(e.mintB.address)],g=e.mintA.address===i.toString();return{signers:[],instructions:[this.swapInstruction(u,n.wallet,c,new y.PublicKey(e.config.id),g?n.tokenAccountB:n.tokenAccountA,g?n.tokenAccountA:n.tokenAccountB,g?d:l,g?l:d,g?m:p,g?p:m,a,l,o,r,s,!1)],instructionTypes:[tJ.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}},rk=new f(25),rA=new f(1e4),rI=H("Raydium_liquidity_serum");function rP({programId:e}){let{publicKey:t}=t8([x.from("amm_config_account_seed","utf-8")],e);return t}function rT({name:e,programId:t,marketId:n}){let{publicKey:i}=t8([t.toBuffer(),n.toBuffer(),x.from(e,"utf-8")],t);return i}function rS({programId:e}){return t8([x.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],e)}async function rB({connection:e,poolKeysList:t,config:n}){p||(p=new ob({connection:e}),await p.initStableModelLayout());let i=t.map(e=>(function({poolKeys:e}){let t=ii([n0("instruction"),n0("simulateType")]),n=x.alloc(t.span);t.encode({instruction:12,simulateType:0},n);let i=[th({pubkey:new y.PublicKey(e.id),isWritable:!1}),th({pubkey:new y.PublicKey(e.authority),isWritable:!1}),th({pubkey:new y.PublicKey(e.openOrders),isWritable:!1}),th({pubkey:new y.PublicKey(e.vault.A),isWritable:!1}),th({pubkey:new y.PublicKey(e.vault.B),isWritable:!1}),th({pubkey:new y.PublicKey(e.mintLp.address),isWritable:!1}),th({pubkey:new y.PublicKey(e.marketId),isWritable:!1}),th({pubkey:new y.PublicKey(e.marketEventQueue),isWritable:!1})];return{instruction:new y.TransactionInstruction({programId:new y.PublicKey(e.programId),keys:i,data:n})}})({poolKeys:e}));return(await t2(e,i.map(e=>e.instruction),"GetPoolData")).map(e=>{let t;let n=(t=e.match(/{["\w:,]+}/g))&&1===t.length?t[0]:t1.logWithError("simulate log fail to match json, keyword: GetPoolData"),i=new f(t5(n,"status")),o=Number(t5(n,"coin_decimals")),r=Number(t5(n,"pc_decimals")),s=Number(t5(n,"lp_decimals")),a=new f(t5(n,"pool_coin_amount")),u=new f(t5(n,"pool_pc_amount")),c=new f(t5(n,"pool_lp_supply")),l="0";try{l=t5(n,"pool_open_time")}catch{}return{status:i,baseDecimals:o,quoteDecimals:r,lpDecimals:s,baseReserve:a,quoteReserve:u,lpSupply:c,startTime:new f(l)}})}var rv={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]},rK=e=>{let t={},n=b.H_.toBase58();return Object.keys(e).map(i=>{let o=e[i],[r,s]=[o.baseMint.toBase58(),o.quoteMint.toBase58()];t[i]={id:i,version:4,status:o.status.toNumber(),programId:o.programId.toBase58(),mintA:oo({address:r,programId:n,decimals:o.baseDecimal.toNumber()}),mintB:oo({address:s,programId:n,decimals:o.quoteDecimal.toNumber()}),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:o.poolPrice.toNumber(),mintAmountA:new tg(o.mintAAmount.toString()).div(10**o.baseDecimal.toNumber()).toNumber(),mintAmountB:new tg(o.mintBAmount.toString()).div(10**o.quoteDecimal.toNumber()).toNumber(),baseReserve:o.baseReserve,quoteReserve:o.quoteReserve,feeRate:new tg(o.tradeFeeNumerator.toString()).div(o.tradeFeeDenominator.toString()).toNumber(),openTime:o.poolOpenTime.toString(),tvl:0,day:rv,week:rv,month:rv,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,type:"Standard",marketId:o.marketId.toBase58(),configId:rP({programId:o.programId}).toBase58(),lpPrice:0,lpAmount:0,lpMint:oo({address:o.lpMint.toBase58(),programId:n,decimals:Math.min(o.baseDecimal.toNumber(),o.quoteDecimal.toNumber())})}}),t},rC=class extends nN{constructor(e){super(e),this.stableLayout=new ob({connection:this.scope.connection})}async initLayout(){await this.stableLayout.initStableModelLayout()}async load(){this.checkDisabled()}computePairAmount({poolInfo:e,amount:t,slippage:n,baseIn:i}){let o=new f(new tg(t).mul(10**e[i?"mintA":"mintB"].decimals).toFixed(0)),r=on(e[i?"mintB":"mintA"]),[s,a]=[new f(new tg(e.mintAmountA).mul(10**e.mintA.decimals).toString()),new f(new tg(e.mintAmountB).mul(10**e.mintB.decimals).toString())],u=new f(new tg(e.lpAmount).mul(10**e.lpMint.decimals).toFixed(0,tg.ROUND_DOWN));this.logDebug("baseReserve:",s.toString(),"quoteReserve:",a.toString()),this.logDebug("tokenIn:",i?e.mintA.symbol:e.mintB.symbol,"amountIn:",o.toString(),"anotherToken:",i?e.mintB.symbol:e.mintA.symbol,"slippage:",`${n.toSignificant()}%`,"baseReserve",s.toString(),"quoteReserve",a.toString());let c=i?"base":"quote";this.logDebug("input side:",c);let l=tU;o.isZero()||(l="base"===c?tz(o.mul(a),s):tz(o.mul(s),a)),this.logDebug("amountRaw:",l.toString(),"lpAmount:",u.toString());let d=tz(o.mul(u),"base"===c?s:a);this.logDebug("liquidity:",d.toString());let m=new tN(new f(1)).add(n).mul(l).quotient,p=new tZ(r,l),g=new tZ(r,m);return this.logDebug("anotherAmount:",p.toFixed(),"maxAnotherAmount:",g.toFixed()),{anotherAmount:p,maxAnotherAmount:g,liquidity:d}}async getAmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async addLiquidity(e){let{poolInfo:t,poolKeys:n,amountInA:i,amountInB:o,fixedSide:r,config:s,txVersion:a,computeBudgetConfig:u}=e;!1===this.scope.availability.addStandardPosition&&this.logAndCreateError("add liquidity feature disabled in your region"),this.logDebug("amountInA:",i,"amountInB:",o),(i.isZero()||o.isZero())&&this.logAndCreateError("amounts must greater than zero","amountInA & amountInB",{amountInA:i.toFixed(),amountInB:o.toFixed()});let{account:c}=this.scope,{bypassAssociatedCheck:l,checkCreateATAOwner:d}=W({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},s),[m,p]=[i.token,o.token],g=await c.getCreatedTokenAccount({mint:m.mint,associatedOnly:!1}),h=await c.getCreatedTokenAccount({mint:p.mint,associatedOnly:!1});g||h||this.logAndCreateError("cannot found target token accounts","tokenAccounts",c.tokenAccounts);let f=await c.getCreatedTokenAccount({mint:new y.PublicKey(t.lpMint.address)}),w=[m,p],k=[g,h],A=[i.raw,o.raw],I=i.token.mint.toBase58()===t.mintA.address?"base":"quote",P="base";["quote","base"].includes(I)||this.logAndCreateError("invalid fixedSide","fixedSide",r),"quote"===I?(w.reverse(),k.reverse(),A.reverse(),P="a"===r?"quote":"base"):"base"===I&&(P="a"===r?"base":"quote");let[T,S]=w,[B,v]=k,[K,C]=A,O=null!=n?n:await this.getAmmPoolKeys(t.id),q=this.createTxBuilder(),R=await c.handleTokenAccount({side:"in",amount:K,mint:T.mint,tokenAccount:B,bypassAssociatedCheck:l,checkCreateATAOwner:d}),{tokenAccount:L}=R,E=D(R,["tokenAccount"]);q.addInstruction(E);let F=await c.handleTokenAccount({side:"in",amount:C,mint:S.mint,tokenAccount:v,bypassAssociatedCheck:l,checkCreateATAOwner:d}),{tokenAccount:M}=F,_=D(F,["tokenAccount"]);q.addInstruction(_);let N=await c.handleTokenAccount({side:"out",amount:0,mint:new y.PublicKey(t.lpMint.address),tokenAccount:f,bypassAssociatedCheck:l,checkCreateATAOwner:d}),{tokenAccount:V}=N,U=D(N,["tokenAccount"]);return q.addInstruction(U),q.addInstruction({instructions:[function(e){let{poolInfo:t,poolKeys:n,userKeys:i,baseAmountIn:o,quoteAmountIn:r,fixedSide:s}=e,a=x.alloc(oc.span);oc.encode({instruction:3,baseAmountIn:tG(o),quoteAmountIn:tG(r),fixedSide:"base"===s?tU:tX},a);let u=[th({pubkey:b.H_,isWritable:!1}),th({pubkey:new y.PublicKey(t.id)}),th({pubkey:new y.PublicKey(n.authority),isWritable:!1}),th({pubkey:new y.PublicKey(n.openOrders),isWritable:!1}),th({pubkey:new y.PublicKey(n.targetOrders)}),th({pubkey:new y.PublicKey(t.lpMint.address)}),th({pubkey:new y.PublicKey(n.vault.A)}),th({pubkey:new y.PublicKey(n.vault.B)})];return t.pooltype.includes("StablePool")&&u.push(th({pubkey:om})),u.push(th({pubkey:new y.PublicKey(t.marketId),isWritable:!1}),th({pubkey:i.baseTokenAccount}),th({pubkey:i.quoteTokenAccount}),th({pubkey:i.lpTokenAccount}),th({pubkey:i.owner,isWritable:!1,isSigner:!0}),th({pubkey:new y.PublicKey(n.marketEventQueue),isWritable:!1})),new y.TransactionInstruction({programId:new y.PublicKey(t.programId),keys:u,data:a})}({poolInfo:t,poolKeys:O,userKeys:{baseTokenAccount:L,quoteTokenAccount:M,lpTokenAccount:V,owner:this.scope.ownerPubKey},baseAmountIn:K,quoteAmountIn:C,fixedSide:P})],instructionTypes:[t.pooltype.includes("StablePool")?tJ.AmmV5AddLiquidity:tJ.AmmV4AddLiquidity],lookupTableAddress:O.lookupTableAccount?[O.lookupTableAccount]:[]}),q.addCustomComputeBudget(u),0===a&&await q.buildV0(),q.build()}async removeLiquidity(e){!1===this.scope.availability.removeStandardPosition&&this.logAndCreateError("remove liquidity feature disabled in your region");let{poolInfo:t,poolKeys:n,amountIn:i,config:o,txVersion:r,computeBudgetConfig:s}=e,a=null!=n?n:await this.getAmmPoolKeys(t.id),[u,c,l]=[new y.PublicKey(t.mintA.address),new y.PublicKey(t.mintB.address),new y.PublicKey(t.lpMint.address)];this.logDebug("amountIn:",i),i.isZero()&&this.logAndCreateError("amount must greater than zero","amountIn",i.toString());let{account:d}=this.scope,m=await d.getCreatedTokenAccount({mint:l,associatedOnly:!1});m||this.logAndCreateError("cannot found lpTokenAccount","tokenAccounts",d.tokenAccounts);let p=await d.getCreatedTokenAccount({mint:u}),g=await d.getCreatedTokenAccount({mint:c}),h=this.createTxBuilder(),{bypassAssociatedCheck:f,checkCreateATAOwner:w}=W({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},o),b=await d.handleTokenAccount({side:"out",amount:0,mint:u,tokenAccount:p,bypassAssociatedCheck:f,checkCreateATAOwner:w}),{tokenAccount:k}=b,A=D(b,["tokenAccount"]);h.addInstruction(A);let I=await d.handleTokenAccount({side:"out",amount:0,mint:c,tokenAccount:g,bypassAssociatedCheck:f,checkCreateATAOwner:w}),{tokenAccount:P}=I,T=D(I,["tokenAccount"]);return h.addInstruction(T),h.addInstruction({instructions:[oA({poolInfo:t,poolKeys:a,userKeys:{lpTokenAccount:m,baseTokenAccount:k,quoteTokenAccount:P,owner:this.scope.ownerPubKey},amountIn:i})],lookupTableAddress:a.lookupTableAccount?[a.lookupTableAccount]:[],instructionTypes:[t.pooltype.includes("StablePool")?tJ.AmmV5RemoveLiquidity:tJ.AmmV4RemoveLiquidity]}),h.addCustomComputeBudget(s),0===r?await h.buildV0():h.build()}async removeAllLpAndCreateClmmPosition({poolInfo:e,clmmPoolInfo:t,removeLpAmount:n,createPositionInfo:i,farmInfo:o,userFarmLpAmount:r,base:s,computeBudgetConfig:a,payer:u,userAuxiliaryLedgers:c,tokenProgram:l=b.H_,checkCreateATAOwner:d=!0,getEphemeralSigners:m,txVersion:p}){if((!1===this.scope.availability.removeStandardPosition||!1===this.scope.availability.createConcentratedPosition)&&this.logAndCreateError("remove liquidity or create position feature disabled in your region"),!(e.mintA.address===t.mintA.address||e.mintA.address===t.mintB.address)||!(e.mintB.address===t.mintA.address||e.mintB.address===t.mintB.address))throw Error("mint check error");let g=this.createTxBuilder();g.addCustomComputeBudget(a);let h={};for(let e of this.scope.account.tokenAccountRawInfos)(void 0===h[e.accountInfo.mint.toString()]||nS(this.scope.ownerPubKey,e.accountInfo.mint,b.H_).publicKey.equals(e.pubkey))&&(h[e.accountInfo.mint.toString()]=e.pubkey);let w=h[e.lpMint.address];if(void 0===w)throw Error("find lp account error in trade accounts");let k=n.add(null!=r?r:new f(0)),A=e.mintA.address===tx.WSOL.mint.toString(),I=e.mintB.address===tx.WSOL.mint.toString(),{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:b.H_,mint:new y.PublicKey(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:A?{payer:this.scope.ownerPubKey}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:!0,checkCreateATAOwner:d});if(g.addInstruction(T||{}),void 0===P)throw Error("base token account not found");let{account:S,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:b.H_,mint:new y.PublicKey(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:I?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!I,notUseTokenAccount:I,associatedOnly:!0,checkCreateATAOwner:d});if(g.addInstruction(B||{}),void 0===S)throw Error("quote token account not found");if(h[e.mintA.address]=P,h[e.mintB.address]=S,void 0!==o&&!(null!=r&&r.isZero())){let e=iY[o.programId],t=i1({programId:new y.PublicKey(o.programId),poolId:new y.PublicKey(o.id),owner:this.scope.ownerPubKey,version:e}),n,i=await this.scope.connection.getAccountInfo(t);if(i&&(n=i6(e).decode(i.data)),6!==e&&!n){let{instruction:n,instructionType:i}=i5({id:new y.PublicKey(o.id),programId:new y.PublicKey(o.programId),version:e,ledger:t,owner:this.scope.ownerPubKey});g.addInstruction({instructions:[n],instructionTypes:[i]})}let s=[];for(let e of o.rewardInfos){let t=e.mint.address===tx.WSOL.mint.toString();if(h[e.mint.address])s.push(h[e.mint.address]);else{let{account:n,instructionParams:i}=await this.scope.account.getOrCreateTokenAccount({mint:new y.PublicKey(e.mint.address),tokenProgram:l,owner:this.scope.ownerPubKey,skipCloseAccount:!t,createInfo:{payer:u||this.scope.ownerPubKey},associatedOnly:!0,checkCreateATAOwner:d});n||this.logAndCreateError("farm reward account not found:",e.mint.address),i&&g.addInstruction(i),s.push(n)}}let a=(await this.scope.api.fetchFarmKeysById({ids:o.id}))[0],m={userAuxiliaryLedgers:c,amount:r,owner:this.scope.ownerPubKey,farmInfo:o,farmKeys:a,lpAccount:w,rewardAccounts:s},p=iY[o.programId],f=6===p?i7(m):5===p?i9(m):oe(m),b={3:tJ.FarmV3Withdraw,5:tJ.FarmV5Withdraw,6:tJ.FarmV6Withdraw};g.addInstruction({instructions:[f],instructionTypes:[b[p]]})}let v=await this.getAmmPoolKeys(e.id),K=oA({poolInfo:e,poolKeys:v,userKeys:{lpTokenAccount:w,baseTokenAccount:P,quoteTokenAccount:S,owner:this.scope.ownerPubKey},amountIn:k});g.addInstruction({instructions:[K],instructionTypes:[e.pooltype.includes("StablePool")?tJ.AmmV5RemoveLiquidity:tJ.AmmV4RemoveLiquidity],lookupTableAddress:v.lookupTableAccount?[v.lookupTableAccount]:[]});let[C,x]=e.mintA.address===t.mintA.address?[P,S]:[S,P],O=await this.scope.clmm.getClmmPoolKeys(e.id),q=await rb.openPositionFromBaseInstructions(_(W({poolInfo:t,poolKeys:O,ownerInfo:{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:C,tokenAccountB:x},withMetadata:"create"},i),{base:s,getEphemeralSigners:m}));return g.addInstruction({instructions:[...q.instructions],signers:q.signers,instructionTypes:[...q.instructionTypes],lookupTableAddress:O.lookupTableAccount?[O.lookupTableAccount]:[]}),0===p?g.sizeCheckBuildV0():g.sizeCheckBuild()}async createPoolV4({programId:e,marketInfo:t,baseMintInfo:n,quoteMintInfo:i,baseAmount:o,quoteAmount:r,startTime:s,ownerInfo:a,associatedOnly:u=!1,checkCreateATAOwner:c=!1,tokenProgram:l,txVersion:d,feeDestinationId:m,computeBudgetConfig:p}){var g;let h=a.feePayer||(null==(g=this.scope.owner)?void 0:g.publicKey),f=a.useSOLBalance&&n.mint.equals(b.Gd),w=a.useSOLBalance&&i.mint.equals(b.Gd),k=this.createTxBuilder(),{account:A,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({mint:n.mint,owner:this.scope.ownerPubKey,createInfo:f?{payer:h,amount:o}:void 0,notUseTokenAccount:f,skipCloseAccount:!f,associatedOnly:!f&&u,checkCreateATAOwner:c});k.addInstruction(I||{});let{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({mint:i.mint,owner:this.scope.ownerPubKey,createInfo:w?{payer:h,amount:r}:void 0,notUseTokenAccount:w,skipCloseAccount:!w,associatedOnly:!w&&u,checkCreateATAOwner:c});if(k.addInstruction(T||{}),void 0===A||void 0===P)throw Error("you don't has some token account");let S=function({version:e,marketVersion:t,marketId:n,baseMint:i,quoteMint:o,baseDecimals:r,quoteDecimals:s,programId:a,marketProgramId:u}){let c=rT({name:"amm_associated_seed",programId:a,marketId:n}),l=rT({name:"lp_mint_associated_seed",programId:a,marketId:n}),{publicKey:d,nonce:m}=rS({programId:a}),p=rT({name:"coin_vault_associated_seed",programId:a,marketId:n}),g=rT({name:"pc_vault_associated_seed",programId:a,marketId:n}),h=rT({name:"temp_lp_token_associated_seed",programId:a,marketId:n}),f=function({programId:e,marketId:t}){let{publicKey:n}=t8([e.toBuffer(),t.toBuffer(),x.from("open_order_associated_seed","utf-8")],e);return n}({programId:a,marketId:n}),w=rT({name:"target_associated_seed",programId:a,marketId:n}),b=rT({name:"withdraw_associated_seed",programId:a,marketId:n}),{publicKey:k}=function({programId:e,marketId:t}){let n=[t.toBuffer()],i=0,o;for(;i<100;){try{let t=n.concat(x.from([i]),x.alloc(7));o=y.PublicKey.createProgramAddressSync(t,e)}catch(e){if(e instanceof TypeError)throw e;i++;continue}return{publicKey:o,nonce:i}}throw rI.logWithError("unable to find a viable program address nonce","params",{programId:e,marketId:t}),Error("unable to find a viable program address nonce")}({programId:u,marketId:n});return{id:c,baseMint:i,quoteMint:o,lpMint:l,baseDecimals:r,quoteDecimals:s,lpDecimals:r,version:e,programId:a,authority:d,nonce:m,baseVault:p,quoteVault:g,lpVault:h,openOrders:f,targetOrders:w,withdrawQueue:b,marketVersion:t,marketProgramId:u,marketId:n,marketAuthority:k,lookupTableAccount:y.PublicKey.default,configId:rP({programId:a})}}({version:4,marketVersion:3,marketId:t.marketId,baseMint:n.mint,quoteMint:i.mint,baseDecimals:n.decimals,quoteDecimals:i.decimals,programId:e,marketProgramId:t.programId}),B={programId:e,ammId:S.id,ammAuthority:S.authority,ammOpenOrders:S.openOrders,lpMint:S.lpMint,coinMint:S.baseMint,pcMint:S.quoteMint,coinVault:S.baseVault,pcVault:S.quoteVault,withdrawQueue:S.withdrawQueue,ammTargetOrders:S.targetOrders,poolTempLp:S.lpVault,marketProgramId:S.marketProgramId,marketId:S.marketId,ammConfigId:S.configId,feeDestinationId:m},{instruction:v,instructionType:K}=function({programId:e,ammId:t,ammAuthority:n,ammOpenOrders:i,lpMint:o,coinMint:r,pcMint:s,coinVault:a,pcVault:u,withdrawQueue:c,ammTargetOrders:l,poolTempLp:d,marketProgramId:m,marketId:p,userWallet:g,userCoinVault:h,userPcVault:f,userLpVault:w,nonce:k,openTime:A,coinAmount:I,pcAmount:P,ammConfigId:T,feeDestinationId:S}){let B=ii([n0("instruction"),n0("nonce"),n6("openTime"),n6("pcAmount"),n6("coinAmount")]),v=[{pubkey:b.H_,isSigner:!1,isWritable:!1},{pubkey:b._u,isSigner:!1,isWritable:!1},{pubkey:y.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:tA,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:S,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!0,isWritable:!0},{pubkey:h,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:w,isSigner:!1,isWritable:!0}],K=x.alloc(B.span);return B.encode({instruction:1,nonce:k,openTime:A,coinAmount:I,pcAmount:P},K),{instruction:new y.TransactionInstruction({keys:v,programId:e,data:K}),instructionType:tJ.AmmV4CreatePool}}(_(W({},B),{userWallet:this.scope.ownerPubKey,userCoinVault:A,userPcVault:P,userLpVault:nS(this.scope.ownerPubKey,S.lpMint,l).publicKey,nonce:S.nonce,openTime:s,coinAmount:o,pcAmount:r}));return k.addInstruction({instructions:[v],instructionTypes:[K]}),k.addCustomComputeBudget(p),k.versionBuild({txVersion:d,extInfo:{address:B}})}async getCreatePoolFee({programId:e}){let t=rP({programId:e}),n=await this.scope.connection.getAccountInfo(t,{dataSlice:{offset:536,length:8}});if(null===n)throw Error("get config account error");return od.decode(n.data).fee}computeAmountOut({poolInfo:e,amountIn:t,mintIn:n,mintOut:i,slippage:o}){let[r,s]=[n.toString(),i.toString()];if(r!==e.mintA.address&&r!==e.mintB.address||s!==e.mintA.address&&s!==e.mintB.address)throw Error("toke not match");let{baseReserve:a,quoteReserve:u}=e,c=[a,u],l=r==e.mintA.address?"base":"quote";"quote"===l&&c.reverse();let[d,m]=c,p=4===e.version,g;if(p)g=new tg(m.toString()).div(d.toString());else{var h,y;let e,t;let n=(h=this.stableLayout.stableModelData,y=a.toNumber(),t=((e=ow(h,oy(h,y,oh(h,y,u.toNumber())),0,!1))[3]?e[0]:0)/h.multiplier,1/t);g="quote"===l?new tg(1e6).div(1e6*n):new tg(1e6*n).div(1e6)}let w=new f(0),b=new f(0);if(!t.isZero()){if(p){b=nK(t.mul(rk),rA);let e=t.sub(b),n=d.add(e);w=m.mul(e).div(n)}else{b=t.mul(new f(2)).div(new f(1e4));let e=t.sub(b);w=new f("quote"===l?function(e,t,n,i){let o=oh(e,t,n),r=oy(e,t,o),s=oy(e,n,o),a=oy(e,i,o),[u,c,l,d]=ow(e,r,a,!0);return d?l?i*e.multiplier/u:of(e,s-c,o):0}(this.stableLayout.stableModelData,u.toNumber(),a.toNumber(),e.toNumber()):function(e,t,n,i){let o=oh(e,t,n),r=oy(e,t,o),s=oy(e,n,o),a=oy(e,i,o),[u,c,l,d]=function(e,t,n,i){let o=i?t-n:t+n,[r,s,a]=function(e,t){let[n,i]=[0,49998],o=n,r=i,s=0;for(;o<=r&&!((s=Math.floor((r+o)/2))<=0)&&!(s>=49998);){let n=e.DataElement[s].y,i=e.DataElement[s-1].y,a=e.DataElement[s+1].y;if(t===n)return[s,s,!0];if(t===i)return[s-1,s-1,!0];if(t===a)return[s+1,s+1,!0];if(t<a)o=s+1;else{if(t<i&&t>n)return[s-1,s,!0];if(t<n&&t>a)return[s,s+1,!0];r=s-1}}return[s,s,!1]}(e,o);if(!a)return[0,0,!1,a];if(r===s)return[e.DataElement[s].price,e.DataElement[s].x,!1,a];{let n=e.DataElement[r].x,u=e.DataElement[s].x,c=e.DataElement[r].price,l=e.DataElement[s].price,d=e.DataElement[r].y,m=e.DataElement[s].y;if(t>=m&&t<=d)return i?[l,u,!0,a]:[c,n,!0,a];{let r,s;return i?(r=c+(l-c)*(d-t)/(d-m),s=n+l*(d-o)/e.multiplier):(r=c+(l-c)*(d-t)/(d-m),s=u-c*(o-m)/e.multiplier),[r,s,!1,a]}}}(e,s,a,!1);return d?l?i*u/e.multiplier:of(e,r-c,o):0}(this.stableLayout.stableModelData,u.toNumber(),a.toNumber(),e.toNumber()))}}let k=new f(new tg(w.toString()).mul(1-o).toFixed(0)),A=w,I=new tg(w.toString()).div(new tg(t.sub(b).toString()).toFixed(0));t.isZero()||w.isZero()||(I=new tg(w.toString()).div(t.sub(b).toString()));let P=g.sub(I).div(g).mul(100);return{amountOut:A,minAmountOut:k,currentPrice:g,executionPrice:I,priceImpact:P,fee:b}}async swap({poolInfo:e,poolKeys:t,amountIn:n,amountOut:i,inputMint:o,fixedSide:r,txVersion:s,config:a,computeBudgetConfig:u}){let c=this.createTxBuilder(),{associatedOnly:l=!0,inputUseSolBalance:d=!0,outputUseSolBalance:m=!0}=a||{},[p,g]=o===e.mintA.address?[e.mintA,e.mintB]:[e.mintB,e.mintA],h=d&&p.address===tS.toBase58(),f=m&&g.address===tS.toBase58(),{account:w,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:b.H_,mint:new y.PublicKey(p.address),owner:this.scope.ownerPubKey,createInfo:h?{payer:this.scope.ownerPubKey,amount:n}:void 0,skipCloseAccount:!h,notUseTokenAccount:h,associatedOnly:l});c.addInstruction(k||{}),w||this.logAndCreateError("input token account not found",{token:p.symbol||p.address,tokenAccountIn:w,inputTokenUseSolBalance:h,associatedOnly:l});let{account:A,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:b.H_,mint:new y.PublicKey(g.address),owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!f,notUseTokenAccount:f,associatedOnly:!f&&l});c.addInstruction(I||{}),void 0===A&&this.logAndCreateError("output token account not found",{token:g.symbol||g.address,tokenAccountOut:A,outputTokenUseSolBalance:f,associatedOnly:l});let P=t||await this.getAmmPoolKeys(e.id),T=4;return e.pooltype.includes("StablePool")&&(T=5),c.addInstruction({instructions:[oI({version:T,poolKeys:P,userKeys:{tokenAccountIn:w,tokenAccountOut:A,owner:this.scope.ownerPubKey},amountIn:n,amountOut:i,fixedSide:r})],instructionTypes:[4===T?tJ.AmmV4SwapBaseIn:tJ.AmmV5SwapBaseIn]}),c.addCustomComputeBudget(u),c.versionBuild({txVersion:s})}async getRpcPoolInfo(e){return(await this.getRpcPoolInfos([e]))[e]}async getRpcPoolInfos(e,t){let n=await no(this.scope.connection,e.map(e=>({pubkey:new y.PublicKey(e)})),t),i={},o=[];for(let t=0;t<e.length;t++){let r=n[t];if(null===r||!r.accountInfo)throw Error("fetch pool info error: "+String(e[t]));let s=ou.decode(r.accountInfo.data);i[String(e[t])]=_(W({},s),{programId:r.accountInfo.owner}),o.push(s.baseVault,s.quoteVault)}let r={},s=await no(this.scope.connection,o.map(e=>({pubkey:new y.PublicKey(e)})),t);for(let e=0;e<o.length;e++){let t=s[e].accountInfo;if(null===t)throw Error("fetch vault info error: "+o[e]);r[String(o[e])]=new f(S.p0.decode(t.data).amount.toString())}let a={};for(let[e,t]of Object.entries(i)){let n=r[t.baseVault.toString()].sub(t.baseNeedTakePnl),i=r[t.quoteVault.toString()].sub(t.quoteNeedTakePnl);a[e]=_(W({},t),{baseReserve:n,mintAAmount:r[t.baseVault.toString()],mintBAmount:r[t.quoteVault.toString()],quoteReserve:i,poolPrice:new tg(i.toString()).div(new tg(10).pow(t.quoteDecimal.toString())).div(new tg(n.toString()).div(new tg(10).pow(t.baseDecimal.toString())))})}return a}async getPoolInfoFromRpc({poolId:e}){let t=await this.getRpcPoolInfo(e),n=rK({[e]:t}),i=n[e],o=await this.scope.tradeV2.computePoolToPoolKeys({pools:[n[e]],ammRpcData:{[e]:t}});return{poolRpcData:t,poolInfo:i,poolKeys:o[0]}}},rx=class extends nN{constructor(e){super(e)}async getClmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async createPool(e){var t;let{programId:n,owner:i=(null==(t=this.scope.owner)?void 0:t.publicKey)||y.PublicKey.default,mint1:o,mint2:r,ammConfig:s,initialPrice:a,startTime:u,computeBudgetConfig:c,forerunCreate:l,txVersion:d}=e,m=this.createTxBuilder(),[p,g,h]=new f(new y.PublicKey(o.address).toBuffer()).gt(new f(new y.PublicKey(r.address).toBuffer()))?[r,o,new tg(1).div(a)]:[o,r,a],w=o9.priceToSqrtPriceX64(h,p.decimals,g.decimals),b=await rb.createPoolInstructions({connection:this.scope.connection,programId:n,owner:i,mintA:p,mintB:g,ammConfigId:s.id,initialPriceX64:w,startTime:u,forerunCreate:l});return m.addInstruction(b),m.addCustomComputeBudget(c),m.versionBuild({txVersion:d,extInfo:{address:_(W({},b.address),{programId:n.toString(),id:b.address.poolId.toString(),mintA:p,mintB:g,openTime:u.toString(),vault:{A:b.address.mintAVault.toString(),B:b.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}}),mockPoolInfo:W({type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:b.address.poolId.toString(),mintA:p,mintB:g,feeRate:s.tradeFeeRate,openTime:u.toString(),programId:n.toString(),price:h.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}},oJ),forerunCreate:l}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:r,baseAmount:s,otherAmountMax:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,withMetadata:l="create",getEphemeralSigners:d,computeBudgetConfig:m,txVersion:p}){!1===this.scope.availability.addConcentratedPosition&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let g=this.createTxBuilder(),h=null,f=null,w=n.useSOLBalance&&e.mintA.address===tS.toString(),b=n.useSOLBalance&&e.mintB.address===tS.toString(),[k,A]="MintA"===r?[s,a]:[a,s],{account:I,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new y.PublicKey(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:w||k.isZero()?{payer:this.scope.ownerPubKey,amount:k}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:!w&&u,checkCreateATAOwner:c});I&&(h=I),g.addInstruction(P||{});let{account:T,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new y.PublicKey(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:b||A.isZero()?{payer:this.scope.ownerPubKey,amount:A}:void 0,skipCloseAccount:!b,notUseTokenAccount:b,associatedOnly:!b&&u,checkCreateATAOwner:c});T&&(f=T),g.addInstruction(S||{}),h&&f||this.logAndCreateError("cannot found target token accounts","tokenAccounts",{ownerTokenAccountA:null==h?void 0:h.toBase58(),ownerTokenAccountB:null==f?void 0:f.toBase58()});let B=t||await this.getClmmPoolKeys(e.id),v=await rb.openPositionFromBaseInstructions({poolInfo:e,poolKeys:B,ownerInfo:_(W({},n),{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:h,tokenAccountB:f}),tickLower:i,tickUpper:o,base:r,baseAmount:s,otherAmountMax:a,withMetadata:l,getEphemeralSigners:d});return g.addInstruction(v),g.addCustomComputeBudget(m),g.versionBuild({txVersion:p,extInfo:v.address})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:i,amountMaxB:o,tickLower:r,tickUpper:s,liquidity:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,withMetadata:l="create",txVersion:d,getEphemeralSigners:m}){!1===this.scope.availability.createConcentratedPosition&&this.logAndCreateError("open position feature disabled in your region");let p=this.createTxBuilder(),g=null,h=null,f=n.useSOLBalance&&e.mintA.address===tS.toBase58(),w=n.useSOLBalance&&e.mintB.address===tS.toBase58(),{account:b,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new y.PublicKey(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:f||i.isZero()?{payer:this.scope.ownerPubKey,amount:i}:void 0,skipCloseAccount:!f,notUseTokenAccount:f,associatedOnly:!f&&u,checkCreateATAOwner:c});b&&(g=b),p.addInstruction(k||{});let{account:A,instructionParams:I}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new y.PublicKey(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:!w&&u,checkCreateATAOwner:c});A&&(h=A),p.addInstruction(I||{}),(void 0===g||void 0===h)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let P=t||await this.getClmmPoolKeys(e.id),T=await rb.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:P,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:g,tokenAccountB:h},tickLower:r,tickUpper:s,liquidity:a,amountMaxA:i,amountMaxB:o,withMetadata:l,getEphemeralSigners:m});return p.addInstruction(T),p.versionBuild({txVersion:d,extInfo:{address:T.address}})}async increasePositionFromLiquidity(e){let{poolInfo:t,poolKeys:n,ownerPosition:i,amountMaxA:o,amountMaxB:r,liquidity:s,ownerInfo:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,txVersion:d}=e,m=this.createTxBuilder(),p,g,h=a.useSOLBalance&&t.mintA.address===tS.toString(),f=a.useSOLBalance&&t.mintB.address===tS.toString(),{account:w,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new y.PublicKey(t.mintA.address),notUseTokenAccount:h,owner:this.scope.ownerPubKey,createInfo:h||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!h,associatedOnly:!h&&u,checkCreateATAOwner:c});w&&(p=w),m.addInstruction(b||{});let{account:k,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new y.PublicKey(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:f||r.isZero()?{payer:this.scope.ownerPubKey,amount:r}:void 0,notUseTokenAccount:f,skipCloseAccount:!f,associatedOnly:!f&&u,checkCreateATAOwner:c});k&&(g=k),m.addInstruction(A||{}),p||g||this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let I=null!=n?n:await this.getClmmPoolKeys(t.id),P=rb.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:I,ownerPosition:i,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:g},liquidity:s,amountMaxA:o,amountMaxB:r});return m.addInstruction(P),m.addCustomComputeBudget(l),m.versionBuild({txVersion:d,extInfo:{address:P.address}})}async increasePositionFromBase(e){let{poolInfo:t,ownerPosition:n,base:i,baseAmount:o,otherAmountMax:r,ownerInfo:s,associatedOnly:a=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:c,txVersion:l}=e,d=this.createTxBuilder(),m,p,g=s.useSOLBalance&&t.mintA.address===tS.toString(),h=s.useSOLBalance&&t.mintB.address===tS.toString(),{account:f,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new y.PublicKey(t.mintA.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:g||("MintA"===i?o:r).isZero()?{payer:this.scope.ownerPubKey,amount:"MintA"===i?o:r}:void 0,skipCloseAccount:!g,associatedOnly:!g&&a,checkCreateATAOwner:u});f&&(m=f),d.addInstruction(w||{});let{account:b,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new y.PublicKey(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:h||("MintA"===i?r:o).isZero()?{payer:this.scope.ownerPubKey,amount:"MintA"===i?r:o}:void 0,notUseTokenAccount:h,skipCloseAccount:!h,associatedOnly:!h&&a,checkCreateATAOwner:u});b&&(p=b),d.addInstruction(k||{}),m||p||this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let A=await this.getClmmPoolKeys(t.id),I=rb.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:A,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:m,tokenAccountB:p},base:i,baseAmount:o,otherAmountMax:r});return d.addInstruction(I),d.addCustomComputeBudget(c),d.versionBuild({txVersion:l,extInfo:{address:I.address}})}async decreaseLiquidity(e){let{poolInfo:t,poolKeys:n,ownerPosition:i,ownerInfo:o,amountMinA:r,amountMinB:s,liquidity:a,associatedOnly:u=!0,checkCreateATAOwner:c=!1,computeBudgetConfig:l,txVersion:d}=e;!1===this.scope.availability.removeConcentratedPosition&&this.logAndCreateError("remove position feature disabled in your region");let m=this.createTxBuilder(),p=o.useSOLBalance&&t.mintA.address===tS.toString(),g=o.useSOLBalance&&t.mintB.address===tS.toString(),{account:h,instructionParams:f}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new y.PublicKey(t.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!p,associatedOnly:!p&&u,checkCreateATAOwner:c});f&&m.addInstruction(f);let{account:w,instructionParams:b}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new y.PublicKey(t.mintB.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!g,associatedOnly:!g&&u,checkCreateATAOwner:c});b&&m.addInstruction(b);let k=[];for(let e of t.rewardDefaultInfos){let n=o.useSOLBalance&&e.mint.address===tS.toString(),i;if(e.mint.address===t.mintA.address)i=h;else if(e.mint.address===t.mintB.address)i=w;else{let{account:t,instructionParams:o}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new y.PublicKey(e.mint.programId),mint:new y.PublicKey(e.mint.address),notUseTokenAccount:n,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!n,associatedOnly:!n&&u,checkCreateATAOwner:c});i=t,o&&m.addInstruction(o)}k.push(i)}h||w||this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let A=null!=n?n:await this.getClmmPoolKeys(t.id),I=await rb.decreaseLiquidityInstructions({poolInfo:t,poolKeys:A,ownerPosition:i,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:h,tokenAccountB:w,rewardAccounts:k},liquidity:a,amountMinA:r,amountMinB:s});m.addInstruction({instructions:I.instructions,instructionTypes:[tJ.ClmmDecreasePosition]});let P=W({},I.address);if(o.closePosition){let e=await rb.closePositionInstructions({poolInfo:t,poolKeys:A,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:i});m.addInstruction({endInstructions:e.instructions,endInstructionTypes:e.instructionTypes}),P=W(W({},P),e.address)}return m.addCustomComputeBudget(l),m.versionBuild({txVersion:d,extInfo:{address:P}})}async closePosition({poolInfo:e,poolKeys:t,ownerPosition:n,txVersion:i}){!1===this.scope.availability.removeConcentratedPosition&&this.logAndCreateError("remove position feature disabled in your region");let o=this.createTxBuilder(),r=null!=t?t:await this.getClmmPoolKeys(e.id),s=rb.closePositionInstructions({poolInfo:e,poolKeys:r,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n});return o.addInstruction(s).versionBuild({txVersion:i,extInfo:{address:s.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:r,txVersion:s}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let a=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.address.toString()===tS.toString(),c=n.perSecond.mul(n.endTime-n.openTime),{account:l,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new y.PublicKey(n.mint.address),mint:new y.PublicKey(n.mint.address),notUseTokenAccount:!!u,skipCloseAccount:!u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new f(new tg(c.toFixed(0)).gte(c)?c.toFixed(0):c.add(1).toFixed(0))}:void 0,associatedOnly:!u&&i,checkCreateATAOwner:o});d&&a.addInstruction(d),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let m=await this.getClmmPoolKeys(e.id),p=rb.initRewardInstructions({poolInfo:e,poolKeys:m,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{programId:new y.PublicKey(n.mint.programId),mint:new y.PublicKey(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:o8.decimalToX64(n.perSecond)}});return a.addInstruction(p),a.addCustomComputeBudget(r),a.versionBuild({txVersion:s,extInfo:{address:p.address}})}async initRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:i,associatedOnly:o=!0,checkCreateATAOwner:r=!1,computeBudgetConfig:s,txVersion:a}){for(let e of i)e.endTime<=e.openTime&&this.logAndCreateError("reward time error","rewardInfo",e);let u=this.createTxBuilder(),c={};for(let s of i){let i=n.useSOLBalance&&s.mint.address===tS.toString(),a=s.perSecond.mul(s.endTime-s.openTime),{account:l,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new y.PublicKey(s.mint.programId),mint:new y.PublicKey(s.mint.address),notUseTokenAccount:!!i,skipCloseAccount:!i,owner:this.scope.ownerPubKey,createInfo:i?{payer:n.feePayer||this.scope.ownerPubKey,amount:new f(new tg(a.toFixed(0)).gte(a)?a.toFixed(0):a.add(1).toFixed(0))}:void 0,associatedOnly:!i&&o,checkCreateATAOwner:r});d&&u.addInstruction(d),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let m=null!=t?t:await this.getClmmPoolKeys(e.id),p=rb.initRewardInstructions({poolInfo:e,poolKeys:m,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{programId:new y.PublicKey(s.mint.programId),mint:new y.PublicKey(s.mint.address),openTime:s.openTime,endTime:s.endTime,emissionsPerSecondX64:o8.decimalToX64(s.perSecond)}});c=W(W({},c),p.address),u.addInstruction(p)}return u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:c}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:r,txVersion:s}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let a=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.equals(tS),{account:c,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new f(new tg(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:!u&&i,checkCreateATAOwner:o});l&&a.addInstruction(l),c||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=await this.getClmmPoolKeys(e.id),m=rb.setRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:c},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:o8.decimalToX64(n.perSecond)}});return a.addInstruction(m),a.addCustomComputeBudget(r),a.versionBuild({txVersion:s,extInfo:{address:m.address}})}async setRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:i,associatedOnly:o=!0,checkCreateATAOwner:r=!1,computeBudgetConfig:s,txVersion:a}){let u=this.createTxBuilder(),c={};for(let s of i){s.endTime<=s.openTime&&this.logAndCreateError("reward time error","rewardInfo",s);let i=n.useSOLBalance&&s.mint.address===tS.toString(),{account:a,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new y.PublicKey(s.mint.programId),mint:new y.PublicKey(s.mint.address),notUseTokenAccount:i,owner:this.scope.ownerPubKey,createInfo:i?{payer:n.feePayer||this.scope.ownerPubKey,amount:new f(new tg(s.perSecond.sub(s.endTime-s.openTime).toFixed(0)).gte(s.perSecond.sub(s.endTime-s.openTime))?s.perSecond.sub(s.endTime-s.openTime).toFixed(0):s.perSecond.sub(s.endTime-s.openTime).add(1).toFixed(0))}:void 0,associatedOnly:!i&&o,checkCreateATAOwner:r});l&&u.addInstruction(l),a||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=null!=t?t:await this.getClmmPoolKeys(e.id),m=rb.setRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:a},rewardInfo:{mint:new y.PublicKey(s.mint.address),openTime:s.openTime,endTime:s.endTime,emissionsPerSecondX64:o8.decimalToX64(s.perSecond)}});u.addInstruction(m),c=W(W({},c),m.address)}return u.addCustomComputeBudget(s),u.versionBuild({txVersion:a,extInfo:{address:c}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1}){let r=e.rewardDefaultInfos.find(e=>e.mint.address===n.toString());r||this.logAndCreateError("reward mint error","not found reward mint",n);let s=this.createTxBuilder(),a=t.useSOLBalance&&n.equals(tS),{account:u,instructionParams:c}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new y.PublicKey(r.mint.programId),mint:n,notUseTokenAccount:a,owner:this.scope.ownerPubKey,skipCloseAccount:!a,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:!a&&i,checkCreateATAOwner:o});c&&s.addInstruction(c),u||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let l=await this.getClmmPoolKeys(e.id),d=rb.collectRewardInstructions({poolInfo:e,poolKeys:l,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:u},rewardMint:n});return s.addInstruction(d),s.build({address:d.address})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1}){let r=this.createTxBuilder(),s={};for(let a of n){let n=e.rewardDefaultInfos.find(e=>e.mint.address===a.toString());if(!n){this.logAndCreateError("reward mint error","not found reward mint",a);continue}let u=t.useSOLBalance&&a.equals(tS),{account:c,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new y.PublicKey(n.mint.programId),mint:a,notUseTokenAccount:u,owner:this.scope.ownerPubKey,skipCloseAccount:!u,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:!u&&i,checkCreateATAOwner:o});c||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),l&&r.addInstruction(l);let d=await this.getClmmPoolKeys(e.id),m=rb.collectRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:c},rewardMint:a});r.addInstruction(m),s=W(W({},s),m.address)}return r.build({address:s})}async swap({poolInfo:e,poolKeys:t,inputMint:n,amountIn:i,amountOutMin:o,priceLimit:r,observationId:s,ownerInfo:a,remainingAccounts:u,associatedOnly:c=!0,checkCreateATAOwner:l=!1,txVersion:d}){let m,p,g=this.createTxBuilder(),h=n.toString()===e.mintA.address,w=a.useSOLBalance&&e.mintA.address===tS.toBase58(),b=a.useSOLBalance&&e.mintB.address===tS.toBase58(),k;if(k=!r||r.equals(new tg(0))?h?oz.add(new f(1)):oj.sub(new f(1)):o9.priceToSqrtPriceX64(r,e.mintA.decimals,e.mintB.decimals),!m){let{account:t,instructionParams:n}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new y.PublicKey(e.mintA.address),notUseTokenAccount:w,owner:this.scope.ownerPubKey,skipCloseAccount:!w,createInfo:w||!h?{payer:a.feePayer||this.scope.ownerPubKey,amount:h?i:0}:void 0,associatedOnly:!w&&c,checkCreateATAOwner:l});m=t,n&&g.addInstruction(n)}if(!p){let{account:t,instructionParams:n}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new y.PublicKey(e.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,skipCloseAccount:!b,createInfo:b||h?{payer:a.feePayer||this.scope.ownerPubKey,amount:h?0:i}:void 0,associatedOnly:!b&&c,checkCreateATAOwner:l});p=t,n&&g.addInstruction(n)}m&&p||this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:m,ownerTokenAccountB:p,mintAUseSOLBalance:w,mintBUseSOLBalance:b,associatedOnly:c});let A=null!=t?t:await this.getClmmPoolKeys(e.id);return g.addInstruction(rb.makeSwapBaseInInstructions({poolInfo:e,poolKeys:A,observationId:s,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:m,tokenAccountB:p},inputMint:new y.PublicKey(n),amountIn:i,amountOutMin:o,sqrtPriceLimitX64:k,remainingAccounts:u})),g.versionBuild({txVersion:d})}async harvestAllRewards({allPoolInfo:e,allPositions:t,ownerInfo:n,associatedOnly:i=!0,checkCreateATAOwner:o=!1,programId:r,txVersion:s,computeBudgetConfig:a}){let u={};for(let e of this.scope.account.tokenAccountRawInfos)i?nS(this.scope.ownerPubKey,e.accountInfo.mint,r).publicKey.equals(e.pubkey)&&(u[e.accountInfo.mint.toString()]=e.pubkey):u[e.accountInfo.mint.toString()]=e.pubkey;let c=this.createTxBuilder();for(let r of Object.values(e)){if(void 0===t[r.id]||!t[r.id].find(e=>!e.liquidity.isZero()||e.rewardInfos.find(e=>!e.rewardAmountOwed.isZero())))continue;let e=n.useSOLBalance&&r.mintA.address===tS.toString(),s=n.useSOLBalance&&r.mintB.address===tS.toString(),a=u[r.mintA.address];if(!a){let{account:t,instructionParams:s}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:r.mintA.programId,mint:new y.PublicKey(r.mintA.address),notUseTokenAccount:e,owner:this.scope.ownerPubKey,skipCloseAccount:!e,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:!e&&i,checkCreateATAOwner:o});a=t,s&&c.addInstruction(s)}let l=u[r.mintB.address];if(!l){let{account:e,instructionParams:t}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:r.mintB.programId,mint:new y.PublicKey(r.mintB.address),notUseTokenAccount:s,owner:this.scope.ownerPubKey,skipCloseAccount:!s,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:!s&&i,checkCreateATAOwner:o});l=e,t&&c.addInstruction(t)}u[r.mintA.address]=a,u[r.mintB.address]=l;let d=[];for(let e of r.rewardDefaultInfos){let t=n.useSOLBalance&&e.mint.address===tS.toString(),o=u[e.mint.address];if(!o){let{account:r,instructionParams:s}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new y.PublicKey(e.mint.programId),mint:new y.PublicKey(e.mint.address),notUseTokenAccount:t,owner:this.scope.ownerPubKey,skipCloseAccount:!t,createInfo:{payer:n.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:!t&&i});o=r,s&&c.addInstruction(s)}u[e.mint.address]=o,d.push(o)}let m=await this.getClmmPoolKeys(r.id);for(let e of t[r.id]){let t=rb.decreaseLiquidityInstructions({poolInfo:r,poolKeys:m,ownerPosition:e,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:a,tokenAccountB:l,rewardAccounts:d},liquidity:new f(0),amountMinA:new f(0),amountMinB:new f(0)});c.addInstruction(t)}}return 0===s?c.sizeCheckBuildV0({computeBudgetConfig:a}):c.sizeCheckBuild({computeBudgetConfig:a})}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(t8([oq],e).publicKey);return t?rh.decode(t.data).whitelistMints.filter(e=>!e.equals(y.PublicKey.default)):[]}async getOwnerPositionInfo({programId:e}){await this.scope.account.fetchWalletTokenAccounts();let t=this.scope.account.tokenAccountRawInfos.filter(e=>e.accountInfo.amount.eq(new f(1))).map(t=>oM(new y.PublicKey(e),t.accountInfo.mint).publicKey),n=await this.scope.connection.getMultipleAccountsInfo(t),i=[];return n.forEach(e=>{if(!e)return;let t=rm.decode(e.data);i.push(t)}),i}async getRpcClmmPoolInfo({poolId:e}){return(await this.getRpcClmmPoolInfos({poolIds:[e]}))[String(e)]}async getRpcClmmPoolInfos({poolIds:e,config:t}){let n=await no(this.scope.connection,e.map(e=>({pubkey:new y.PublicKey(e)})),t),i={};for(let t=0;t<e.length;t++){let o=n[t];if(null===o||!o.accountInfo)throw Error("fetch pool info error: "+String(e[t]));let r=rl.decode(o.accountInfo.data),s=o9.sqrtPriceX64ToPrice(r.sqrtPriceX64,r.mintDecimalsA,r.mintDecimalsB).toNumber();i[String(e[t])]=_(W({},r),{currentPrice:s,programId:o.accountInfo.owner})}return i}async getComputeClmmPoolInfos({clmmPoolsRpcInfo:e,mintInfos:t}){let n=new Set(Object.keys(e).map(t=>e[t].ammConfig.toBase58())),i=await no(this.scope.connection,Array.from(n).map(e=>({pubkey:new y.PublicKey(e)}))),o={};i.forEach(e=>{e.accountInfo&&(o[e.pubkey.toBase58()]=rs.decode(e.accountInfo.data))});let r=await o2.fetchComputeMultipleClmmInfo({connection:this.scope.connection,rpcDataMap:e,poolList:Object.keys(e).map(n=>{var i,r,s,a;let[u,c]=[e[n].mintA.toBase58(),e[n].mintB.toBase58()];return{id:n,programId:e[n].programId.toBase58(),mintA:oo({address:u,decimals:e[n].mintDecimalsA,programId:t[u].programId.toBase58()||b.H_.toBase58(),extensions:{feeConfig:null!=(i=t[u])&&i.feeConfig?or(null==(r=t[u])?void 0:r.feeConfig):void 0}}),mintB:oo({address:c,decimals:e[n].mintDecimalsB,programId:t[c].programId.toBase58()||b.H_.toBase58(),extensions:{feeConfig:null!=(s=t[c])&&s.feeConfig?or(null==(a=t[c])?void 0:a.feeConfig):void 0}}),price:e[n].currentPrice,config:_(W({},o[e[n].ammConfig.toBase58()]),{id:e[n].ammConfig.toBase58(),fundFeeRate:0,description:"",defaultRange:0,defaultRangePoint:[]})}})}),s=await o2.fetchMultiplePoolTickArrays({connection:this.scope.connection,poolKeys:Object.values(r)});return{computeClmmPoolInfo:r,computePoolTickData:s}}async getPoolInfoFromRpc(e){var t,n;let i=await this.getRpcClmmPoolInfo({poolId:e}),o=new Set([i.mintA.toBase58(),i.mintB.toBase58()]),r=await ns({connection:this.scope.connection,mints:Array.from(o).map(e=>new y.PublicKey(e))}),{computeClmmPoolInfo:s,computePoolTickData:a}=await this.scope.clmm.getComputeClmmPoolInfos({clmmPoolsRpcInfo:{[e]:i},mintInfos:r}),u=await no(this.scope.connection,[{pubkey:i.vaultA},{pubkey:i.vaultB}]),c=_(W({},n=s[e]),{type:"Concentrated",programId:n.programId.toString(),id:n.id.toString(),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Clmm",price:n.currentPrice.toNumber(),mintAmountA:0,mintAmountB:0,feeRate:n.ammConfig.tradeFeeRate,openTime:n.startTime.toString(),tvl:0,day:o5,week:o5,month:o5,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,config:_(W({},n.ammConfig),{id:n.ammConfig.id.toString(),defaultRange:0,defaultRangePoint:[]})});if(!u[0].accountInfo||!u[1].accountInfo)throw Error("pool vault data not found");c.mintAmountA=Number(S.p0.decode(u[0].accountInfo.data).amount.toString()),c.mintAmountB=Number(S.p0.decode(null==(t=u[1].accountInfo)?void 0:t.data).amount.toString());let l=_(W({},s[e]),{id:e,programId:i.programId.toBase58(),openTime:i.startTime.toString(),vault:{A:i.vaultA.toBase58(),B:i.vaultB.toBase58()},rewardInfos:[],config:c.config});return{poolInfo:c,poolKeys:l,computePoolInfo:s[e],tickData:a}}},rO=new f(1e6),rq=class{static tradingFee(e,t){return e.mul(t).add(rO).sub(new f(1)).div(rO)}static protocolFee(e,t){return e.mul(t).div(rO)}static fundFee(e,t){return e.mul(t).div(rO)}};function rR(e,t){if(t.isZero())throw Error("divisor is zero");return e.mod(t)}var rL=new f(0),rE=class{static swapWithoutFees(e,t,n){let[i,o]=function(e,t){if(t.isZero())throw Error("rhs is zero");let n=e.div(t);if(n.isZero())throw Error("quotient is zero");let i=rR(e,t);return i.gt(rL)&&(n=n.add(new f(1)),t=e.div(n),(i=rR(e,n)).gt(rL)&&(t=t.add(new f(1)))),[n,t]}(t.mul(n),t.add(e)),r=o.sub(t),s=n.sub(i);if(s.isZero())throw Error("destinationAmountSwapped is zero");return{sourceAmountSwapped:r,destinationAmountSwapped:s}}static lpTokensToTradingTokens(e,t,n,i,o){let r=e.mul(n).div(t),s=e.mul(i).div(t);if(0===o)return{tokenAmount0:r,tokenAmount1:s};if(1===o)return rR(e.mul(n),t).gt(rL)&&r.gt(rL)&&(r=r.add(new f(1))),rR(e.mul(i),t).gt(rL)&&s.gt(rL)&&(s=s.add(new f(1))),{tokenAmount0:r,tokenAmount1:s};throw Error("roundDirection value error")}},rF=((m=rF||{})[m.Floor=0]="Floor",m[m.Ceiling=1]="Ceiling",m),rM=class{static validate_supply(e,t){if(e.isZero())throw Error("tokenAmount0 is zero");if(t.isZero())throw Error("tokenAmount1 is zero")}static swap(e,t,n,i){let o=rq.tradingFee(e,i),r=e.sub(o),{sourceAmountSwapped:s,destinationAmountSwapped:a}=rE.swapWithoutFees(r,t,n),u=s.add(o);return{newSwapSourceAmount:t.add(u),newSwapDestinationAmount:n.sub(a),sourceAmountSwapped:u,destinationAmountSwapped:a,tradeFee:o}}},rW=x.from("vault_and_lp_mint_auth_seed","utf8"),r_=x.from("amm_config","utf8"),rD=x.from("pool","utf8"),rN=x.from("pool_lp_mint","utf8"),rV=x.from("pool_vault","utf8"),rU=x.from("observation","utf8");function rX(e){return t8([rW],e)}function rH(e,t,n){return t8([rV,t.toBuffer(),n.toBuffer()],e)}function rG(e,t){return t8([rU,t.toBuffer()],e)}var rz=H("Raydium_cpmm"),rj={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173]};function rQ(e,t,n,i,o,r,s,a,u,c,l,d,m,p,g,h){let f=ii([n6("amountIn"),n6("amounOutMin")]),w=x.alloc(f.span);return f.encode({amountIn:g,amounOutMin:h},w),new y.TransactionInstruction({keys:[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],programId:e,data:x.from([...rj.swapBaseInput,...w])})}function rZ(e,t,n,i,o,r,s,a,u,c,l,d,m,p,g,h){let f=ii([n6("amountInMax"),n6("amountOut")]),w=x.alloc(f.span);return f.encode({amountInMax:g,amountOut:h},w),new y.TransactionInstruction({keys:[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],programId:e,data:x.from([...rj.swapBaseOutput,...w])})}var rY=ii([nY(8),n0("bump"),n7("disableCreatePool"),nG("index"),n6("tradeFeeRate"),n6("protocolFeeRate"),n6("fundFeeRate"),n6("createPoolFee"),n3("protocolOwner"),n3("fundOwner"),io(n6(),16)]),r$=ii([nY(8),n3("configId"),n3("poolCreator"),n3("vaultA"),n3("vaultB"),n3("mintLp"),n3("mintA"),n3("mintB"),n3("mintProgramA"),n3("mintProgramB"),n3("observationId"),n0("bump"),n0("status"),n0("lpDecimals"),n0("mintDecimalA"),n0("mintDecimalB"),n6("lpAmount"),n6("protocolFeesMintA"),n6("protocolFeesMintB"),n6("fundFeesMintA"),n6("fundFeesMintB"),n6("openTime"),io(n6(),32)]),rJ=class extends nN{constructor(e){super(e)}async load(){this.checkDisabled()}async getCpmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async getRpcPoolInfo(e,t){return(await this.getRpcPoolInfos([e],t))[e]}async getRpcPoolInfos(e,t){let n=await no(this.scope.connection,e.map(e=>({pubkey:new y.PublicKey(e)}))),i={},o=new Set,r=[];for(let t=0;t<e.length;t++){let s=n[t];if(null===s.accountInfo)throw Error("fetch pool info error: "+String(e[t]));let a=r$.decode(s.accountInfo.data);i[String(e[t])]=_(W({},a),{programId:s.accountInfo.owner}),o.add(String(a.configId)),r.push(a.vaultA,a.vaultB)}let s={};if(t){let e=[...o],t=await no(this.scope.connection,e.map(e=>({pubkey:new y.PublicKey(e)})));for(let n=0;n<e.length;n++){let i=t[n].accountInfo;if(null===i)throw Error("fetch pool config error: "+e[n]);s[e[n]]=rY.decode(i.data)}}let a={},u=await no(this.scope.connection,r.map(e=>({pubkey:new y.PublicKey(e)})));for(let e=0;e<r.length;e++){let t=u[e].accountInfo;if(null===t)throw Error("fetch vault info error: "+r[e]);a[String(r[e])]=new f(S.p0.decode(t.data).amount.toString())}let c={};for(let[e,t]of Object.entries(i)){let n=a[t.vaultA.toString()].sub(t.protocolFeesMintA).sub(t.fundFeesMintA),i=a[t.vaultB.toString()].sub(t.protocolFeesMintB).sub(t.fundFeesMintB);c[e]=_(W({},t),{baseReserve:n,quoteReserve:i,vaultAAmount:a[t.vaultA.toString()],vaultBAmount:a[t.vaultB.toString()],configInfo:s[t.configId.toString()],poolPrice:new tg(i.toString()).div(new tg(10).pow(t.mintDecimalB)).div(new tg(n.toString()).div(new tg(10).pow(t.mintDecimalA)))})}return c}toComputePoolInfos({pools:e,mintInfos:t}){return Object.keys(e).reduce((n,i)=>{var o,r,s,a;let u=e[i],[c,l]=[u.mintA.toBase58(),u.mintB.toBase58()];return _(W({},n),{[i]:_(W({},u),{id:new y.PublicKey(i),configInfo:u.configInfo,version:7,authority:rX(u.programId).publicKey,mintA:oo({address:c,decimals:u.mintDecimalA,programId:u.mintProgramA.toBase58(),extensions:{feeConfig:null!=(o=t[c])&&o.feeConfig?or(null==(r=t[c])?void 0:r.feeConfig):void 0}}),mintB:oo({address:l,decimals:u.mintDecimalB,programId:u.mintProgramB.toBase58(),extensions:{feeConfig:null!=(s=t[l])&&s.feeConfig?or(null==(a=t[l])?void 0:a.feeConfig):void 0}})})})},{})}async getPoolInfoFromRpc(e){let t=await this.getRpcPoolInfo(e,!0),n=await ns({connection:this.scope.connection,mints:[t.mintA,t.mintB]}),i=oo({address:t.mintA.toBase58(),decimals:t.mintDecimalA,programId:t.mintProgramA.toBase58(),extensions:{feeConfig:n[t.mintA.toBase58()].feeConfig?or(n[t.mintA.toBase58()].feeConfig):void 0}}),o=oo({address:t.mintB.toBase58(),decimals:t.mintDecimalB,programId:t.mintProgramB.toBase58(),extensions:{feeConfig:n[t.mintB.toBase58()].feeConfig?or(n[t.mintB.toBase58()].feeConfig):void 0}}),r=oo({address:t.mintLp.toBase58(),decimals:t.lpDecimals,programId:b.H_.toBase58()}),s={id:t.configId.toBase58(),index:t.configInfo.index,protocolFeeRate:t.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:t.configInfo.tradeFeeRate.toNumber(),fundFeeRate:t.configInfo.fundFeeRate.toNumber(),createPoolFee:t.configInfo.createPoolFee.toString()},a={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};return{poolInfo:{programId:t.programId.toBase58(),id:e,type:"Standard",lpMint:r,lpPrice:0,lpAmount:t.lpAmount.toNumber(),config:s,mintA:i,mintB:o,rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:t.poolPrice.toNumber(),mintAmountA:new tg(t.vaultAAmount.toString()).div(10**i.decimals).toNumber(),mintAmountB:new tg(t.vaultBAmount.toString()).div(10**o.decimals).toNumber(),feeRate:t.configInfo.tradeFeeRate.toNumber(),openTime:t.openTime.toString(),tvl:0,day:a,week:a,month:a,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0},poolKeys:{programId:t.programId.toBase58(),id:e,mintA:i,mintB:o,openTime:t.openTime.toString(),vault:{A:t.vaultA.toBase58(),B:t.vaultB.toBase58()},authority:rX(t.programId).publicKey.toBase58(),mintLp:r,config:s},rpcData:t}}async createPool(e){let t,n,i;var o,r,s,a,u,c,l,d,m,p,g,h,w,k,{programId:A,poolFeeAccount:I,startTime:P,ownerInfo:T,associatedOnly:S=!1,checkCreateATAOwner:B=!1,txVersion:v,computeBudgetConfig:K}=e,C=D(e,["programId","poolFeeAccount","startTime","ownerInfo","associatedOnly","checkCreateATAOwner","txVersion","computeBudgetConfig"]);let O=T.feePayer||(null==(h=this.scope.owner)?void 0:h.publicKey),q=new f(new y.PublicKey(C.mintA.address).toBuffer()).lte(new f(new y.PublicKey(C.mintB.address).toBuffer())),[R,L]=q?[C.mintA,C.mintB]:[C.mintB,C.mintA],[E,F]=q?[C.mintAAmount,C.mintBAmount]:[C.mintBAmount,C.mintAAmount],M=T.useSOLBalance&&R.address===b.Gd.toBase58(),N=T.useSOLBalance&&L.address===b.Gd.toBase58(),[V,U]=[new y.PublicKey(R.address),new y.PublicKey(L.address)],X=this.createTxBuilder(),{account:H,instructionParams:G}=await this.scope.account.getOrCreateTokenAccount({mint:V,tokenProgram:R.programId,owner:this.scope.ownerPubKey,createInfo:M?{payer:O,amount:E}:void 0,notUseTokenAccount:M,skipCloseAccount:!M,associatedOnly:!M&&S,checkCreateATAOwner:B});X.addInstruction(G||{});let{account:z,instructionParams:j}=await this.scope.account.getOrCreateTokenAccount({mint:new y.PublicKey(L.address),tokenProgram:L.programId,owner:this.scope.ownerPubKey,createInfo:N?{payer:O,amount:F}:void 0,notUseTokenAccount:N,skipCloseAccount:!N,associatedOnly:!N&&S,checkCreateATAOwner:B});if(X.addInstruction(j||{}),void 0===H||void 0===z)throw Error("you don't has some token account");let Q=function({programId:e,mintA:t,mintB:n}){let i;let o=t8([r_,(i=new ArrayBuffer(2),new DataView(i).setUint16(0,0,!1),new Uint8Array(i))],e).publicKey,r=rX(e).publicKey,s=t8([rD,o.toBuffer(),t.toBuffer(),n.toBuffer()],e).publicKey,a=t8([rN,s.toBuffer()],e).publicKey,u=rH(e,s,t).publicKey,c=rH(e,s,n).publicKey,l=rG(e,s).publicKey;return{poolId:s,configId:o,authority:r,lpMint:a,vaultA:u,vaultB:c,observationId:l}}({programId:A,mintA:V,mintB:U});return X.addInstruction({instructions:[(o=this.scope.ownerPubKey,r=Q.configId,s=Q.authority,a=Q.poolId,u=Q.lpMint,c=nS(this.scope.ownerPubKey,Q.lpMint).publicKey,l=Q.vaultA,d=Q.vaultB,m=new y.PublicKey(null!=(w=R.programId)?w:b.H_),p=new y.PublicKey(null!=(k=L.programId)?k:b.H_),g=Q.observationId,t=ii([n6("amountMaxA"),n6("amountMaxB"),n6("openTime")]),n=[{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:V,isSigner:!1,isWritable:!1},{pubkey:U,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:H,isSigner:!1,isWritable:!0},{pubkey:z,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:I,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:b.H_,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:b._u,isSigner:!1,isWritable:!1},{pubkey:tT,isSigner:!1,isWritable:!1},{pubkey:tA,isSigner:!1,isWritable:!1}],i=x.alloc(t.span),t.encode({amountMaxA:E,amountMaxB:F,openTime:P},i),new y.TransactionInstruction({keys:n,programId:A,data:x.from([...rj.initialize,...i])}))],instructionTypes:[tJ.CpmmCreatePool]}),X.addCustomComputeBudget(K),X.versionBuild({txVersion:v,extInfo:{address:_(W({},Q),{mintA:R,mintB:L,programId:A,poolFeeAccount:I})}})}async addLiquidity(e){var t,n,i,o,r,s,a,u,c,l;let d,m,p,{poolInfo:g,poolKeys:h,inputAmount:w,baseIn:k,slippage:A,computeResult:I,computeBudgetConfig:P,config:T,txVersion:S}=e;!1===this.scope.availability.addStandardPosition&&this.logAndCreateError("add liquidity feature disabled in your region"),w.isZero()&&this.logAndCreateError("amounts must greater than zero","amountInA",{amountInA:w.toString()});let{account:B}=this.scope,{bypassAssociatedCheck:v,checkCreateATAOwner:K}=W({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},T),C=I?void 0:await this.getRpcPoolInfo(g.id),{liquidity:O,inputAmountFee:q,anotherAmount:R}=I||this.computePairAmount({poolInfo:_(W({},g),{lpAmount:new tg(C.lpAmount.toString()).div(10**g.lpMint.decimals).toNumber()}),baseReserve:C.baseReserve,quoteReserve:C.quoteReserve,slippage:new tN(0),baseIn:k,epochInfo:await this.scope.fetchEpochInfo(),amount:new tg(w.toString()).div(10**(k?g.mintA.decimals:g.mintB.decimals))}),L=R.amount,E=g.mintA.address===b.Gd.toString(),F=g.mintB.address===b.Gd.toString(),M=this.createTxBuilder(),[N,V]=[new y.PublicKey(g.mintA.address),new y.PublicKey(g.mintB.address)],{account:U,instructionParams:X}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:g.mintA.programId,mint:new y.PublicKey(g.mintA.address),owner:this.scope.ownerPubKey,createInfo:E||(k?w:L).isZero()?{payer:this.scope.ownerPubKey,amount:k?w:L}:void 0,skipCloseAccount:!E,notUseTokenAccount:E,associatedOnly:!1,checkCreateATAOwner:K});M.addInstruction(X||{});let{account:H,instructionParams:G}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:g.mintB.programId,mint:new y.PublicKey(g.mintB.address),owner:this.scope.ownerPubKey,createInfo:F||(k?L:w).isZero()?{payer:this.scope.ownerPubKey,amount:k?L:w}:void 0,skipCloseAccount:!F,notUseTokenAccount:F,associatedOnly:!1,checkCreateATAOwner:K});M.addInstruction(G||{}),U||H||this.logAndCreateError("cannot found target token accounts","tokenAccounts",B.tokenAccounts);let z=await B.getCreatedTokenAccount({mint:new y.PublicKey(g.lpMint.address)}),j=await B.handleTokenAccount({side:"out",amount:0,mint:new y.PublicKey(g.lpMint.address),tokenAccount:z,bypassAssociatedCheck:v,checkCreateATAOwner:K}),{tokenAccount:Q}=j,Z=D(j,["tokenAccount"]);M.addInstruction(Z);let Y=null!=h?h:await this.getCpmmPoolKeys(g.id),$=new tN(new f(1)).sub(A);return M.addInstruction({instructions:[(t=new y.PublicKey(g.programId),n=this.scope.ownerPubKey,i=new y.PublicKey(Y.authority),o=new y.PublicKey(g.id),r=new y.PublicKey(Y.vault.A),s=new y.PublicKey(Y.vault.B),a=new y.PublicKey(g.lpMint.address),u=I?null==I?void 0:I.liquidity:$.mul(O).quotient,c=k?q.amount:L,l=k?L:q.amount,d=ii([n6("lpAmount"),n6("amountMaxA"),n6("amountMaxB")]),m=[{pubkey:n,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:Q,isSigner:!1,isWritable:!0},{pubkey:U,isSigner:!1,isWritable:!0},{pubkey:H,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:b.H_,isSigner:!1,isWritable:!1},{pubkey:b.nA,isSigner:!1,isWritable:!1},{pubkey:N,isSigner:!1,isWritable:!1},{pubkey:V,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0}],p=x.alloc(d.span),rz.debug("cpmm deposit data",{lpAmount:u.toString(),amountMaxA:c.toString(),amountMaxB:l.toString()}),d.encode({lpAmount:u,amountMaxA:c,amountMaxB:l},p),new y.TransactionInstruction({keys:m,programId:t,data:x.from([...rj.deposit,...p])}))],instructionTypes:[tJ.CpmmAddLiquidity],lookupTableAddress:Y.lookupTableAccount?[Y.lookupTableAccount]:[]}),M.addCustomComputeBudget(P),M.versionBuild({txVersion:S})}async withdrawLiquidity(e){var t,n,i,o,r,s,a,u,c,l,d;let m,p,g;let{poolInfo:h,poolKeys:w,lpAmount:k,slippage:A,computeBudgetConfig:I,txVersion:P}=e;!1===this.scope.availability.addStandardPosition&&this.logAndCreateError("add liquidity feature disabled in your region");let T=new tN(new f(1)).sub(A),S=await this.getRpcPoolInfo(h.id),[B,v]=[T.mul(k.mul(S.baseReserve).div(S.lpAmount)).quotient,T.mul(k.mul(S.quoteReserve).div(S.lpAmount)).quotient],K=await this.scope.fetchEpochInfo(),[C,O]=[nB(B,h.mintA.extensions.feeConfig,K,!1),nB(v,h.mintB.extensions.feeConfig,K,!1)],{account:q}=this.scope,R=this.createTxBuilder(),[L,E]=[new y.PublicKey(h.mintA.address),new y.PublicKey(h.mintB.address)],F=L.equals(tS),M=E.equals(tS),{account:W,instructionParams:_}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:h.mintA.programId,mint:new y.PublicKey(h.mintA.address),notUseTokenAccount:F,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!F,associatedOnly:!F,checkCreateATAOwner:!1});_&&R.addInstruction(_);let{account:D,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:h.mintB.programId,mint:new y.PublicKey(h.mintB.address),notUseTokenAccount:M,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!M,associatedOnly:!M,checkCreateATAOwner:!1});N&&R.addInstruction(N),W&&D||this.logAndCreateError("cannot found target token accounts","tokenAccounts",q.tokenAccounts);let V=await q.getCreatedTokenAccount({mint:new y.PublicKey(h.lpMint.address)});V||this.logAndCreateError("cannot found lp token account","tokenAccounts",q.tokenAccounts);let U=null!=w?w:await this.getCpmmPoolKeys(h.id);return R.addInstruction({instructions:[(i=new y.PublicKey(h.programId),o=this.scope.ownerPubKey,r=new y.PublicKey(U.authority),s=new y.PublicKey(h.id),a=new y.PublicKey(U.vault.A),u=new y.PublicKey(U.vault.B),c=new y.PublicKey(h.lpMint.address),l=B.sub(null!=(t=C.fee)?t:new f(0)),d=v.sub(null!=(n=O.fee)?n:new f(0)),m=ii([n6("lpAmount"),n6("amountMinA"),n6("amountMinB")]),p=[{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:V,isSigner:!1,isWritable:!0},{pubkey:W,isSigner:!1,isWritable:!0},{pubkey:D,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:b.H_,isSigner:!1,isWritable:!1},{pubkey:b.nA,isSigner:!1,isWritable:!1},{pubkey:L,isSigner:!1,isWritable:!1},{pubkey:E,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:tk,isSigner:!1,isWritable:!1}],g=x.alloc(m.span),m.encode({lpAmount:k,amountMinA:l,amountMinB:d},g),new y.TransactionInstruction({keys:p,programId:i,data:x.from([...rj.withdraw,...g])}))],instructionTypes:[tJ.CpmmWithdrawLiquidity],lookupTableAddress:U.lookupTableAccount?[U.lookupTableAccount]:[]}),R.addCustomComputeBudget(I),R.versionBuild({txVersion:P})}async swap(e){var t,n,i,o,r,s;let{poolInfo:a,poolKeys:u,baseIn:c,swapResult:l,slippage:d=0,config:m,computeBudgetConfig:p,txVersion:g}=e,{bypassAssociatedCheck:h,checkCreateATAOwner:w,associatedOnly:k}=W({bypassAssociatedCheck:!1,checkCreateATAOwner:!1,associatedOnly:!0},m),A=this.createTxBuilder(),[I,P]=[new y.PublicKey(a.mintA.address),new y.PublicKey(a.mintB.address)];l.destinationAmountSwapped=l.destinationAmountSwapped.mul(new f((1-d)*1e4)).div(new f(1e4));let T=a.mintA.address===tS.toBase58(),S=a.mintB.address===tS.toBase58(),{account:B,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({mint:I,tokenProgram:new y.PublicKey(null!=(t=a.mintA.programId)?t:b.H_),owner:this.scope.ownerPubKey,createInfo:T||!c?{payer:this.scope.ownerPubKey,amount:c?l.sourceAmountSwapped:0}:void 0,notUseTokenAccount:T,skipCloseAccount:!T,associatedOnly:!T&&k,checkCreateATAOwner:w});v&&A.addInstruction(v);let{account:K,instructionParams:C}=await this.scope.account.getOrCreateTokenAccount({mint:P,tokenProgram:new y.PublicKey(null!=(n=a.mintB.programId)?n:b.H_),owner:this.scope.ownerPubKey,createInfo:S||c?{payer:this.scope.ownerPubKey,amount:c?0:l.sourceAmountSwapped}:void 0,notUseTokenAccount:S,skipCloseAccount:!S,associatedOnly:!S&&k,checkCreateATAOwner:w});C&&A.addInstruction(C),B&&K||this.logAndCreateError("user do not have token account",{mintA:a.mintA.symbol||a.mintA.address,mintB:a.mintB.symbol||a.mintB.address,mintATokenAcc:B,mintBTokenAcc:K,mintAUseSOLBalance:T,mintBUseSOLBalance:S,associatedOnly:k});let x=null!=u?u:await this.getCpmmPoolKeys(a.id);return A.addInstruction({instructions:[c?rQ(new y.PublicKey(a.programId),this.scope.ownerPubKey,new y.PublicKey(x.authority),new y.PublicKey(x.config.id),new y.PublicKey(a.id),B,K,new y.PublicKey(x.vault.A),new y.PublicKey(x.vault.B),new y.PublicKey(null!=(i=a.mintA.programId)?i:b.H_),new y.PublicKey(null!=(o=a.mintB.programId)?o:b.H_),I,P,rG(new y.PublicKey(a.programId),new y.PublicKey(a.id)).publicKey,l.sourceAmountSwapped,l.destinationAmountSwapped):rZ(new y.PublicKey(a.programId),this.scope.ownerPubKey,new y.PublicKey(x.authority),new y.PublicKey(x.config.id),new y.PublicKey(a.id),K,B,new y.PublicKey(x.vault.B),new y.PublicKey(x.vault.A),new y.PublicKey(null!=(r=a.mintB.programId)?r:b.H_),new y.PublicKey(null!=(s=a.mintA.programId)?s:b.H_),P,I,rG(new y.PublicKey(a.programId),new y.PublicKey(a.id)).publicKey,l.sourceAmountSwapped,l.destinationAmountSwapped)],instructionTypes:[c?tJ.CpmmSwapBaseIn:tJ.CpmmSwapBaseOut]}),A.addCustomComputeBudget(p),A.versionBuild({txVersion:g})}computeSwapAmount({pool:e,amountIn:t,outputMint:n,slippage:i}){let o=n.toString()===e.mintB.address,r=rM.swap(t,o?e.baseReserve:e.quoteReserve,o?e.quoteReserve:e.baseReserve,e.configInfo.tradeFeeRate),s=new tg(r.destinationAmountSwapped.toString()).div(r.sourceAmountSwapped.toString()),a=r.destinationAmountSwapped.mul(new f((1-i)*1e4)).div(new f(1e4));return{allTrade:r.sourceAmountSwapped.eq(t),amountIn:t,amountOut:r.destinationAmountSwapped,minAmountOut:a,executionPrice:s,fee:r.tradeFee,priceImpact:e.poolPrice.sub(s).div(e.poolPrice)}}computePairAmount({poolInfo:e,baseReserve:t,quoteReserve:n,amount:i,slippage:o,epochInfo:r,baseIn:s}){var a,u,c,l,d,m,p,g;let h=1-Number(o.toSignificant())/100,y=new f(new tg(i).mul(10**e[s?"mintA":"mintB"].decimals).mul(h).toFixed(0)),w=nB(y,e[s?"mintA":"mintB"].extensions.feeConfig,r,!1),b=y.sub(null!=(a=w.fee)?a:new f(0)),k=new f(new tg(e.lpAmount).mul(10**e.lpMint.decimals).toFixed(0,tg.ROUND_DOWN));this.logDebug("baseReserve:",t.toString(),"quoteReserve:",n.toString()),this.logDebug("tokenIn:",s?e.mintA.symbol:e.mintB.symbol,"amountIn:",y.toString(),"amountInFee:",null!=(c=null==(u=w.fee)?void 0:u.toString())?c:0,"anotherToken:",s?e.mintB.symbol:e.mintA.symbol,"slippage:",`${o.toSignificant()}%`);let A=s?"base":"quote";this.logDebug("input side:",A);let I=b.mul(k).div("base"===A?t:n),P={amount:tU,fee:void 0,expirationTime:void 0};if(!b.isZero()){let i,o;let a=((i=I.mul(t).div(k)).isZero()||I.mul(t).mod(k).isZero()||(i=i.add(new f(1))),(o=I.mul(n).div(k)).isZero()||I.mul(n).mod(k).isZero()||(o=o.add(new f(1))),{amountA:i,amountB:o});this.logDebug("lpAmountData:",{amountA:a.amountA.toString(),amountB:a.amountB.toString()}),P=nB(a[s?"amountB":"amountA"],e[s?"mintB":"mintA"].extensions.feeConfig,r,!0)}let T=nB(new tN(new f(1)).add(o).mul(P.amount.sub(null!=(l=P.fee)?l:new f(0))).quotient,e[s?"mintB":"mintA"].extensions.feeConfig,r,!0);return this.logDebug("anotherAmount:",P.amount.toString(),"anotherAmountFee:",null!=(m=null==(d=P.fee)?void 0:d.toString())?m:0,"maxAnotherAmount:",T.amount.toString(),"maxAnotherAmountFee:",null!=(g=null==(p=T.fee)?void 0:p.toString())?g:0),{inputAmountFee:w,anotherAmount:P,maxAnotherAmount:T,liquidity:I}}},r1={[nh.toBase58()]:3},r0={3:nh},r4=ii([nY(5),nY(8),n3("ownAddress"),n6("vaultSignerNonce"),n3("baseMint"),n3("quoteMint"),n3("baseVault"),n6("baseDepositsTotal"),n6("baseFeesAccrued"),n3("quoteVault"),n6("quoteDepositsTotal"),n6("quoteFeesAccrued"),n6("quoteDustThreshold"),n3("requestQueue"),n3("eventQueue"),n3("bids"),n3("asks"),n6("baseLotSize"),n6("quoteLotSize"),n6("feeRateBps"),n6("referrerRebatesAccrued"),nY(7)]),r6={3:r4},r2=H("Serum"),r5=class{static getProgramId(e){let t=r0[e];return t||r2.logWithError("invalid version","version",e),t}static getVersion(e){let t=e.toBase58(),n=r1[t];return n||r2.logWithError("invalid program id","programId",t),n}static getStateLayout(e){let t=r6[e];return t||r2.logWithError(!!t,"invalid version","version",e),t}static getLayouts(e){return{state:this.getStateLayout(e)}}static getAssociatedAuthority({programId:e,marketId:t}){let n=[t.toBuffer()],i=0,o;for(;i<100;){try{let t=n.concat(x.from([i]),x.alloc(7));o=y.PublicKey.createProgramAddressSync(t,e)}catch(e){if(e instanceof TypeError)throw e;i++;continue}return{publicKey:o,nonce:i}}return r2.logWithError("unable to find a viable program address nonce","params",{programId:e,marketId:t}),{publicKey:y.PublicKey.default,nonce:i}}},r8=new f(0),r3=class extends nN{constructor(e){super(e)}async getWSolAccounts(){this.scope.checkOwner(),await this.scope.account.fetchWalletTokenAccounts();let e=this.scope.account.tokenAccounts.filter(e=>e.mint.equals(tS));return e.sort((e,t)=>e.isAssociated?1:t.isAssociated||e.amount.lt(t.amount)?-1:1),e}async unWrapWSol(e){let{amount:t,tokenProgram:n,txVersion:i=1}=e,o=await this.getWSolAccounts(),r=this.createTxBuilder();r.addCustomComputeBudget(e.computeBudgetConfig);let s=await iT({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:0});r.addInstruction(s);let a=tG(t);for(let e=0;e<o.length;e++)a.gte(o[e].amount)?(r.addInstruction({instructions:[iP({tokenAccount:o[e].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]}),a.sub(o[e].amount)):(r.addInstruction({instructions:[iP({tokenAccount:o[e].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]}),iS({destination:s.addresses.newAccount,source:o[e].publicKey,amount:a,owner:this.scope.ownerPubKey,tokenProgram:n}));return r.versionBuild({txVersion:i})}async wrapWSol(e,t,n){let i=await this.getWSolAccounts(),o=this.createTxBuilder(),r=await iT({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:e,skipCloseAccount:!0});return o.addInstruction(r),i.length&&o.addInstruction({instructions:[iS({destination:i[0].publicKey,source:r.addresses.newAccount,amount:e,owner:this.scope.ownerPubKey,tokenProgram:t})],endInstructions:[iP({tokenAccount:r.addresses.newAccount,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:t})]}),o.versionBuild({txVersion:null!=n?n:1})}async swap({swapInfo:e,swapPoolKeys:t,ownerInfo:n,computeBudgetConfig:i,routeProgram:o,txVersion:r}){let s,a=this.createTxBuilder(),u=e.amountIn,c=e.amountOut,l=u.amount.token.mint.equals(tS),d=c.amount.token.mint.equals(tS),m=u.amount.token.mint,p=c.amount.token.mint,{account:g,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.amount.token.isToken2022?b.nA:b.H_,mint:m,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:l?{payer:this.scope.ownerPubKey,amount:u.amount.raw}:void 0,associatedOnly:!l&&n.associatedOnly,checkCreateATAOwner:n.checkCreateATAOwner});if(h&&a.addInstruction(h),void 0===g)throw Error("input account check error");let w=this.scope.account.getAssociatedTokenAccount(p,c.amount.token.isToken2022?b.nA:b.H_);if(d&&a.addInstruction({endInstructions:[iP({owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,tokenAccount:w,programId:b.H_})],endInstructionTypes:[tJ.CloseAccount]}),"route"===e.routeType){let t=e.middleToken;s=this.scope.account.getAssociatedTokenAccount(t.mint,t.isToken2022?b.nA:b.H_)}let k=t||await this.computePoolToPoolKeys({pools:e.poolInfoList}),A=function({routeProgram:e,ownerInfo:t,inputMint:n,swapInfo:i}){var o,r,s,a,u,c,l;if("amm"===i.routeType){if(6===i.poolInfo[0].version){let e=i.poolKey[0],a=tY(e),u=n.equals(a.mintA.address)?oz.add(oN):oj.sub(oN);return rb.makeSwapBaseInInstructions({poolInfo:e,poolKeys:e,observationId:i.poolInfo[0].observationId,ownerInfo:{wallet:t.wallet,tokenAccountA:a.mintA.address.equals(n)?t.sourceToken:t.destinationToken,tokenAccountB:a.mintA.address.equals(n)?t.destinationToken:t.sourceToken},inputMint:n,amountIn:i.amountIn.amount.raw,amountOutMin:i.minAmountOut.amount.raw.sub(null!=(r=null==(o=i.minAmountOut.fee)?void 0:o.raw)?r:new f(0)),sqrtPriceLimitX64:u,remainingAccounts:null!=(s=i.remainingAccounts[0])?s:[]})}if(7===i.poolInfo[0].version){let e=i.poolInfo[0],o=n.toString()===i.poolInfo[0].mintA.address;return{signers:[],instructions:[o?rQ(e.programId,t.wallet,e.authority,e.configId,e.id,t.sourceToken,t.destinationToken,e.vaultA,e.vaultB,e.mintProgramA,e.mintProgramA,new y.PublicKey(e.mintA.address),new y.PublicKey(e.mintB.address),e.observationId,i.amountIn.amount.raw,i.minAmountOut.amount.raw):rZ(e.programId,t.wallet,e.authority,e.configId,e.id,t.destinationToken,t.sourceToken,e.vaultB,e.vaultA,e.mintProgramB,e.mintProgramA,new y.PublicKey(e.mintB.address),new y.PublicKey(e.mintA.address),e.observationId,i.amountIn.amount.raw,i.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[o?tJ.CpmmSwapBaseIn:tJ.CpmmSwapBaseOut],address:{}}}{let e=i.poolKey[0];return{signers:[],instructions:[oI({poolKeys:e,version:i.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:t.sourceToken,tokenAccountOut:t.destinationToken,owner:t.wallet},amountIn:i.amountIn.amount.raw,amountOut:i.minAmountOut.amount.raw.sub(null!=(u=null==(a=i.minAmountOut.fee)?void 0:a.raw)?u:new f(0)),fixedSide:"in"})],lookupTableAddress:e.lookupTableAccount?[e.lookupTableAccount]:[],instructionTypes:[i.poolInfo[0].pooltype.includes("StablePool")?tJ.AmmV5SwapBaseIn:tJ.AmmV4SwapBaseIn],address:{}}}}if("route"===i.routeType){let o=i.poolInfo[0],r=i.poolInfo[1],s=i.poolKey[0],a=i.poolKey[1];if(void 0===t.routeToken)throw Error("owner route token account check error");return{signers:[],instructions:[function(e,t,n,i,o,r,s,a,u,c,l,d,m,p,g){var h;let w=[],k=[th({pubkey:b.H_,isWritable:!1}),th({pubkey:b.nA,isWritable:!1}),th({pubkey:b._u,isWritable:!1}),th({pubkey:y.SystemProgram.programId,isWritable:!1}),th({pubkey:t,isSigner:!0})];k.push(th({pubkey:n})),k.push(th({pubkey:o}));let A=[u,c],I=[l,d],P=[r,s,a];for(let e=0;e<A.length;e++){let t=A[e],n=P[e]===t.mintA.address;if(k.push(th({pubkey:new y.PublicKey(t.programId),isWritable:!1})),e===A.length-1?k.push(th({pubkey:o})):k.push(th({pubkey:i})),k.push(th({pubkey:new y.PublicKey(P[e])})),k.push(th({pubkey:new y.PublicKey(P[e+1])})),6===t.version){let i=I[e];for(let o of(k.push(th({pubkey:new y.PublicKey(i.config.id)})),k.push(th({pubkey:new y.PublicKey(i.id)})),k.push(th({pubkey:new y.PublicKey(n?i.vault.A:i.vault.B)})),k.push(th({pubkey:new y.PublicKey(n?i.vault.B:i.vault.A)})),k.push(th({pubkey:new y.PublicKey(t.observationId)})),k.push(th({pubkey:tk})),k.push(th({pubkey:o_(new y.PublicKey(t.programId),new y.PublicKey(t.id)).publicKey})),w.push(function(e,t){if(!e)return t?oQ:oZ;if(t){let t=new f(e).div(new f(25));return t.gt(oQ)?t:oQ}{let t=new f(e).mul(new f(25));return t.lt(oZ)?t:oZ}}(t.sqrtPriceX64.toString(),n)),null!=(h=g[e])?h:[]))k.push(th({pubkey:new y.PublicKey(o)}))}else if(5===t.version){let t=I[e];k.push(th({pubkey:new y.PublicKey(t.id)})),k.push(th({pubkey:new y.PublicKey(t.authority),isWritable:!1})),k.push(th({pubkey:new y.PublicKey(t.marketProgramId)})),k.push(th({pubkey:new y.PublicKey(t.marketAuthority)})),k.push(th({pubkey:nf,isWritable:!1})),k.push(th({pubkey:new y.PublicKey(t.openOrders)})),k.push(th({pubkey:new y.PublicKey(t.vault.A)})),k.push(th({pubkey:new y.PublicKey(t.vault.B)})),k.push(th({pubkey:new y.PublicKey(t.id)})),k.push(th({pubkey:new y.PublicKey(t.id)})),k.push(th({pubkey:new y.PublicKey(t.id)})),k.push(th({pubkey:new y.PublicKey(t.id)})),k.push(th({pubkey:new y.PublicKey(t.id)})),k.push(th({pubkey:new y.PublicKey(t.id)})),k.push(th({pubkey:new y.PublicKey(t.marketId)})),k.push(th({pubkey:new y.PublicKey(t.marketBids)})),k.push(th({pubkey:new y.PublicKey(t.marketAsks)})),k.push(th({pubkey:new y.PublicKey(t.marketEventQueue)})),k.push(th({pubkey:new y.PublicKey(t.marketBaseVault)})),k.push(th({pubkey:new y.PublicKey(t.marketQuoteVault)}))}else if(4===t.version){let n=I[e],i=1!==t.status;k.push(th({pubkey:new y.PublicKey(n.id)})),k.push(th({pubkey:new y.PublicKey(n.authority),isWritable:!1})),k.push(th({pubkey:new y.PublicKey(i?n.id:n.marketProgramId)})),k.push(th({pubkey:new y.PublicKey(i?n.id:n.marketAuthority)})),k.push(th({pubkey:new y.PublicKey(i?n.id:n.openOrders)})),k.push(th({pubkey:new y.PublicKey(n.vault.A)})),k.push(th({pubkey:new y.PublicKey(n.vault.B)})),k.push(th({pubkey:new y.PublicKey(i?n.id:n.marketId)})),k.push(th({pubkey:new y.PublicKey(i?n.id:n.marketBids)})),k.push(th({pubkey:new y.PublicKey(i?n.id:n.marketAsks)})),k.push(th({pubkey:new y.PublicKey(i?n.id:n.marketEventQueue)})),k.push(th({pubkey:new y.PublicKey(i?n.id:n.marketBaseVault)})),k.push(th({pubkey:new y.PublicKey(i?n.id:n.marketQuoteVault)}))}else if(7===t.version){let i=I[e];k.push(th({pubkey:new y.PublicKey(i.authority)})),k.push(th({pubkey:new y.PublicKey(i.config.id)})),k.push(th({pubkey:new y.PublicKey(i.id)})),k.push(th({pubkey:new y.PublicKey(n?i.vault.A:i.vault.B)})),k.push(th({pubkey:new y.PublicKey(n?i.vault.B:i.vault.A)})),k.push(th({pubkey:new y.PublicKey(t.observationId)}))}else throw Error("pool type error")}let T=ii([n0("insId"),n6("amountIn"),n6("amountOut"),io(n2(),w.length,"clmmPriceLimit")]),S=x.alloc(T.span);return T.encode({insId:0,amountIn:m,amountOut:p,clmmPriceLimit:w},S),new y.TransactionInstruction({keys:k,programId:e,data:S})}(e,t.wallet,t.sourceToken,t.routeToken,t.destinationToken,n.toString(),i.middleToken.mint.toString(),i.outputMint.toString(),o,r,s,a,i.amountIn.amount.raw,i.minAmountOut.amount.raw.sub(null!=(l=null==(c=i.minAmountOut.fee)?void 0:c.raw)?l:new f(0)),i.remainingAccounts)],instructionTypes:[tJ.RouteSwap],lookupTableAddress:[s.lookupTableAccount,a.lookupTableAccount].filter(e=>void 0!==e),address:{}}}throw Error("route type error")}({routeProgram:o,inputMint:m,swapInfo:_(W({},e),{poolInfo:[...e.poolInfoList],poolKey:k,outputMint:p}),ownerInfo:{wallet:this.scope.ownerPubKey,sourceToken:g,routeToken:s,destinationToken:w}});if(void 0!==e.feeConfig){let t=this.createTxBuilder();t.addInstruction({instructions:[(0,K.$B)(g,e.feeConfig.feeAccount,this.scope.ownerPubKey,e.feeConfig.feeAmount.toNumber())],instructionTypes:[tJ.TransferAmount]}),t.addInstruction(A);let{transactions:n}=0===r?await t.sizeCheckBuildV0():await t.sizeCheckBuild();n.length<2&&a.addInstruction({instructions:[(0,K.$B)(g,e.feeConfig.feeAccount,this.scope.ownerPubKey,e.feeConfig.feeAmount.toNumber())],instructionTypes:[tJ.TransferAmount]})}return a.addInstruction(A),0===r?a.sizeCheckBuildV0({computeBudgetConfig:i,address:A.address}):a.sizeCheckBuild({computeBudgetConfig:i,address:A.address})}async fetchRoutePoolBasicInfo(e){let{amm:t=ny,clmm:n=nw,cpmm:i=nP}=e||{},o=await this.scope.connection.getProgramAccounts(t,{dataSlice:{offset:ou.offsetOf("baseMint"),length:64}}),r=ii([n3("baseMint"),n3("quoteMint")]),s=o.map(e=>({id:e.pubkey,version:4,mintA:r.decode(e.account.data).baseMint,mintB:r.decode(e.account.data).quoteMint})),a=ii([n3("mintA"),n3("mintB")]);return{clmmPools:(await this.scope.connection.getProgramAccounts(n,{filters:[{dataSize:rl.span}],dataSlice:{offset:rl.offsetOf("mintA"),length:64}})).map(e=>{let t=a.decode(e.account.data);return{id:e.pubkey,version:6,mintA:t.mintA,mintB:t.mintB}}),ammPools:s,cpmmPools:(await this.scope.connection.getProgramAccounts(i,{dataSlice:{offset:r$.offsetOf("mintA"),length:64}})).map(e=>{let t=a.decode(e.account.data);return{id:e.pubkey,version:7,mintA:t.mintA,mintB:t.mintB}})}}getAllRoute({inputMint:e,outputMint:t,clmmPools:n,ammPools:i,cpmmPools:o}){e=e.toString()===y.PublicKey.default.toString()?tS:e,t=t.toString()===y.PublicKey.default.toString()?tS:t;let r={},s={},a={},u=[],c={};for(let i of null!=n?n:[]){if((i.mintA.equals(e)&&i.mintB.equals(t)||i.mintA.equals(t)&&i.mintB.equals(e))&&(u.push(i),s[i.id.toString()]=i),i.mintA.equals(e)){let e=i.mintB.toString();void 0===c[e]&&(c[e]={mintProgram:b.H_,in:[],out:[],mDecimals:0}),c[e].in.push(i)}if(i.mintB.equals(e)){let e=i.mintA.toString();void 0===c[e]&&(c[e]={mintProgram:b.H_,in:[],out:[],mDecimals:0}),c[e].in.push(i)}if(i.mintA.equals(t)){let e=i.mintB.toString();void 0===c[e]&&(c[e]={mintProgram:b.H_,in:[],out:[],mDecimals:0}),c[e].out.push(i)}if(i.mintB.equals(t)){let e=i.mintA.toString();void 0===c[e]&&(c[e]={mintProgram:b.H_,in:[],out:[],mDecimals:0}),c[e].out.push(i)}}let l=[];for(let n of i)(n.mintA.equals(e)&&n.mintB.equals(t)||n.mintA.equals(t)&&n.mintB.equals(e))&&(u.push(n),r[n.id.toBase58()]=n,l.push(n)),n.mintA.equals(e)&&(void 0===c[n.mintB.toBase58()]&&(c[n.mintB.toBase58()]={mintProgram:b.H_,in:[],out:[],mDecimals:0}),c[n.mintB.toBase58()].in.push(n)),n.mintB.equals(e)&&(void 0===c[n.mintA.toBase58()]&&(c[n.mintA.toBase58()]={mintProgram:b.H_,in:[],out:[],mDecimals:0}),c[n.mintA.toBase58()].in.push(n)),n.mintA.equals(t)&&(void 0===c[n.mintB.toBase58()]&&(c[n.mintB.toBase58()]={mintProgram:b.H_,in:[],out:[],mDecimals:0}),c[n.mintB.toBase58()].out.push(n)),n.mintB.equals(t)&&(void 0===c[n.mintA.toBase58()]&&(c[n.mintA.toBase58()]={mintProgram:b.H_,in:[],out:[],mDecimals:0}),c[n.mintA.toBase58()].out.push(n));for(let n of o)(n.mintA.equals(e)&&n.mintB.equals(t)||n.mintA.equals(t)&&n.mintB.equals(e))&&(u.push(n),a[n.id.toBase58()]=n),n.mintA.equals(e)&&(void 0===c[n.mintB.toBase58()]&&(c[n.mintB.toBase58()]={mintProgram:b.H_,in:[],out:[],mDecimals:0}),c[n.mintB.toBase58()].in.push(n)),n.mintB.equals(e)&&(void 0===c[n.mintA.toBase58()]&&(c[n.mintA.toBase58()]={mintProgram:b.H_,in:[],out:[],mDecimals:0}),c[n.mintA.toBase58()].in.push(n)),n.mintA.equals(t)&&(void 0===c[n.mintB.toBase58()]&&(c[n.mintB.toBase58()]={mintProgram:b.H_,in:[],out:[],mDecimals:0}),c[n.mintB.toBase58()].out.push(n)),n.mintB.equals(t)&&(void 0===c[n.mintA.toBase58()]&&(c[n.mintA.toBase58()]={mintProgram:b.H_,in:[],out:[],mDecimals:0}),c[n.mintA.toBase58()].out.push(n));for(let e of Object.keys(c)){if(1===c[e].in.length&&1===c[e].out.length&&c[e].in[0].id.equals(c[e].out[0].id)||0===c[e].in.length||0===c[e].out.length){delete c[e];continue}let t=c[e];for(let e of t.in)for(let n of t.out)6===e.version&&void 0===s[e.id.toString()]?s[e.id.toString()]=e:7===e.version&&void 0===o[e.id.toString()]?a[e.id.toString()]=e:(4===e.version||5===e.version)&&void 0===r[e.id.toString()]&&(r[e.id.toString()]=e),6===n.version&&void 0===s[n.id.toString()]?s[n.id.toString()]=n:7===n.version&&void 0===o[n.id.toString()]?a[n.id.toString()]=n:(4===n.version||5===n.version)&&void 0===r[n.id.toString()]&&(r[n.id.toString()]=n)}return{directPath:u,addLiquidityPools:l,routePathDict:c,needSimulate:Object.values(r),needTickArray:Object.values(s),cpmmPoolList:Object.values(a)}}async fetchSwapRoutesData({routes:e,inputMint:t,outputMint:n}){let i=new Set([...e.needTickArray.map(e=>[e.mintA.toBase58(),e.mintB.toBase58()]).flat(),t.toString(),n.toString()]);console.log("fetching amm pools info, total: ",e.needSimulate.length);let o=await this.scope.liquidity.getRpcPoolInfos(e.needSimulate.map(e=>e.id)),r=rK(o),s={};Object.values(r).forEach(e=>{i.delete(e.mintA.address),s[e.mintA.address]={address:new y.PublicKey(e.mintA.address),programId:b.H_,mintAuthority:null,supply:BigInt(0),decimals:e.mintA.decimals,isInitialized:!0,freezeAuthority:null,tlvData:x.from("0","hex"),feeConfig:void 0},i.delete(e.mintB.address),s[e.mintB.address]={address:new y.PublicKey(e.mintB.address),programId:b.H_,mintAuthority:null,supply:BigInt(0),decimals:e.mintB.decimals,isInitialized:!0,freezeAuthority:null,tlvData:x.from("0","hex"),feeConfig:void 0}}),console.log("fetching cpmm pools info, total: ",e.cpmmPoolList.length);let a=await this.scope.cpmm.getRpcPoolInfos(e.cpmmPoolList.map(e=>e.id.toBase58()),!0);Object.values(a).forEach(e=>{let[t,n]=[e.mintA.toBase58(),e.mintB.toBase58()];e.mintProgramA.equals(b.H_)?(i.delete(t),s[t]={address:e.mintA,programId:e.mintProgramA,mintAuthority:null,supply:BigInt(0),decimals:e.mintDecimalA,isInitialized:!0,freezeAuthority:null,tlvData:x.from("0","hex"),feeConfig:void 0}):i.add(t),e.mintProgramB.equals(b.H_)?(i.delete(n),s[n]={address:e.mintB,programId:e.mintProgramB,mintAuthority:null,supply:BigInt(0),decimals:e.mintDecimalB,isInitialized:!0,freezeAuthority:null,tlvData:x.from("0","hex"),feeConfig:void 0}):i.add(n)}),console.log("fetching mints info, total: ",i.size);let u=await ns({connection:this.scope.connection,mints:Array.from(i).map(e=>new y.PublicKey(e))});s=W(W({},s),u);let c=this.scope.cpmm.toComputePoolInfos({pools:a,mintInfos:s});console.log("fetching clmm pools info, total:",e.needTickArray.length);let l=await this.scope.clmm.getRpcClmmPoolInfos({poolIds:e.needTickArray.map(e=>e.id)}),{computeClmmPoolInfo:d,computePoolTickData:m}=await this.scope.clmm.getComputeClmmPoolInfos({clmmPoolsRpcInfo:l,mintInfos:s}),p=Object.keys(e.routePathDict).reduce((t,n)=>_(W({},t),{[n]:_(W({},e.routePathDict[n]),{mintProgram:s[n].programId,mDecimals:s[n].decimals,in:e.routePathDict[n].in.map(e=>r[e.id.toBase58()]||d[e.id.toBase58()]||c[e.id.toBase58()]),out:e.routePathDict[n].out.map(e=>r[e.id.toBase58()]||d[e.id.toBase58()]||c[e.id.toBase58()])})}),{});return{mintInfos:s,ammPoolsRpcInfo:o,ammSimulateCache:r,clmmPoolsRpcInfo:l,computeClmmPoolInfo:d,computePoolTickData:m,computeCpmmData:c,routePathDict:p}}getAllRouteComputeAmountOut({inputTokenAmount:e,outputToken:t,directPath:n,routePathDict:i,simulateCache:o,tickCache:r,slippage:s,chainTime:a,epochInfo:u,feeConfig:c}){var l,d,m,p,g,h,y,w,b;let k=void 0===c?new f(0):e.raw.mul(new f(c.feeBps.toNumber())).div(new f(1e4)),A=e.raw.sub(k),I=new tZ(e.token,A),P=void 0===c?void 0:{feeAmount:k,feeAccount:c.feeAccount},T=_(W({},t),{address:tv(t.address).toString()}),S=[];for(let e of n)try{S.push(_(W({},this.computeAmountOut({itemPool:e,tickCache:r,simulateCache:o,chainTime:a,epochInfo:u,slippage:s,outputToken:T,amountIn:I})),{feeConfig:P}))}catch(t){this.logDebug("direct error",e.version,e.id.toString(),t.message)}for(let[e,t]of(this.logDebug("direct done"),Object.entries(i))){let n={chainId:101,address:e,programId:t.mintProgram.toBase58(),logoURI:"",symbol:"",name:"",decimals:t.mDecimals,tags:[],extensions:{}},i=t.in.map(e=>{try{return{pool:e,data:this.computeAmountOut({itemPool:e,tickCache:r,simulateCache:o,chainTime:a,epochInfo:u,slippage:s,outputToken:n,amountIn:I})}}catch(t){this.logDebug("route in error",e.version,e.id.toString(),t.message);return}}).sort((e,t)=>{var n,i,o,r;let s=void 0===e?r8:e.data.amountOut.amount.raw.sub(null!=(i=null==(n=e.data.amountOut.fee)?void 0:n.raw)?i:r8),a=void 0===t?r8:t.data.amountOut.amount.raw.sub(null!=(r=null==(o=t.data.amountOut.fee)?void 0:o.raw)?r:r8);return s.lt(a)?1:-1})[0];if(void 0===i)continue;let c=new tZ(on(n),i.data.amountOut.amount.raw.sub(null!=(d=null==(l=i.data.amountOut.fee)?void 0:l.raw)?d:r8));for(let e of t.out)try{let t=this.computeAmountOut({itemPool:e,tickCache:r,simulateCache:o,chainTime:a,epochInfo:u,slippage:s,outputToken:T,amountIn:c});S.push(_(W({},t),{allTrade:!!(i.data.allTrade&&t.allTrade),amountIn:i.data.amountIn,amountOut:t.amountOut,minAmountOut:t.minAmountOut,currentPrice:void 0,executionPrice:new tg(new tW({baseToken:i.data.amountIn.amount.token,denominator:i.data.amountIn.amount.raw,quoteToken:t.amountOut.amount.token,numerator:t.amountOut.amount.raw.sub(null!=(p=null==(m=t.amountOut.fee)?void 0:m.raw)?p:r8)}).toFixed()),priceImpact:new tg(i.data.priceImpact.add(t.priceImpact).toFixed()),fee:[i.data.fee[0],t.fee[0]],routeType:"route",poolInfoList:[i.pool,e],remainingAccounts:[i.data.remainingAccounts[0],t.remainingAccounts[0]],minMiddleAmountFee:null!=(g=t.amountOut.fee)&&g.raw?new tZ(i.data.amountOut.amount.token,(null!=(y=null==(h=i.data.amountOut.fee)?void 0:h.raw)?y:r8).add(null!=(b=null==(w=t.amountOut.fee)?void 0:w.raw)?b:r8)):void 0,middleToken:i.data.amountOut.amount.token,poolReady:i.data.poolReady&&t.poolReady,poolType:[i.data.poolType,t.poolType],feeConfig:P,expirationTime:nv(i.data.expirationTime,t.expirationTime)}))}catch(t){this.logDebug("route out error",e.version,e.id.toString(),t.message)}}return S.filter(e=>e.allTrade).sort((e,t)=>e.amountOut.amount.raw.sub(t.amountOut.amount.raw).gt(r8)?-1:1)}computeAmountOut({itemPool:e,tickCache:t,simulateCache:n,chainTime:i,epochInfo:o,slippage:r,outputToken:s,amountIn:a}){if(6===e.version){let{allTrade:n,realAmountIn:u,amountOut:c,minAmountOut:l,expirationTime:d,currentPrice:m,executionPrice:p,priceImpact:g,fee:h,remainingAccounts:y,executionPriceX64:f}=o2.computeAmountOutFormat({poolInfo:e,tickArrayCache:t[e.id.toString()],amountIn:a.raw,tokenOut:s,slippage:r,epochInfo:o,catchLiquidityInsufficient:!0});return{allTrade:n,amountIn:u,amountOut:c,minAmountOut:l,currentPrice:new tg(m.toFixed()),executionPrice:new tg(p.toFixed()),priceImpact:new tg(g.toFixed()),fee:[h],remainingAccounts:[y],routeType:"amm",poolInfoList:[e],poolReady:e.startTime<i,poolType:"CLMM",slippage:r,clmmExPriceX64:[f],expirationTime:nv(u.expirationTime,d)}}if(7===e.version){let{allTrade:t,executionPrice:n,amountOut:o,minAmountOut:u,priceImpact:c,fee:l}=this.scope.cpmm.computeSwapAmount({pool:e,outputMint:s.address,amountIn:a.raw,slippage:r});return{allTrade:t,amountIn:{amount:a,fee:void 0,expirationTime:void 0},amountOut:{amount:oi(_(W({},s),{amount:o})),fee:void 0,expirationTime:void 0},minAmountOut:{amount:oi(_(W({},s),{amount:u})),fee:void 0,expirationTime:void 0},currentPrice:e.poolPrice,executionPrice:n,priceImpact:c,fee:[new tZ(a.token,l)],remainingAccounts:[],routeType:"amm",poolInfoList:[e],poolReady:e.openTime.toNumber()<i,poolType:"CPMM",slippage:r,clmmExPriceX64:[void 0],expirationTime:void 0}}{if(![1,6,7].includes(n[e.id.toString()].status))throw Error("swap error");let{amountOut:t,minAmountOut:o,currentPrice:u,executionPrice:c,priceImpact:l,fee:d}=this.scope.liquidity.computeAmountOut({poolInfo:n[e.id.toString()],amountIn:a.raw,mintIn:a.token.mint,mintOut:s.address,slippage:r});return{amountIn:{amount:a,fee:void 0,expirationTime:void 0},amountOut:{amount:oi(_(W({},s),{amount:t})),fee:void 0,expirationTime:void 0},minAmountOut:{amount:oi(_(W({},s),{amount:o})),fee:void 0,expirationTime:void 0},currentPrice:u,executionPrice:c,priceImpact:l,fee:[new tZ(a.token,d)],routeType:"amm",poolInfoList:[e],remainingAccounts:[],poolReady:Number(n[e.id].openTime)<i,poolType:5===e.version?"STABLE":void 0,expirationTime:void 0,allTrade:!0,slippage:r,clmmExPriceX64:[void 0]}}}async computePoolToPoolKeys({pools:e,clmmRpcData:t={},ammRpcData:n={}}){let i=new Set(e.filter(e=>6===e.version&&!t[e.id.toString()]).map(e=>e.id.toString()));if(i.size>0){let e=this.scope.clmm.getRpcClmmPoolInfos({poolIds:Array.from(i)});Object.keys(e).forEach(n=>{t[n]=e[n]})}if(new Set(e.filter(e=>4===e.version&&!n[e.id.toString()]).map(e=>e.id.toString())).size>0){let e=this.scope.liquidity.getRpcPoolInfos(Array.from(i));Object.keys(e).forEach(t=>{n[t]=e[t]})}let o=new Set(e.filter(e=>4===e.version).map(e=>e.marketId)),r={};o.size>0&&(await no(this.scope.connection,Array.from(o).map(e=>({pubkey:new y.PublicKey(e)})))).forEach(e=>{if(!e.accountInfo)return;let t=r4.decode(e.accountInfo.data);r[e.pubkey.toBase58()]={marketId:e.pubkey.toString(),marketProgramId:e.accountInfo.owner.toString(),marketAuthority:r5.getAssociatedAuthority({programId:e.accountInfo.owner,marketId:e.pubkey}).publicKey.toString(),marketBaseVault:t.baseVault.toString(),marketQuoteVault:t.quoteVault.toString(),marketBids:t.bids.toString(),marketAsks:t.asks.toString(),marketEventQueue:t.eventQueue.toString()}});let s=[];return e.forEach(e=>{if(6===e.version){let n=t[e.id.toString()],i={programId:e.programId.toBase58(),id:e.id.toBase58(),mintA:e.mintA,mintB:e.mintB,openTime:String(e.startTime),vault:{A:n.vaultA.toBase58(),B:n.vaultB.toBase58()},config:_(W({},e.ammConfig),{id:e.ammConfig.id.toString(),defaultRange:0,defaultRangePoint:[]}),rewardInfos:[]};s.push(i)}else if(4===e.version){let t=n[e.id.toString()],i=W({programId:e.programId,id:e.id,mintA:e.mintA,mintB:e.mintB,openTime:String(e.openTime),vault:{A:t.baseVault.toBase58(),B:t.quoteVault.toBase58()},authority:rS({programId:new y.PublicKey(e.programId)}).publicKey.toString(),openOrders:t.openOrders.toBase58(),targetOrders:t.targetOrders.toBase58(),mintLp:e.lpMint},r[e.marketId]);s.push(i)}else 7===e.version&&s.push({programId:e.programId.toBase58(),id:e.id.toBase58(),mintA:e.mintA,mintB:e.mintB,openTime:String(e.openTime),authority:rX(e.programId).publicKey.toBase58(),vault:{A:e.vaultA.toBase58(),B:e.vaultB.toBase58()},mintLp:oo({address:e.mintLp.toBase58(),programId:b.H_.toBase58(),decimals:e.lpDecimals}),config:_(W({id:e.configId.toBase58()},e.configInfo),{protocolFeeRate:e.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:e.configInfo.tradeFeeRate.toNumber(),fundFeeRate:e.configInfo.fundFeeRate.toNumber(),createPoolFee:e.configInfo.createPoolFee.toString()})})}),s}},r7=class extends nN{static getPdaPoolId(e,t){return t8([r7.SEED_CONFIG.pool.id,t.toBuffer()],e)}static getPdaOwnerId(e,t,n,i){return t8([r7.SEED_CONFIG.owner.id,t.toBuffer(),n.toBuffer(),x.from(new f(i).toArray())],e)}static async getAllInfo({connection:e,programId:t,poolIds:n,wallet:i,chainTime:o}){if(0===n.length)return[];let r=n.map(e=>r7.getPdaPoolId(t,e).publicKey),s=[];for(let e=0;e<r7.VERSION_PROJECT.length;e++)s.push(...r.map(n=>r7.getPdaOwnerId(t,n,i,e).publicKey));let a=await ni(e,[...r,...s]),u=[];for(let e=0;e<a.length;e++){let i=Math.floor(e/n.length),c=e%n.length,l=r[c],d=s[e],m=a[c],p=a[n.length+e];if(!(m&&p)||m.data.length!==r7.POOL_LAYOUT.span||p.data.length!==r7.OWNER_LAYOUT.span)continue;let g=r7.POOL_LAYOUT.decode(m.data),h=r7.OWNER_LAYOUT.decode(p.data),y=g.openTime.toNumber(),w=g.endTime.toNumber(),b=3!==h.tokenInfo.map(e=>e.debtAmount.gt(new f(0))).filter(e=>!e).length,k=o>y&&o<w&&1===g.status,A=b&&k;u.push({programId:t,poolId:l,ammId:g.ammId,ownerAccountId:d,snapshotLpAmount:h.lpAmount,project:r7.VERSION_PROJECT[i],openTime:y,endTime:w,canClaim:A,canClaimErrorType:b?k?void 0:"outOfOperationalTime":"alreadyClaimIt",tokenInfo:g.tokenInfo.map((e,t)=>({mintAddress:e.mintAddress,mintVault:e.mintVault,mintDecimals:e.mintDecimals,perLpLoss:e.perLpLoss,debtAmount:h.tokenInfo[t].debtAmount.add(h.tokenInfo[t].claimedAmount)}))})}return u}async makeClaimTransaction({poolInfo:e,ownerInfo:t}){t.wallet||this.scope.checkOwner();let n=this.createTxBuilder(),i=t.wallet||this.scope.ownerPubKey,o=[];for(let r of e.tokenInfo){let{account:e,instructionParams:s}=await this.scope.account.getOrCreateTokenAccount({mint:r.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:r.mintAddress.equals(tx.WSOL.mint),createInfo:{payer:i,amount:0},skipCloseAccount:!r.mintAddress.equals(tx.WSOL.mint),associatedOnly:!r.mintAddress.equals(tx.WSOL.mint)&&t.associatedOnly});s&&n.addInstruction(s),o.push(e)}n.addInstruction({instructions:[r7.makeClaimInstruction({programId:e.programId,poolInfo:e,ownerInfo:{wallet:i,ownerPda:e.ownerAccountId,claimAddress:o}})]});let{transaction:r,signers:s}=n.build();return[{transaction:r,signer:s}]}async makeClaimAllTransaction({poolInfos:e,ownerInfo:t}){let n=this.createTxBuilder(),i=t.wallet||this.scope.ownerPubKey,o={};for(let r of e){let e=[];for(let s of r.tokenInfo){let{account:r,instructionParams:a}=await this.scope.account.getOrCreateTokenAccount({mint:s.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:s.mintAddress.equals(tx.WSOL.mint),createInfo:{payer:i,amount:0},skipCloseAccount:!s.mintAddress.equals(tx.WSOL.mint),associatedOnly:!s.mintAddress.equals(tx.WSOL.mint)&&t.associatedOnly});a&&n.addInstruction(a),r&&(o[s.mintAddress.toString()]=r,e.push(r))}n.addInstruction({instructions:[r7.makeClaimInstruction({programId:r.programId,poolInfo:r,ownerInfo:{wallet:i,ownerPda:r.ownerAccountId,claimAddress:e}})]})}let{transaction:r,signers:s}=n.build(),a=n.allInstructions;return t6(a,[i,...s.map(e=>e.publicKey)])?[{transaction:r,signer:s}]:[{transaction:new y.Transaction().add(...a.slice(0,n.AllTxData.instructions.length-1)),signer:s},{transaction:new y.Transaction().add(...a.slice(n.AllTxData.instructions.length-1)),signer:[]},{transaction:new y.Transaction().add(...n.AllTxData.endInstructions),signer:[]}]}static makeClaimInstruction({programId:e,poolInfo:t,ownerInfo:n}){let i=ii([]),o=[{pubkey:n.wallet,isSigner:!0,isWritable:!0},{pubkey:t.poolId,isSigner:!1,isWritable:!0},{pubkey:n.ownerPda,isSigner:!1,isWritable:!0},...n.claimAddress.map(e=>({pubkey:e,isSigner:!1,isWritable:!0})),...t.tokenInfo.map(({mintVault:e})=>({pubkey:e,isSigner:!1,isWritable:!0})),{pubkey:b.H_,isSigner:!1,isWritable:!1}],r=x.alloc(i.span);i.encode({},r);let s=x.from([10,66,208,184,161,6,191,98,...r]);return new y.TransactionInstruction({keys:o,programId:e,data:s})}};r7.CLAIMED_NUM=3,r7.POOL_LAYOUT=ii([nY(8),n0("bump"),n0("status"),n6("openTime"),n6("endTime"),n3("ammId"),io(ii([n0("mintDecimals"),n3("mintAddress"),n3("mintVault"),n6("perLpLoss"),n6("totalClaimedAmount")]),r7.CLAIMED_NUM,"tokenInfo"),io(n6(),10,"padding")]),r7.OWNER_LAYOUT=ii([nY(8),n0("bump"),n0("version"),n3("poolId"),n3("owner"),n6("lpAmount"),io(ii([n3("mintAddress"),n6("debtAmount"),n6("claimedAmount")]),r7.CLAIMED_NUM,"tokenInfo"),io(n6(),4,"padding")]),r7.DEFAULT_POOL_ID=["58oQChx4yWmvKdwLLZzBi4ChoCc2fqCUWBkwMihLYQo2","6UmmUiYoBjSrhakAobJw8BvkmJtDVxaeBtbt7rxWo1mg","AVs9TA4nWDzfPJE9gGVNJMVhcQy3V9PGazuz33BfG2RA","DVa7Qmb5ct9RCpaU7UTpSaf3GVMYz17vNVU67XpdCRut","7XawhbbxtsRcQA8KTkHT9f9nc6d69UwqCDh6U5EEbEmX","6a1CsrpeZubDjEJE9s1CMVheB6HWM5d7m1cj2jkhyXhj","EoNrn8iUhwgJySD1pHu8Qxm5gSQqLK3za4m8xzD2RuEb","AceAyRTWt4PyB2pHqf2qhDgNZDtKVNaxgL8Ru3V4aN1P","6tmFJbMk5yVHFcFy7X2K8RwHjKLr6KVFLYXpgpBNeAxB"].map(e=>new y.PublicKey(e)),r7.SEED_CONFIG={pool:{id:x.from("pool_seed","utf8")},owner:{id:x.from("user_claim_seed","utf8")}},r7.VERSION_PROJECT=[void 0,"Francium","Tulip","Larix"];var r9=ii([nY(5),function(e="accountFlags"){let t=new n1(e);return t.addBoolean("initialized"),t.addBoolean("market"),t.addBoolean("openOrders"),t.addBoolean("requestQueue"),t.addBoolean("eventQueue"),t.addBoolean("bids"),t.addBoolean("asks"),t}("accountFlags"),n3("ownAddress"),n6("vaultSignerNonce"),n3("baseMint"),n3("quoteMint"),n3("baseVault"),n6("baseDepositsTotal"),n6("baseFeesAccrued"),n3("quoteVault"),n6("quoteDepositsTotal"),n6("quoteFeesAccrued"),n6("quoteDustThreshold"),n3("requestQueue"),n3("eventQueue"),n3("bids"),n3("asks"),n6("baseLotSize"),n6("quoteLotSize"),n6("feeRateBps"),n6("referrerRebatesAccrued"),nY(7)]);async function se({connection:e,wallet:t,marketInfo:n}){let i=new y.Transaction,o=await e.getMinimumBalanceForRentExemption(165);i.add(y.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:n.baseVault.seed,newAccountPubkey:n.baseVault.publicKey,lamports:o,space:165,programId:b.H_}),y.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:n.quoteVault.seed,newAccountPubkey:n.quoteVault.publicKey,lamports:o,space:165,programId:b.H_}),(0,B.FJ)(n.baseVault.publicKey,n.baseMint,n.vaultOwner),(0,B.FJ)(n.quoteVault.publicKey,n.quoteMint,n.vaultOwner));let r=new y.Transaction;return r.add(y.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:n.id.seed,newAccountPubkey:n.id.publicKey,lamports:await e.getMinimumBalanceForRentExemption(r9.span),space:r9.span,programId:n.programId}),y.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:n.requestQueue.seed,newAccountPubkey:n.requestQueue.publicKey,lamports:await e.getMinimumBalanceForRentExemption(5132),space:5132,programId:n.programId}),y.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:n.eventQueue.seed,newAccountPubkey:n.eventQueue.publicKey,lamports:await e.getMinimumBalanceForRentExemption(262156),space:262156,programId:n.programId}),y.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:n.bids.seed,newAccountPubkey:n.bids.publicKey,lamports:await e.getMinimumBalanceForRentExemption(65548),space:65548,programId:n.programId}),y.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:n.asks.seed,newAccountPubkey:n.asks.publicKey,lamports:await e.getMinimumBalanceForRentExemption(65548),space:65548,programId:n.programId}),function({programId:e,marketInfo:t}){let n=ii([n0("version"),n4("instruction"),n6("baseLotSize"),n6("quoteLotSize"),nG("feeRateBps"),n6("vaultSignerNonce"),n6("quoteDustThreshold")]),i=[{pubkey:t.id,isSigner:!1,isWritable:!0},{pubkey:t.requestQueue,isSigner:!1,isWritable:!0},{pubkey:t.eventQueue,isSigner:!1,isWritable:!0},{pubkey:t.bids,isSigner:!1,isWritable:!0},{pubkey:t.asks,isSigner:!1,isWritable:!0},{pubkey:t.baseVault,isSigner:!1,isWritable:!0},{pubkey:t.quoteVault,isSigner:!1,isWritable:!0},{pubkey:t.baseMint,isSigner:!1,isWritable:!1},{pubkey:t.quoteMint,isSigner:!1,isWritable:!1},{pubkey:t.authority?t.quoteMint:y.SYSVAR_RENT_PUBKEY,isSigner:!1,isWritable:!1}].concat(t.authority?{pubkey:t.authority,isSigner:!1,isWritable:!1}:[]).concat(t.authority&&t.pruneAuthority?{pubkey:t.pruneAuthority,isSigner:!1,isWritable:!1}:[]),o=x.alloc(n.span);return n.encode({version:0,instruction:0,baseLotSize:t.baseLotSize,quoteLotSize:t.quoteLotSize,feeRateBps:t.feeRateBps,vaultSignerNonce:t.vaultSignerNonce,quoteDustThreshold:t.quoteDustThreshold},o),new y.TransactionInstruction({keys:i,programId:e,data:o})}({programId:n.programId,marketInfo:{id:n.id.publicKey,requestQueue:n.requestQueue.publicKey,eventQueue:n.eventQueue.publicKey,bids:n.bids.publicKey,asks:n.asks.publicKey,baseVault:n.baseVault.publicKey,quoteVault:n.quoteVault.publicKey,baseMint:n.baseMint,quoteMint:n.quoteMint,baseLotSize:n.baseLotSize,quoteLotSize:n.quoteLotSize,feeRateBps:n.feeRateBps,vaultSignerNonce:n.vaultSignerNonce,quoteDustThreshold:n.quoteDustThreshold}})),[{transaction:i,signer:[],instructionTypes:[tJ.CreateAccount,tJ.CreateAccount,tJ.InitAccount,tJ.InitAccount]},{transaction:r,signer:[],instructionTypes:[tJ.CreateAccount,tJ.CreateAccount,tJ.CreateAccount,tJ.CreateAccount,tJ.CreateAccount,tJ.InitMarket]}]}var st=class extends nN{async create({baseInfo:e,quoteInfo:t,lotSize:n,tickSize:i,dexProgramId:o,txVersion:r,computeBudgetConfig:s}){let a=this.scope.ownerPubKey,u=iA({fromPublicKey:a,programId:o}),c=iA({fromPublicKey:a,programId:o}),l=iA({fromPublicKey:a,programId:o}),d=iA({fromPublicKey:a,programId:o}),m=iA({fromPublicKey:a,programId:o}),p=iA({fromPublicKey:a,programId:b.H_}),g=iA({fromPublicKey:a,programId:b.H_}),h=new f(100),{vaultOwner:w,vaultSignerNonce:k}=function(){let e=new f(0);for(;;)try{return{vaultOwner:y.PublicKey.createProgramAddressSync([u.publicKey.toBuffer(),e.toArrayLike(x,"le",8)],o),vaultSignerNonce:e}}catch{if(e.iaddn(1),e.gt(new f(25555)))throw Error("find vault owner error")}}(),A=new f(Math.round(10**e.decimals*n)),I=new f(Math.round(n*10**t.decimals*i));if(A.eq(tU))throw Error("lot size is too small");if(I.eq(tU))throw Error("tick size or lot size is too small");let P=await se({connection:this.scope.connection,wallet:this.scope.ownerPubKey,marketInfo:{programId:o,id:u,baseMint:e.mint,quoteMint:t.mint,baseVault:p,quoteVault:g,vaultOwner:w,requestQueue:c,eventQueue:l,bids:d,asks:m,feeRateBps:0,quoteDustThreshold:h,vaultSignerNonce:k,baseLotSize:A,quoteLotSize:I}}),T=this.createTxBuilder();for await(let e of(T.addInstruction({instructions:P[0].transaction.instructions,signers:P[0].signer}),P.slice(1,P.length)))T.addInstruction({instructions:e.transaction.instructions,signers:e.signer,instructionTypes:e.instructionTypes});return 0===r?T.sizeCheckBuildV0({computeBudgetConfig:s,address:{marketId:u.publicKey,requestQueue:c.publicKey,eventQueue:l.publicKey,bids:d.publicKey,asks:m.publicKey,baseVault:p.publicKey,quoteVault:g.publicKey,baseMint:new y.PublicKey(e.mint),quoteMin:new y.PublicKey(t.mint)}}):T.sizeCheckBuild({computeBudgetConfig:s,address:{marketId:u.publicKey,requestQueue:c.publicKey,eventQueue:l.publicKey,bids:d.publicKey,asks:m.publicKey,baseVault:p.publicKey,quoteVault:g.publicKey,baseMint:new y.PublicKey(e.mint),quoteMin:new y.PublicKey(t.mint)}})}};ii([n0("instruction"),nj("amount")]);var sn=ii([n0("instruction")]);function si({programId:e},t){let n=[{pubkey:b.H_,isSigner:!1,isWritable:!1},{pubkey:tI,isSigner:!1,isWritable:!1},...Object.entries(t).map(([e,t])=>({pubkey:t,isSigner:"userOwner"===e,isWritable:!["authority","userOwner"].includes(e)}))],i=x.alloc(sn.span);return sn.encode({instruction:2},i),new y.TransactionInstruction({keys:n,programId:e,data:i})}function so(e){let{poolConfig:t,userKeys:n,side:i}=e,o="base"===i?n.baseTokenAccount:n.quoteTokenAccount,r="base"===i?t.baseVault:t.quoteVault,s=x.alloc(sn.span);sn.encode({instruction:2},s);let a=[{pubkey:b.H_,isWritable:!1,isSigner:!1},{pubkey:y.SYSVAR_CLOCK_PUBKEY,isWritable:!1,isSigner:!1},{pubkey:t.id,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!1},{pubkey:r,isWritable:!0,isSigner:!1},{pubkey:o,isWritable:!0,isSigner:!1},{pubkey:n.ledgerAccount,isWritable:!0,isSigner:!1},{pubkey:n.owner,isWritable:!1,isSigner:!0}];return new y.TransactionInstruction({programId:t.programId,keys:a,data:s})}var sr={[nT.IDO_PROGRAM_ID_V1.toString()]:1,[nT.IDO_PROGRAM_ID_V2.toString()]:2,[nT.IDO_PROGRAM_ID_V3.toString()]:3,[nT.IDO_PROGRAM_ID_V4.toString()]:4},ss=class extends nN{async claim({ownerInfo:e,idoKeys:t,associatedOnly:n=!0,checkCreateATAOwner:i=!1,txVersion:o}){let r=this.createTxBuilder(),s=sr[t.programId];s||this.logAndCreateError("invalid version",s);let a=tY(t),[u,c]=[!new f(e.coin).isZero(),!new f(e.pc).isZero()],l=a.projectInfo.mint.address.equals(tS),{account:d,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:a.projectInfo.mint.programId,mint:a.projectInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!l,notUseTokenAccount:l,associatedOnly:!l&&n,checkCreateATAOwner:i});!d&&u&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),u&&m&&r.addInstruction(m);let p=a.buyInfo.mint.address.equals(tS),{account:g,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:a.buyInfo.mint.programId,mint:a.buyInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!p,notUseTokenAccount:p,associatedOnly:!p&&n,checkCreateATAOwner:i});if(!d&&c&&this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address),c&&h&&r.addInstruction(h),d&&g||this.logAndCreateError("target token accounts not found","mint",t.projectInfo.mint.address,t.buyInfo.mint.address),3===s)return r.addInstruction({instructions:[...u?[si({programId:a.programId},{idoId:a.id,authority:a.authority,poolTokenAccount:a.projectInfo.vault,userTokenAccount:d,userIdoInfo:new y.PublicKey(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[],...c?[si({programId:new y.PublicKey(t.programId)},{idoId:a.id,authority:a.authority,poolTokenAccount:a.buyInfo.vault,userTokenAccount:g,userIdoInfo:new y.PublicKey(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[]]}).versionBuild({txVersion:o});if(s<3)return u||c||this.logAndCreateError("no claimable rewards"),r.addInstruction({instructions:[si({programId:a.programId},{idoId:a.id,authority:a.authority,poolQuoteTokenAccount:a.buyInfo.vault,poolBaseTokenAccount:a.projectInfo.vault,userQuoteTokenAccount:g,userBaseTokenAccount:d,userIdoInfo:new y.PublicKey(e.userIdoInfo),userOwner:this.scope.ownerPubKey})]}).versionBuild({txVersion:o});let w={poolConfig:{id:a.id,programId:a.programId,authority:a.authority,baseVault:a.projectInfo.vault,quoteVault:a.buyInfo.vault,baseToken:t.projectInfo.mint,quoteToken:t.buyInfo.mint},userKeys:{baseTokenAccount:d,quoteTokenAccount:g,ledgerAccount:new y.PublicKey(e.userIdoInfo),owner:this.scope.ownerPubKey}};return r.addInstruction({instructions:[...u?[so(_(W({},w),{side:"base"}))]:[],...c?[so(_(W({},w),{side:"quote"}))]:[]]}).versionBuild({txVersion:o})}},sa=class extends nN{constructor(e){super(e),this._tokenList=[],this._tokenMap=new Map,this._blackTokenMap=new Map,this._mintGroup={official:new Set,jup:new Set,extra:new Set},this._whiteMap=new Set,this._extraTokenList=[]}async load(e){this.checkDisabled();let{forceUpdate:t=!1,type:n="strict"}=e||{},{mintList:i,blacklist:o,whiteList:r}=await this.scope.fetchV3TokenList(t),s=await this.scope.fetchJupTokenList(n,t);this._tokenList=[],this._tokenMap=new Map,this._blackTokenMap=new Map,this._mintGroup={official:new Set,jup:new Set,extra:new Set},this._whiteMap=new Set(r),this._tokenMap.set(tK.address,tK),this._mintGroup.official.add(tK.address),o.forEach(e=>{this._blackTokenMap.set(e.address,_(W({},e),{priority:-1}))}),i.forEach(e=>{var t;this._blackTokenMap.has(e.address)||(this._tokenMap.set(e.address,_(W({},e),{type:"raydium",priority:2,programId:null!=(t=e.programId)?t:e.tags.includes("token-2022")?b.nA.toBase58():b.H_.toBase58()})),this._mintGroup.official.add(e.address))}),s.forEach(e=>{var t;this._blackTokenMap.has(e.address)||this._tokenMap.has(e.address)||(this._tokenMap.set(e.address,_(W({},e),{type:"jupiter",priority:1,programId:null!=(t=e.programId)?t:e.tags.includes("token-2022")?b.nA.toBase58():b.H_.toBase58()})),this._mintGroup.jup.add(e.address))}),this._extraTokenList.forEach(e=>{this._blackTokenMap.has(e.address)||this._tokenMap.has(e.address)||(this._tokenMap.set(e.address,_(W({},e),{type:"extra",priority:1,programId:e.programId||e.tags.includes("token-2022")?b.nA.toBase58():b.H_.toBase58()})),this._mintGroup.extra.add(e.address))}),this._tokenList=Array.from(this._tokenMap).map(e=>e[1])}get tokenList(){return this._tokenList}get tokenMap(){return this._tokenMap}get blackTokenMap(){return this._blackTokenMap}get mintGroup(){return this._mintGroup}get whiteListMap(){return this._whiteMap}async getTokenInfo(e){if(!e)throw Error("please input mint");let t=e.toString(),n=this._tokenMap.get(t);if(n)return n;if("SOL"===t.toLocaleUpperCase())return tK;let i=(await this.scope.api.getTokenInfo([t]))[0];if(i)return this._mintGroup.extra.add(t),this._tokenMap.set(t,_(W({},i),{priority:2})),i;let o=await this.scope.connection.getAccountInfo(new y.PublicKey(t));if(!o)throw Error(`mint address not found: ${t}`);let r=I.qT.decode(o.data),s=t.toString().substring(0,6),a={chainId:101,address:t,programId:o.owner.toBase58(),logoURI:"",symbol:s,name:s,decimals:r.decimals,tags:[],extensions:{},priority:0,type:"unknown"};return this._mintGroup.extra.add(t),this._tokenMap.set(t,a),a}},su=class{constructor(e){this.rawBalances=new Map;let{connection:t,cluster:n,owner:i,api:o,defaultChainTime:r,defaultChainTimeOffset:s,apiCacheTime:a,blockhashCommitment:u="confirmed"}=e;this._connection=t,this.cluster=n||"mainnet",this._owner=i?new nl(i):void 0,this._signAllTransactions=e.signAllTransactions,this.blockhashCommitment=u,this.api=o,this._apiCacheTime=a||3e5,this.logger=H("Raydium"),this.farm=new ot({scope:this,moduleName:"Raydium_Farm"}),this.account=new iB({scope:this,moduleName:"Raydium_Account",tokenAccounts:e.tokenAccounts,tokenAccountRawInfos:e.tokenAccountRawInfos}),this.liquidity=new rC({scope:this,moduleName:"Raydium_LiquidityV2"}),this.token=new sa({scope:this,moduleName:"Raydium_tokenV2"}),this.tradeV2=new r3({scope:this,moduleName:"Raydium_tradeV2"}),this.clmm=new rx({scope:this,moduleName:"Raydium_clmm"}),this.cpmm=new rJ({scope:this,moduleName:"Raydium_cpmm"}),this.utils1216=new r7({scope:this,moduleName:"Raydium_utils1216"}),this.marketV2=new st({scope:this,moduleName:"Raydium_marketV2"}),this.ido=new ss({scope:this,moduleName:"Raydium_ido"}),this.availability={};let c=new Date().getTime();this.apiData={},s&&(this._chainTime={fetched:c,value:{chainTime:r||Date.now()-s,offset:s}})}static async load(e){var t;let n=(0,h.merge)({cluster:"mainnet",owner:null,apiRequestInterval:3e5,apiRequestTimeout:1e4},e),{cluster:i,apiRequestTimeout:o,logCount:r,logRequests:s,urlConfigs:a}=n,u=new nW({cluster:i,timeout:o,urlConfigs:a,logCount:r,logRequests:s}),c=new su(_(W({},n),{api:u}));return await c.fetchAvailabilityStatus(null==(t=e.disableFeatureCheck)||t),e.disableLoadToken||await c.token.load({type:e.jupTokenType}),c}get owner(){return this._owner}get ownerPubKey(){if(!this._owner)throw Error(n_);return this._owner.publicKey}setOwner(e){return this._owner=e?new nl(e):void 0,this}get connection(){if(!this._connection)throw Error("please provide connection in load() initialization or set it by raydium.setConnection(connection)");return this._connection}setConnection(e){return this._connection=e,this}get signAllTransactions(){return this._signAllTransactions}setSignAllTransactions(e){return this._signAllTransactions=e,this}checkOwner(){if(!this.owner)throw this.logger.error(n_),Error(n_)}isCacheInvalidate(e){return new Date().getTime()-e>this._apiCacheTime}async fetchChainTime(){try{let e=await this.api.getChainTimeOffset();this._chainTime={fetched:Date.now(),value:{chainTime:Date.now()+1e3*e.offset,offset:1e3*e.offset}}}catch{this._chainTime=void 0}}async fetchV3TokenList(e){if(this.apiData.tokenList&&!this.isCacheInvalidate(this.apiData.tokenList.fetched)&&!e)return this.apiData.tokenList.data;try{let e=await this.api.getTokenList(),t={fetched:Date.now(),data:e};return this.apiData.tokenList=t,t.data}catch(e){return console.error(e),{mintList:[],blacklist:[],whiteList:[]}}}async fetchJupTokenList(e,t){var n;let i=null==(n=this.apiData.jupTokenList)?void 0:n[e];if(i&&!this.isCacheInvalidate(i.fetched)&&!t)return i.data;try{let t=await this.api.getJupTokenList(e);return this.apiData.jupTokenList=_(W({},this.apiData.jupTokenList),{[e]:{fetched:Date.now(),data:t}}),this.apiData.jupTokenList[e].data}catch(e){return console.error(e),[]}}get chainTimeData(){var e;return null==(e=this._chainTime)?void 0:e.value}async chainTimeOffset(){var e;return this._chainTime&&Date.now()-this._chainTime.fetched<=3e5?this._chainTime.value.offset:(await this.fetchChainTime(),(null==(e=this._chainTime)?void 0:e.value.offset)||0)}async currentBlockChainTime(){var e;return this._chainTime&&Date.now()-this._chainTime.fetched<=3e5?this._chainTime.value.chainTime:(await this.fetchChainTime(),(null==(e=this._chainTime)?void 0:e.value.chainTime)||Date.now())}async fetchEpochInfo(){return this._epochInfo&&Date.now()-this._epochInfo.fetched<=3e4||(this._epochInfo={fetched:Date.now(),value:await this.connection.getEpochInfo()}),this._epochInfo.value}async fetchAvailabilityStatus(e){if(e)return{};try{let e=await this.api.fetchAvailabilityStatus(),t=!1===e.all;return this.availability={all:e.all,swap:!t&&e.swap,createConcentratedPosition:!t&&e.createConcentratedPosition,addConcentratedPosition:!t&&e.addConcentratedPosition,addStandardPosition:!t&&e.addStandardPosition,removeConcentratedPosition:!t&&e.removeConcentratedPosition,removeStandardPosition:!t&&e.removeStandardPosition,addFarm:!t&&e.addFarm,removeFarm:!t&&e.removeFarm},e}catch{return{}}}};/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */}}]);