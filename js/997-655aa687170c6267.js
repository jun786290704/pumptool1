(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[997],{66793:function(){},93671:function(e,t,n){"use strict";n.d(t,{f:function(){return T}});var i=n(64170),a=n(43203),s=n(37355),r=n(35634);class o{getInitialBuyPrice(e){if(e<=0n)return 0n;let t=this.initialVirtualSolReserves*this.initialVirtualTokenReserves,n=this.initialVirtualSolReserves+e,i=this.initialVirtualTokenReserves-(t/n+1n);return i<this.initialRealTokenReserves?i:this.initialRealTokenReserves}static fromBuffer(e){let t=(0,r.struct)([(0,r.u64)("discriminator"),(0,r.bool)("initialized"),(0,r.publicKey)("authority"),(0,r.publicKey)("feeRecipient"),(0,r.u64)("initialVirtualTokenReserves"),(0,r.u64)("initialVirtualSolReserves"),(0,r.u64)("initialRealTokenReserves"),(0,r.u64)("tokenTotalSupply"),(0,r.u64)("feeBasisPoints")]).decode(e);return new o(BigInt(t.discriminator),t.initialized,t.authority,t.feeRecipient,BigInt(t.initialVirtualTokenReserves),BigInt(t.initialVirtualSolReserves),BigInt(t.initialRealTokenReserves),BigInt(t.tokenTotalSupply),BigInt(t.feeBasisPoints))}constructor(e,t,n,i,a,s,r,o,l){this.initialized=!1,this.discriminator=e,this.initialized=t,this.authority=n,this.feeRecipient=i,this.initialVirtualTokenReserves=a,this.initialVirtualSolReserves=s,this.initialRealTokenReserves=r,this.tokenTotalSupply=o,this.feeBasisPoints=l}}var l=n(59327),u=n(42819),c=n(9309);class m{getBuyPrice(e){if(this.complete)throw Error("Curve is complete");if(e<=0n)return 0n;let t=this.virtualSolReserves*this.virtualTokenReserves,n=this.virtualSolReserves+e,i=this.virtualTokenReserves-(t/n+1n);return i<this.realTokenReserves?i:this.realTokenReserves}getSellPrice(e,t){if(this.complete)throw Error("Curve is complete");if(e<=0n)return 0n;let n=e*this.virtualSolReserves/(this.virtualTokenReserves+e);return n-n*t/10000n}getMarketCapSOL(){return 0n===this.virtualTokenReserves?0n:this.tokenTotalSupply*this.virtualSolReserves/this.virtualTokenReserves}getFinalMarketCapSOL(e){let t=this.getBuyOutPrice(this.realTokenReserves,e),n=this.virtualSolReserves+t,i=this.virtualTokenReserves-this.realTokenReserves;return 0n===i?0n:this.tokenTotalSupply*n/i}getBuyOutPrice(e,t){let n=e<this.realSolReserves?this.realSolReserves:e,i=n*this.virtualSolReserves/(this.virtualTokenReserves-n)+1n;return i+i*t/10000n}static fromBuffer(e){let t=(0,r.struct)([(0,r.u64)("discriminator"),(0,r.u64)("virtualTokenReserves"),(0,r.u64)("virtualSolReserves"),(0,r.u64)("realTokenReserves"),(0,r.u64)("realSolReserves"),(0,r.u64)("tokenTotalSupply"),(0,r.bool)("complete")]).decode(e);return new m(BigInt(t.discriminator),BigInt(t.virtualTokenReserves),BigInt(t.virtualSolReserves),BigInt(t.realTokenReserves),BigInt(t.realSolReserves),BigInt(t.tokenTotalSupply),t.complete)}constructor(e,t,n,i,a,s,r){this.discriminator=e,this.virtualTokenReserves=t,this.virtualSolReserves=n,this.realTokenReserves=i,this.realSolReserves=a,this.tokenTotalSupply=s,this.complete=r}}var d=n(34108);let g="finalized",v="finalized",p=(e,t)=>e+e*t/10000n,y=(e,t)=>e-e*t/10000n;async function h(e,t,n,i,a){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:g,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:v,l=new s.Transaction;if(a){let e=s.ComputeBudgetProgram.setComputeUnitLimit({units:a.unitLimit}),t=s.ComputeBudgetProgram.setComputeUnitPrice({microLamports:a.unitPrice});l.add(e),l.add(t)}l.add(t);let u=await b(e,n,l,r);u.sign(i);try{let t=await e.sendTransaction(u,{skipPreflight:!1});console.log("sig:","https://solscan.io/tx/".concat(t));let n=await f(e,t,r,o);if(!n)return{success:!1,error:"Transaction failed"};return{success:!0,signature:t,results:n}}catch(t){return t instanceof s.SendTransactionError?console.log(await t.getLogs(e)):console.error(t),{error:t,success:!1}}}let b=async function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g,a=(await e.getLatestBlockhash(i)).blockhash,r=new s.TransactionMessage({payerKey:t,recentBlockhash:a,instructions:n.instructions}).compileToV0Message();return new s.VersionedTransaction(r)},f=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v,a=await e.getLatestBlockhash();return await e.confirmTransaction({blockhash:a.blockhash,lastValidBlockHeight:a.lastValidBlockHeight,signature:t},n),e.getTransaction(t,{maxSupportedTransactionVersion:0,commitment:i})};var k=JSON.parse('{"address":"6EF8rrecthR5Dkzon8Nwu78hRvfCKubJ14M5uBEwF6P","metadata":{"name":"pump","version":"0.1.0","spec":"0.1.0"},"instructions":[{"name":"initialize","discriminator":[175,175,109,31,13,152,155,237],"docs":["Creates the global state."],"accounts":[{"name":"global","writable":true,"pda":{"seeds":[{"kind":"const","value":[103,108,111,98,97,108]}]}},{"name":"user","writable":true,"signer":true},{"name":"system_program","address":"11111111111111111111111111111111"}],"args":[]},{"name":"setParams","discriminator":[165,31,134,53,189,180,130,255],"docs":["Sets the global state parameters."],"accounts":[{"name":"global","writable":true,"pda":{"seeds":[{"kind":"const","value":[103,108,111,98,97,108]}]}},{"name":"user","writable":true,"signer":true},{"name":"system_program","address":"11111111111111111111111111111111"},{"name":"event_authority","address":"Ce6TQqeHC9p8KetsN6JsjHK7UTZk7nasjjnr7XxXp9F1"},{"name":"program","address":"6EF8rrecthR5Dkzon8Nwu78hRvfCKubJ14M5uBEwF6P"}],"args":[{"name":"feeRecipient","type":"pubkey"},{"name":"initialVirtualTokenReserves","type":"u64"},{"name":"initialVirtualSolReserves","type":"u64"},{"name":"initialRealTokenReserves","type":"u64"},{"name":"tokenTotalSupply","type":"u64"},{"name":"feeBasisPoints","type":"u64"}]},{"name":"create","discriminator":[24,30,200,40,5,28,7,119],"docs":["Creates a new coin and bonding curve."],"accounts":[{"name":"mint","writable":true,"signer":true},{"name":"mint_authority","pda":{"seeds":[{"kind":"const","value":[109,105,110,116,45,97,117,116,104,111,114,105,116,121]}]}},{"name":"bonding_curve","writable":true,"pda":{"seeds":[{"kind":"const","value":[98,111,110,100,105,110,103,45,99,117,114,118,101]},{"kind":"account","path":"mint"}]}},{"name":"associated_bonding_curve","writable":true,"signer":false},{"name":"global","writable":false,"pda":{"seeds":[{"kind":"const","value":[103,108,111,98,97,108]}]}},{"name":"mpl_token_metadata","address":"metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"},{"name":"metadata","writable":true,"signer":false},{"name":"user","isMut":true,"isSigner":true},{"name":"system_program","address":"11111111111111111111111111111111"},{"name":"token_program","address":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"},{"name":"associated_token_program","address":"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"},{"name":"rent","address":"SysvarRent111111111111111111111111111111111"},{"name":"event_authority","address":"Ce6TQqeHC9p8KetsN6JsjHK7UTZk7nasjjnr7XxXp9F1"},{"name":"program","address":"6EF8rrecthR5Dkzon8Nwu78hRvfCKubJ14M5uBEwF6P"}],"args":[{"name":"name","type":"string"},{"name":"symbol","type":"string"},{"name":"uri","type":"string"}]},{"name":"buy","discriminator":[102,6,61,18,1,218,235,234],"docs":["Buys tokens from a bonding curve."],"accounts":[{"name":"global","pda":{"seeds":[{"kind":"const","value":[103,108,111,98,97,108]}]}},{"name":"fee_recipient","writable":true,"signer":false},{"name":"mint","writable":false,"signer":false},{"name":"bonding_curve","writable":true,"pda":{"seeds":[{"kind":"const","value":[98,111,110,100,105,110,103,45,99,117,114,118,101]},{"kind":"account","path":"mint"}]}},{"name":"associated_bonding_curve","writable":true,"signer":false},{"name":"associated_user","writable":true,"signer":false},{"name":"user","writable":true,"signer":true},{"name":"system_program","address":"11111111111111111111111111111111"},{"name":"token_program","address":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"},{"name":"rent","address":"SysvarRent111111111111111111111111111111111"},{"name":"event_authority","address":"Ce6TQqeHC9p8KetsN6JsjHK7UTZk7nasjjnr7XxXp9F1"},{"name":"program","address":"6EF8rrecthR5Dkzon8Nwu78hRvfCKubJ14M5uBEwF6P"}],"args":[{"name":"amount","type":"u64"},{"name":"maxSolCost","type":"u64"}]},{"name":"sell","discriminator":[51,230,133,164,1,127,131,173],"docs":["Sells tokens into a bonding curve."],"accounts":[{"name":"global","writable":false,"pda":{"seeds":[{"kind":"const","value":[103,108,111,98,97,108]}]}},{"name":"feeRecipient","writable":true,"signer":false},{"name":"mint","writable":false,"signer":false},{"name":"bonding_curve","writable":true,"pda":{"seeds":[{"kind":"const","value":[98,111,110,100,105,110,103,45,99,117,114,118,101]},{"kind":"account","path":"mint"}]}},{"name":"associatedBondingCurve","writable":true,"signer":false},{"name":"associatedUser","writable":true,"signer":false},{"name":"user","writable":true,"signer":true},{"name":"system_program","address":"11111111111111111111111111111111"},{"name":"associated_token_program","address":"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"},{"name":"token_program","address":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"},{"name":"event_authority","address":"Ce6TQqeHC9p8KetsN6JsjHK7UTZk7nasjjnr7XxXp9F1"},{"name":"program","address":"6EF8rrecthR5Dkzon8Nwu78hRvfCKubJ14M5uBEwF6P"}],"args":[{"name":"amount","type":"u64"},{"name":"minSolOutput","type":"u64"}]},{"name":"withdraw","discriminator":[183,18,70,156,148,109,161,34],"docs":["Allows the admin to withdraw liquidity for a migration once the bonding curve completes"],"accounts":[{"name":"global","writable":false,"pda":{"seeds":[{"kind":"const","value":[103,108,111,98,97,108]}]}},{"name":"lastWithdraw","writable":true,"signer":false},{"name":"mint","writable":false,"signer":false},{"name":"bonding_curve","writable":true,"pda":{"seeds":[{"kind":"const","value":[98,111,110,100,105,110,103,45,99,117,114,118,101]},{"kind":"account","path":"mint"}]}},{"name":"associatedBondingCurve","writable":true,"signer":false},{"name":"associatedUser","writable":true,"signer":false},{"name":"user","writable":true,"signer":true},{"name":"system_program","address":"11111111111111111111111111111111"},{"name":"token_program","address":"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"},{"name":"rent","address":"SysvarRent111111111111111111111111111111111"},{"name":"event_authority","address":"Ce6TQqeHC9p8KetsN6JsjHK7UTZk7nasjjnr7XxXp9F1"},{"name":"program","address":"6EF8rrecthR5Dkzon8Nwu78hRvfCKubJ14M5uBEwF6P"}],"args":[]}],"accounts":[{"name":"BondingCurve","discriminator":[23,183,248,55,96,216,172,96]},{"name":"Global","discriminator":[167,232,232,177,200,108,114,127]}],"events":[{"name":"CreateEvent","discriminator":[27,114,169,77,222,235,99,118]},{"name":"TradeEvent","discriminator":[189,219,127,211,78,230,97,238]},{"name":"CompleteEvent","discriminator":[95,114,97,156,212,46,152,8]},{"name":"SetParamsEvent","discriminator":[223,195,159,246,62,48,143,131]}],"types":[{"name":"Global","type":{"kind":"struct","fields":[{"name":"initialized","type":"bool"},{"name":"authority","type":"pubkey"},{"name":"feeRecipient","type":"pubkey"},{"name":"initialVirtualTokenReserves","type":"u64"},{"name":"initialVirtualSolReserves","type":"u64"},{"name":"initialRealTokenReserves","type":"u64"},{"name":"tokenTotalSupply","type":"u64"},{"name":"feeBasisPoints","type":"u64"}]}},{"name":"LastWithdraw","type":{"kind":"struct","fields":[{"name":"lastWithdrawTimestamp","type":"i64"}]}},{"name":"BondingCurve","type":{"kind":"struct","fields":[{"name":"virtualTokenReserves","type":"u64"},{"name":"virtualSolReserves","type":"u64"},{"name":"realTokenReserves","type":"u64"},{"name":"realSolReserves","type":"u64"},{"name":"tokenTotalSupply","type":"u64"},{"name":"complete","type":"bool"}]}},{"name":"CreateEvent","type":{"kind":"struct","fields":[{"name":"name","type":"string","index":false},{"name":"symbol","type":"string","index":false},{"name":"uri","type":"string","index":false},{"name":"mint","type":"pubkey","index":false},{"name":"bondingCurve","type":"pubkey","index":false},{"name":"user","type":"pubkey","index":false}]}},{"name":"TradeEvent","type":{"kind":"struct","fields":[{"name":"mint","type":"pubkey","index":false},{"name":"solAmount","type":"u64","index":false},{"name":"tokenAmount","type":"u64","index":false},{"name":"isBuy","type":"bool","index":false},{"name":"user","type":"pubkey","index":false},{"name":"timestamp","type":"i64","index":false},{"name":"virtualSolReserves","type":"u64","index":false},{"name":"virtualTokenReserves","type":"u64","index":false},{"name":"realSolReserves","type":"u64","index":false},{"name":"realTokenReserves","type":"u64","index":false}]}},{"name":"CompleteEvent","type":{"kind":"struct","fields":[{"name":"user","type":"pubkey","index":false},{"name":"mint","type":"pubkey","index":false},{"name":"bondingCurve","type":"pubkey","index":false},{"name":"timestamp","type":"i64","index":false}]}},{"name":"SetParamsEvent","type":{"kind":"struct","fields":[{"name":"feeRecipient","type":"pubkey","index":false},{"name":"initialVirtualTokenReserves","type":"u64","index":false},{"name":"initialVirtualSolReserves","type":"u64","index":false},{"name":"initialRealTokenReserves","type":"u64","index":false},{"name":"tokenTotalSupply","type":"u64","index":false},{"name":"feeBasisPoints","type":"u64","index":false}]}}],"errors":[{"code":6000,"name":"NotAuthorized","msg":"The given account is not authorized to execute this instruction."},{"code":6001,"name":"AlreadyInitialized","msg":"The program is already initialized."},{"code":6002,"name":"TooMuchSolRequired","msg":"slippage: Too much SOL required to buy the given amount of tokens."},{"code":6003,"name":"TooLittleSolReceived","msg":"slippage: Too little SOL received to sell the given amount of tokens."},{"code":6004,"name":"MintDoesNotMatchBondingCurve","msg":"The mint does not match the bonding curve."},{"code":6005,"name":"BondingCurveComplete","msg":"The bonding curve has completed and liquidity migrated to raydium."},{"code":6006,"name":"BondingCurveNotComplete","msg":"The bonding curve has not completed."},{"code":6007,"name":"NotInitialized","msg":"The program is not initialized."},{"code":6008,"name":"WithdrawTooFrequent","msg":"Withdraw too frequent"}]}'),R=n(23663).Buffer;class w{async buy(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500n,a=arguments.length>4?arguments[4]:void 0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:g,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:v,l=await this.getBondingCurveAccount(t,r);if(!l)return{success:!1,error:"Bonding curve account not found"};let u=l.getBuyPrice(n),c=p(n,i);console.log("buying ".concat(Number(u)/1e6," for: ").concat(Number(c)/s.LAMPORTS_PER_SOL," SOL (").concat(Number(c),")"));let m=await this.getGlobalAccount(r),d=await this.getBuyInstructions(e.publicKey,t,m.feeRecipient,u,c);return await h(this.connection,d,e.publicKey,[e],a,r,o)}async sell(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500n,a=arguments.length>4?arguments[4]:void 0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:g,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:v,l=await this.getBondingCurveAccount(t);if(!l)return{success:!1,error:"Bonding curve account not found"};let u=await this.getGlobalAccount(),c=y(l.getSellPrice(n,u.feeBasisPoints),i);console.log("selling ".concat(Number(n)/1e6," for: ").concat(Number(c)/s.LAMPORTS_PER_SOL," SOL"));let m=await this.getSellInstructions(e.publicKey,t,u.feeRecipient,n,c);return await h(this.connection,m,e.publicKey,[e],a,r,o)}async getCreateInstructions(e,t,n,i,a){let r=new s.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),[o]=s.PublicKey.findProgramAddressSync([R.from("metadata"),r.toBuffer(),a.publicKey.toBuffer()],r),u=await (0,l.Am)(a.publicKey,this.getBondingCurvePDA(a.publicKey),!0);return this.program.methods.create(t,n,i).accounts({mint:a.publicKey,associatedBondingCurve:u,metadata:o,user:e}).signers([a]).transaction()}async getBuyInstructions(e,t,n,i,a){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:g,o=await (0,l.Am)(t,this.getBondingCurvePDA(t),!0),m=await (0,l.Am)(t,e,!1),v=new s.Transaction;try{await (0,u.D0)(this.connection,m,r)}catch(n){v.add((0,c.Ek)(e,m,e,t))}return v.add(await this.program.methods.buy(new d.BN(i.toString()),new d.BN(a.toString())).accounts({feeRecipient:n,mint:t,associatedBondingCurve:o,associatedUser:m,user:e}).transaction()),v}async getSellInstructions(e,t,n,i,a){let r=await (0,l.Am)(t,this.getBondingCurvePDA(t),!0),o=await (0,l.Am)(t,e,!1),u=new s.Transaction;return u.add(await this.program.methods.sell(new d.BN(i.toString()),new d.BN(a.toString())).accounts({feeRecipient:n,mint:t,associatedBondingCurve:r,associatedUser:o,user:e}).transaction()),u}async getBondingCurveAccount(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g,n=await this.connection.getAccountInfo(this.getBondingCurvePDA(e),t);return n?m.fromBuffer(n.data):null}async getGlobalAccount(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,[t]=s.PublicKey.findProgramAddressSync([R.from("global")],new s.PublicKey("6EF8rrecthR5Dkzon8Nwu78hRvfCKubJ14M5uBEwF6P"));console.log("globalAccountPDA",t.toBase58());let n=await this.connection.getAccountInfo(t,e);return o.fromBuffer(n.data)}getBondingCurvePDA(e){return s.PublicKey.findProgramAddressSync([R.from("bonding-curve"),e.toBuffer()],this.program.programId)[0]}addEventListener(e,t){return this.program.addEventListener(e,(n,i,a)=>{switch(e){case"createEvent":t({name:n.name,symbol:n.symbol,uri:n.uri,mint:new s.PublicKey(n.mint),bondingCurve:new s.PublicKey(n.bondingCurve),user:new s.PublicKey(n.user)},i,a);break;case"tradeEvent":t({mint:new s.PublicKey(n.mint),solAmount:BigInt(n.solAmount),tokenAmount:BigInt(n.tokenAmount),isBuy:n.isBuy,user:new s.PublicKey(n.user),timestamp:Number(n.timestamp),virtualSolReserves:BigInt(n.virtualSolReserves),virtualTokenReserves:BigInt(n.virtualTokenReserves),realSolReserves:BigInt(n.realSolReserves),realTokenReserves:BigInt(n.realTokenReserves)},i,a);break;case"completeEvent":t({user:new s.PublicKey(n.user),mint:new s.PublicKey(n.mint),bondingCurve:new s.PublicKey(n.bondingCurve),timestamp:n.timestamp},i,a),console.log("completeEvent",n,i,a);break;case"setParamsEvent":t({feeRecipient:new s.PublicKey(n.feeRecipient),initialVirtualTokenReserves:BigInt(n.initialVirtualTokenReserves),initialVirtualSolReserves:BigInt(n.initialVirtualSolReserves),initialRealTokenReserves:BigInt(n.initialRealTokenReserves),tokenTotalSupply:BigInt(n.tokenTotalSupply),feeBasisPoints:BigInt(n.feeBasisPoints)},i,a);break;default:console.error("Unhandled event type:",e)}})}removeEventListener(e){this.program.removeEventListener(e)}constructor(e){this.program=new i.$r(k,e),this.connection=this.program.provider.connection}}async function T(e,t){let n=new a.Z(new s.Keypair),r=new i.Y7(t,n,{commitment:"finalized"}),o=new s.PublicKey(e),u=new w(r),c=await u.getBondingCurveAccount(o);if(!c)return null;let m=u.getBondingCurvePDA(o),d=await (0,l.Am)(o,m,!0);return console.log(c),console.log(m.toBase58()),console.log(d.toBase58()),{virtual_sol_reserves:c.virtualSolReserves.toString(),virtual_token_reserves:c.virtualTokenReserves.toString(),bonding_curve:m.toBase58(),associated_bonding_curve:d.toBase58()}}}}]);